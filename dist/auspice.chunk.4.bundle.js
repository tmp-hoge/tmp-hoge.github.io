(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{500:function(e,t,n){"use strict";n.d(t,"p",(function(){return i})),n.d(t,"d",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"h",(function(){return l})),n.d(t,"f",(function(){return c})),n.d(t,"j",(function(){return d})),n.d(t,"c",(function(){return h})),n.d(t,"i",(function(){return p})),n.d(t,"k",(function(){return u})),n.d(t,"g",(function(){return m})),n.d(t,"o",(function(){return f})),n.d(t,"l",(function(){return g})),n.d(t,"m",(function(){return v})),n.d(t,"n",(function(){return y})),n.d(t,"e",(function(){return b}));var a=n(2),i="Lato, Helvetica Neue, Helvetica, sans-serif",r="Lato, Helvetica Neue, Helvetica, sans-serif",o="Lato, Helvetica Neue, Helvetica, sans-serif",s="#333",l="#888",c="#BBB",d="#F2F2F2",h="#89B77F",p="#E39B39",u={backgroundColor:"#FFF",fontFamily:o,width:a.controlsWidth-13,borderSpacing:0,fontSize:14,paddingLeft:"10px",border:"1px solid #ccc",height:36,appearance:"none",borderRadius:"4px",color:s,fontWeight:400,marginBottom:"3px"},m={border:"0px",backgroundColor:"inherit",marginLeft:0,marginTop:5,marginRight:10,marginBottom:5,borderRadius:2,cursor:"pointer",padding:2,fontFamily:o,color:s,fontWeight:400,textTransform:"uppercase",fontSize:14,verticalAlign:"top",outline:0},f={borderTop:"1px solid #BBB",borderLeft:"1px solid #CCC",borderRight:"1px solid #CCC",borderBottom:"1px solid #CCC",borderRadius:"0px 0px 3px 3px",paddingTop:3,paddingBottom:3,paddingLeft:6,paddingRight:6,backgroundColor:"#fff",fontWeight:400,color:s,fontFamily:o,fontSize:12,textTransform:"uppercase"},g={borderTop:"1px solid #BBB",borderLeft:"1px solid #CCC",borderRight:"1px solid #CCC",borderBottom:"1px solid #CCC",borderRadius:"0px 0px 3px 3px",paddingTop:3,paddingBottom:3,paddingLeft:6,paddingRight:6,backgroundColor:"#fff"},v={border:"none",backgroundColor:"inherit",padding:0,margin:0,cursor:"pointer",fontFamily:o,color:s,fontWeight:400,textTransform:"uppercase",fontSize:12},y={border:"none",backgroundColor:"inherit",padding:0,margin:0,cursor:"pointer",fontFamily:o,color:"#5097BA",fontWeight:400,textTransform:"uppercase",fontSize:12},b={branchInfoHeading:{fontSize:15,fontWeight:400,verticalAlign:"middle",padding:"5px"},buttonLink:{float:"right",fontFamily:o,fontSize:14,fontWeight:400,textDecoration:"none",pointerEvents:"auto",background:"none",color:"white",cursor:"pointer",textTransform:"uppercase",borderRadius:2,border:"1px solid #CCC",verticalAlign:"middle"},tooltip:{position:"relative",padding:5,color:"white",fontFamily:o,fontSize:14,lineHeight:1,fontWeight:300},modalContainer:{position:"absolute",width:"100%",height:"100%",pointerEvents:"all",top:0,left:0,zIndex:2e3,backgroundColor:"rgba(80, 80, 80, .20)",display:"flex",justifyContent:"center",alignItems:"center",wordWrap:"break-word",wordBreak:"break-word"},panel:{position:"relative",paddingLeft:30,padding:"5% 5%",borderRadius:5,backgroundColor:"rgba(55,55,55,0.9)",color:"white",fontFamily:o,fontSize:18,lineHeight:1,fontWeight:300,maxWidth:"80%",overflowY:"auto"},modalHeading:{fontSize:24,fontWeight:400},modalSubheading:{fontSize:20,fontWeight:400,marginTop:"20px",marginBottom:"20px"},tooltipHeading:{fontSize:18,fontWeight:400,marginBottom:"10px"},comment:{fontStyle:"italic",fontWeight:200,fontSize:14,marginTop:"10px"},topRightMessage:{fontStyle:"italic",fontWeight:200,fontSize:14,textAlign:"right",marginTop:"-20px"},list:{paddingLeft:15,listStyleType:"disc"},item:{paddingTop:4,paddingBottom:4,minWidth:120},break:{marginBottom:"10px"}}},505:function(e,t,n){"use strict";var a=n(35),i=n.n(a),r=n(55),o=n.n(r),s=n(56),l=n.n(s),c=n(57),d=n.n(c),h=n(58),p=n.n(h),u=n(59),m=n.n(u),f=n(3),g=n.n(f),v=n(500);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(n,!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w=function(e){function t(){return o()(this,t),d()(this,p()(t).apply(this,arguments))}return m()(t,e),l()(t,[{key:"getStyles",value:function(){return{base:{backgroundColor:"#FFFFFF",display:"inline-block",marginLeft:14,marginRight:0,marginTop:0,marginBottom:10,paddingLeft:6,paddingRight:6,paddingBottom:6,overflow:"hidden",position:"relative"},title:{fontFamily:v.d,color:v.a,fontSize:16,marginLeft:0,marginTop:0,marginBottom:8,fontWeight:500,backgroundColor:"#FFFFFF",borderTop:"thin solid #BBB",minHeight:"15px"}}}},{key:"getStylesInfoCard",value:function(){return{base:{backgroundColor:"#FFFFFF",display:"inline-block",marginLeft:14,marginRight:0,marginTop:0,marginBottom:10,paddingLeft:6,paddingRight:6,paddingBottom:6,overflow:"hidden",position:"relative"},title:{fontFamily:v.d,color:"#fff",fontSize:16,marginLeft:0,marginTop:0,marginBottom:8,fontWeight:500,backgroundColor:"#FFFFFF"}}}},{key:"render",value:function(){var e=this.props.infocard?this.getStylesInfoCard():this.getStyles();return g.a.createElement("div",{id:"".concat(this.props.title,"Card"),style:b({},e.base,{},this.props.style)},g.a.createElement("div",{id:"CardTitle",style:b({},e.title,{},this.props.titleStyles)},this.props.title),g.a.createElement("div",{id:"CardContentContainer",style:{display:"flex",justifyContent:this.props.center?"center":"flex-start"}},this.props.children))}}]),t}(g.a.Component);t.a=w},509:function(e,t,n){"use strict";var a=n(55),i=n.n(a),r=n(56),o=n.n(r),s=n(57),l=n.n(s),c=n(58),d=n.n(c),h=n(59),p=n.n(h),u=n(35),m=n.n(u),f=n(3),g=n.n(f),v=n(15),y=n.n(v);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(n,!0).forEach((function(t){m()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=function(e){function t(){return i()(this,t),l()(this,d()(t).apply(this,arguments))}return p()(t,e),o()(t,[{key:"getStyles",value:function(){return{base:{display:"flex",flexDirection:this.props.direction,flexWrap:this.props.wrap,justifyContent:this.props.justifyContent,alignItems:this.props.alignItems,alignContent:this.props.alignContent,order:this.props.order,flexGrow:this.props.grow,flexShrink:this.props.shrink,flexBasis:this.props.basis,alignSelf:this.props.alignSelf},style:this.props.style}}},{key:"render",value:function(){var e=this.getStyles();return g.a.createElement("div",{id:this.props.id,onClick:this.props.clickHandler,style:w({},e.base,{},e.style)},this.props.children)}}]),t}(g.a.Component);m()(x,"propTypes",{direction:y.a.oneOf(["row","rowReverse","column","columnReverse"]),wrap:y.a.oneOf(["nowrap","wrap","wrap-reverse"]),justifyContent:y.a.oneOf(["flex-start","flex-end","center","space-between","space-around"]),alignItems:y.a.oneOf(["flex-start","flex-end","center","baseline","stretch"]),alignContent:y.a.oneOf(["flex-start","flex-end","center","space-between","space-around","stretch"]),grow:y.a.number,shrink:y.a.number,basis:y.a.string,order:y.a.number,alignSelf:y.a.oneOf(["auto","flex-start","flex-end","center","baseline","stretch"]),styleOverrides:y.a.object,children:y.a.node,clickHandler:y.a.func}),m()(x,"defaultProps",{direction:"row",wrap:"nowrap",justifyContent:"center",alignItems:"center",alignContent:"stretch",grow:0,shrink:1,basis:"auto",alignSelf:"auto",order:0,style:{}}),t.a=x},518:function(e,t,n){e.exports=n.p+"1ffc23cfee00e9e13194f13f3a7ce418.svg"},522:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(34),i=n(94),r=(n(120),n(123)),o=n(96),s=n(0),l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return function(t,n){var l=n(),c=l.controls,d=l.tree,h=l.treeToo,p=l.metadata,u=l.frequencies;if(null===d.nodes||!p.loaded)return null;var m=e||c.colorBy,f=Object(i.calcColorScale)(m,c,d,h,p),g=Object(a.calcNodeColor)(d,f),v=h.loaded?Object(a.calcNodeColor)(h,f):void 0,y=Object(a.determineColorByGenotypeMutType)(m),b=y!==c.mutType&&y;return b&&t(Object(r.a)(b)),t({type:s.D,colorBy:m,colorScale:f,nodeColors:g,nodeColorsToo:v,version:f.version}),u.loaded&&Object(o.b)(t,n),null}}},533:function(e,t,n){"use strict";var a=n(3),i=n.n(a),r=n(501),o=n(2),s=function(e){var t=e.navHeight,n=e.navWidth,a=e.display,r=e.onClick;n||(n=0);var o={position:"fixed",left:n-12,visibility:a?"visible":"hidden",width:a?12:0,top:t/2-8,backgroundColor:"inherit",boxShadow:"none",cursor:"pointer",borderRadius:"0px",fontSize:12,color:"#444",textAlign:"center",verticalAlign:"middle"};return i.a.createElement("div",{style:o,onClick:r},i.a.createElement("i",{className:"fa fa-chevron-left","aria-hidden":"true"}))},l=n(518),c=r.c.div.withConfig({displayName:"content__AuspiceNavBarContainer",componentId:"jg0fvy-0"})(["display:flex;flex-direction:row;align-items:center;justify-content:center;height:100%;"]),d=r.c.a.withConfig({displayName:"content__Title",componentId:"jg0fvy-1"})(["padding:0px;text-decoration:none;color:",";font-size:20px;font-weight:400;cursor:pointer;letter-spacing:1rem;"],(function(e){return e.theme.color})),h=r.c.a.withConfig({displayName:"content__LogoLink",componentId:"jg0fvy-2"})(["padding:5px 5px;width:50px;cursor:pointer;"]),p=r.c.div.withConfig({displayName:"content__NarrativeTitle",componentId:"jg0fvy-3"})(["white-space:nowrap;font-size:1.7rem;margin-left:auto;padding:0px 12px;float:right;color:",";max-width:","px;overflow:hidden;text-overflow:ellipsis;"],(function(e){return e.theme.color}),(function(e){return e.width-90})),u=n(20),m=r.c.div.withConfig({displayName:"navBar__NavBarContainer",componentId:"ygpsg-0"})(["left:0;max-width:960px;margin-top:auto;margin-right:auto;margin-bottom:auto;margin-left:auto;height:","px;justify-content:space-between;align-items:center;overflow:hidden;z-index:100;transition:left .3s ease-out;"],(function(e){return e.narrative?o.narrativeNavBarHeight:o.normalNavBarHeight})),f=Object(u.hasExtension)("navbarComponent")?Object(u.getExtension)("navbarComponent"):function(e){var t=e.narrativeTitle,n=e.sidebar,a=e.width;return n?i.a.createElement(c,null,i.a.createElement("div",{style:{flex:1}}),i.a.createElement(h,{href:"/"},i.a.createElement("img",{alt:"splashPage",width:"40px",src:l})),i.a.createElement("div",{style:{flex:1}}),function(e,t){return e?i.a.createElement(p,{width:t,href:"/"},e):i.a.createElement(d,{href:"/"},"auspice")}(t,a),i.a.createElement("div",{style:{flex:1}})):null};t.a=function(e){var t=e.sidebar,n=(e.mobileDisplay,e.toggleHandler),a=e.narrativeTitle,r=e.width,l=t&&!a;return i.a.createElement(m,null,i.a.createElement(f,{narrativeTitle:a,sidebar:t,width:r}),i.a.createElement(s,{navHeight:o.normalNavBarHeight,navWidth:r,display:l,onClick:n}))}},564:function(e,t){e.exports={version:"2.8.1"}},569:function(e,t,n){e.exports=n.p+"f66966ba89ed36ecbe0e4e0688cb1ef9.png"},570:function(e,t,n){e.exports=n.p+"4dc6198ec0d867620d300be40d112a10.jpg"},685:function(e,t,n){var a=n(686);"string"==typeof a&&(a=[[e.i,a,""]]);n(45)(a,{});a.locals&&(e.exports=a.locals)},686:function(e,t,n){(e.exports=n(44)(!1)).push([e.i,'.awesomplete [hidden] {\n    display: none;\n}\n\n.awesomplete .visually-hidden {\n    position: absolute;\n    clip: rect(0, 0, 0, 0);\n}\n\n.awesomplete {\n    display: inline-block;\n    position: relative;\n    width: 100%;\n    height: 100%;\n}\n\n.awesomplete > input {\n    display: block;\n}\n\n.awesomplete > ul {\n    position: absolute;\n    left: 0;\n    z-index: 1;\n    min-width: 100%;\n    box-sizing: border-box;\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    background: #fff;\n}\n\n.awesomplete > ul:empty {\n    display: none;\n}\n\n.awesomplete > ul {\n  width: 80%;\n  border-radius: .3em;\n  margin: .2em 0 0;\n  background: hsla(0,0%,100%,.9);\n  background: linear-gradient(to bottom right, white, hsla(0,0%,100%,.8));\n  border: 1px solid rgba(0,0,0,.3);\n  box-shadow: .05em .2em .6em rgba(0,0,0,.2);\n  text-shadow: none;\n}\n\n@supports (transform: scale(0)) {\n  .awesomplete > ul {\n    transition: .3s cubic-bezier(.4,.2,.5,1.4);\n    transform-origin: 1.43em -.43em;\n  }\n\n  .awesomplete > ul[hidden],\n  .awesomplete > ul:empty {\n    opacity: 0;\n    transform: scale(0);\n    display: block;\n    transition-timing-function: ease;\n  }\n}\n\n  /* Pointer */\n  .awesomplete > ul:before {\n    content: "";\n    position: absolute;\n    top: -.43em;\n    left: 1em;\n    width: 0; height: 0;\n    padding: .4em;\n    background: white;\n    border: inherit;\n    border-right: 0;\n    border-bottom: 0;\n    -webkit-transform: rotate(45deg);\n    transform: rotate(45deg);\n  }\n\n  .awesomplete > ul > li {\n    position: relative;\n    padding: .2em .5em;\n    cursor: pointer;\n  }\n\n  .awesomplete > ul > li:hover {\n    background: hsl(200, 40%, 80%);\n    color: black;\n  }\n\n  .awesomplete > ul > li[aria-selected="true"] {\n    background: hsl(205, 40%, 40%);\n    color: white;\n  }\n\n  .awesomplete mark {\n    color: rgb(80, 151, 186);\n    background: white;\n  }\n\n  .awesomplete li:hover mark {\n    background: hsl(200, 40%, 80%);\n  }\n',""])},710:function(e,t,n){"use strict";n.r(t);var a=n(55),i=n.n(a),r=n(56),o=n.n(r),s=n(57),l=n.n(s),c=n(58),d=n.n(c),h=n(121),p=n.n(h),u=n(59),m=n.n(u),f=n(35),g=n.n(f),v=n(3),y=n.n(v),b=n(15),w=n.n(b),x=n(43),k=n(501),E=n(500),T=function(e){var t=e.sidebarOpen,n=e.mobileDisplay,a=e.handler,i={visibility:n?"visible":t?"hidden":"visible",width:n?60:14,height:n?60:44,position:"absolute",top:n?15:4,left:n?"auto":0,right:n?20:"auto",zIndex:9e3,backgroundColor:n?E.c:E.j,boxShadow:n?"2px 4px 10px 1px rgba(0, 0, 0, 0.15)":"0px 0px 5px 1px rgba(0, 0, 0, 0.2)",cursor:"pointer",padding:0,transition:"top 0.3s ease-out, left 0.3s ease-out, width 0.3s ease-out, height 0.3s ease-out",borderRadius:n?"45px":"0px 6px 6px 0px"},r={visibility:n?"visible":t?"hidden":"visible",position:"absolute",width:30,height:30,top:"50%",left:"50%",lineHeight:"30px",textAlign:"center",transform:"translate(-50%,-50%)",marginLeft:"auto",marginRight:"auto",verticalAlign:"middle",color:n?"#FFFFFF":"#444",fontSize:n?26:12},o="fa fa-close";return t&&!n?o="fa fa-chevron-left":t||n?t&&n?o="fa fa-close":!t&&n&&(o="fa fa-sliders"):o="fa fa-chevron-right",y.a.createElement("div",{style:i,onClick:a},y.a.createElement("div",{style:r},y.a.createElement("i",{className:o,"aria-hidden":"true"})))},S=n(505),C=n(119),O=n(21),j=n(6),N=n(2),D=n(41),M=n.n(D),I=n(534),B=n.n(I),_=n(535),P=n.n(_),A=n(0),R=n(509),F=n(564),z=n(521),V=n.n(z),W=n(8);function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var H,q=function(e){e||(e=window.event),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},U=function(e,t,n){return y.a.createElement("tr",{key:e},y.a.createElement("th",{style:E.e.item},e),y.a.createElement("td",{style:E.e.item},n?y.a.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer"},t):t))},X=function(e){return void 0!==e&&e.startsWith("https_")?e.replace("https_","https:"):void 0!==e&&e.startsWith("http_")?e.replace("http_","http:"):e},K=function(e){var t=e.url,n=e.title,a=e.value;return y.a.createElement("tr",null,y.a.createElement("th",{style:E.e.item},n),y.a.createElement("td",{style:E.e.item},y.a.createElement("a",{href:t,target:"_blank",rel:"noopener noreferrer"},a)))},J=function(e){var t=e.node,n=Object(W.getAccessionFromNode)(t),a=Object(W.getUrlFromNode)(t),i=Object(W.getTraitFromNode)(t,"genbank_accession"),r=Object(W.getTraitFromNode)(t,"gisaid_epi_isl");return Object(N.isValueValid)(r)?y.a.createElement(y.a.Fragment,null,y.a.createElement(K,{title:"GISAID EPI ISL",value:r.split("_")[2],url:"https://gisaid.org"}),Object(N.isValueValid)(i)?y.a.createElement(K,{title:"Genbank accession",value:i,url:"https://www.ncbi.nlm.nih.gov/nuccore/"+i}):null):Object(N.isValueValid)(i)?y.a.createElement(K,{title:"Genbank accession",value:i,url:"https://www.ncbi.nlm.nih.gov/nuccore/"+i}):Object(N.isValueValid)(n)&&Object(N.isValueValid)(a)?y.a.createElement(K,{url:X(a),value:n,title:"Accession"}):Object(N.isValueValid)(n)?U("Accession",n):Object(N.isValueValid)(a)?y.a.createElement(K,{title:"Strain URL",url:X(a),value:"click here"}):null},Y=function(e){var t=e.node,n=Object(W.getVaccineFromNode)(t);if(!n)return null;var a=[];return n.selection_date&&a.push(y.a.createElement("tr",{key:"seldate"},y.a.createElement("th",null,"Vaccine selected"),y.a.createElement("td",null,n.selection_date))),n.start_date&&a.push(y.a.createElement("tr",{key:"startdate"},y.a.createElement("th",null,"Vaccine start date"),y.a.createElement("td",null,n.start_date))),n.end_date&&a.push(y.a.createElement("tr",{key:"enddate"},y.a.createElement("th",null,"Vaccine end date"),y.a.createElement("td",null,n.end_date))),n.serum&&a.push(y.a.createElement("tr",{key:"serum"},y.a.createElement("th",null,"Serum strain"),y.a.createElement("td",null))),a},Z=function(e){var t=e.node,n=Object(W.getFullAuthorInfoFromNode)(t);if(!n)return null;var a=[];return a.push(U("Authors",n.value)),n.title&&"?"!==n.title&&(n.paper_url&&"?"!==n.paper_url?a.push(U("Title",n.title,n.paper_url)):a.push(U("Title",n.title))),n.journal&&"?"!==n.journal&&a.push(U("Journal",n.journal)),1===a.length?a[0]:a},$=function(e){var t=e.children;return y.a.createElement("p",{style:E.e.modalHeading},t)},Q=function(e){var t=e.node,n=Object(W.getTraitFromNode)(t,"num_date");if(!n)return null;var a=Object(W.getTraitFromNode)(t,"num_date",{confidence:!0});return n&&a&&a[0]!==a[1]?y.a.createElement(y.a.Fragment,null,U("Inferred collection date",Object(j.numericToCalendar)(n)),U("Collection date confidence","(".concat(Object(j.numericToCalendar)(a[0]),", ").concat(Object(j.numericToCalendar)(a[1]),")"))):U("Collection date",Object(j.numericToCalendar)(n))},ee=function(e){var t=e.node,n=e.trait,a=e.colorings,i=Object(W.getTraitFromNode)(t,n),r=i;"number"==typeof i&&(Number.isInteger(i)||(r=Number.parseFloat(i).toPrecision(3)));var o=a&&a[n]&&a[n].title?a[n].title:n;return Object(N.isValueValid)(r)?U(o,r):null},te=function(e){var t=e.tip,n=e.goAwayCallback,a=e.colorings;if(!t)return null;var i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(n,!0).forEach((function(t){g()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},E.e.panel);i.maxHeight="70%";var r=t.n;return y.a.createElement("div",{style:E.e.modalContainer,onClick:function(){return n(t)}},y.a.createElement("div",{className:"panel",style:i,onClick:function(e){return q(e)}},y.a.createElement($,null,r.name),y.a.createElement("table",null,y.a.createElement("tbody",null,y.a.createElement(Y,{node:r}),y.a.createElement(Q,{node:r}),y.a.createElement(Z,{node:r}),function(e){if(!e.node_attrs)return[];var t=["author","div","num_date","gisaid_epi_isl","genbank_accession"];return Object.keys(e.node_attrs).filter((function(e){return!t.includes(e)}))}(r).map((function(e){return y.a.createElement(ee,{node:r,trait:e,colorings:a,key:e})})),y.a.createElement(J,{node:r}))),y.a.createElement("p",{style:E.e.comment},"Click outside this box to go back to the tree")))},ne=n(53),ae=n(18),ie=n.n(ae),re=n(5),oe=function(e){var t=e.dispatch,n=e.transform,a=e.legendRectSize,i=e.legendSpacing,r=e.legendMaxLength,o=e.rectStroke,s=e.rectFill,l=e.label,c=e.value;return y.a.createElement("g",{transform:n,onMouseEnter:function(){t(Object(C.e)({selectedLegendItem:c}))},onMouseLeave:function(){t(Object(C.e)())}},y.a.createElement("rect",{style:{strokeWidth:2},width:a,height:a,fill:s,stroke:o}),y.a.createElement("text",{x:a+i+5,y:a-i,style:{fontSize:12,fill:E.a,fontFamily:E.b}},y.a.createElement("title",null,l),"string"==typeof l?l.substring(0,r):l))},se=n(24),le=Object(x.b)((function(e){return{colorBy:e.controls.colorBy,colorings:e.metadata.colorings,colorScale:e.controls.colorScale,legendOpen:e.controls.legendOpen}}))(H=function(e){function t(e){return i()(this,t),l()(this,d()(t).call(this,e))}return m()(t,e),o()(t,[{key:"showLegend",value:function(){return void 0!==this.props.legendOpen?this.props.legendOpen:!(this.props.width<600||this.props.colorScale.legendValues.length>32)}},{key:"getSVGHeight",value:function(){if(!this.showLegend())return 18;var e=this.props.colorScale.legendValues.length;return Math.ceil(e/2)*(N.legendRectSize+N.legendSpacing)+N.legendSpacing+20||100}},{key:"getSVGWidth",value:function(){return this.showLegend()?290:this.getTitleWidth()+20}},{key:"getTransformationForLegendItem",value:function(e){var t=this.props.colorScale.legendValues.length,n=Math.ceil(t/2);return"translate("+(145*Math.floor(e/n)+10)+","+e%n*(N.legendRectSize+N.legendSpacing)+")"}},{key:"getTitleString",value:function(){if(Object(se.isColorByGenotype)(this.props.colorBy)){var e=Object(se.decodeColorByGenotype)(this.props.colorBy);return e.aa?"Genotype at ".concat(e.gene," site ").concat(e.positions.join(", ")):"Nucleotide at position ".concat(e.positions.join(", "))}return void 0===this.props.colorings[this.props.colorBy]?"":this.props.colorings[this.props.colorBy].title}},{key:"getTitleWidth",value:function(){return 15+5.3*this.getTitleString().length}},{key:"toggleLegend",value:function(){this.props.dispatch({type:A.K,value:!this.props.legendOpen})}},{key:"legendTitle",value:function(){return y.a.createElement("g",{id:"Title"},y.a.createElement("rect",{width:this.getTitleWidth(),height:"12",fill:"rgba(255,255,255,.85)"}),y.a.createElement("text",{x:5,y:10,style:{fontSize:12,fill:E.a,fontFamily:E.d,backgroundColor:"#fff"}},this.getTitleString()))}},{key:"legendChevron",value:function(){var e=this.showLegend()?-180:0,t=this.getTitleWidth();return y.a.createElement("g",{id:"Chevron",transform:"translate(".concat(t,",0)")},y.a.createElement("svg",{width:"12",height:"12",viewBox:"0 0 1792 1792"},y.a.createElement("rect",{width:"1792",height:"1792",fill:"rgba(255,255,255,.85)"}),y.a.createElement("path",{fill:E.a,style:{transform:"rotate(".concat(e,"deg)"),transformOrigin:"50% 50%",transition:"".concat(N.fastTransitionDuration,"ms ease-in-out")},d:"M1683 808l-742 741q-19 19-45 19t-45-19l-742-741q-19-19-19-45.5t19-45.5l166-165q19-19 45-19t45 19l531 531 531-531q19-19 45-19t45 19l166 165q19 19 19 45.5t-19 45.5z"})))}},{key:"styleLabelText",value:function(e){if("num_date"===this.props.colorBy){var t=this.props.colorScale.legendValues;if(t[t.length-1]-t[0]>10&&t[t.length-1]-parseInt(e,10)>=10)return parseInt(e,10);var n=Object(j.numericToCalendar)(e).split("-"),a=ie()(n,3),i=a[0],r=a[1];a[2];return"".concat(N.months[r]," ").concat(i)}return e}},{key:"legendItems",value:function(){var e=this,t=this.props.colorScale.legendValues.filter((function(e){return void 0!==e})).map((function(t,n){return y.a.createElement(oe,{dispatch:e.props.dispatch,legendRectSize:N.legendRectSize,legendSpacing:N.legendSpacing,legendMaxLength:N.legendMaxLength,rectFill:Object(re.f)(e.props.colorScale.scale(t)).brighter([.35]).toString(),rectStroke:Object(re.f)(e.props.colorScale.scale(t)).toString(),transform:e.getTransformationForLegendItem(n),key:t,value:t,label:e.styleLabelText(t),index:n})}));return y.a.createElement("g",{id:"ItemsContainer"},y.a.createElement("rect",{width:"290",height:this.getSVGHeight(),fill:"rgba(255,255,255,.85)"}),y.a.createElement("g",{id:"Items",transform:"translate(0,20)"},t))}},{key:"getStyles",value:function(){return{svg:{position:"absolute",left:5,top:26,borderRadius:4,zIndex:1e3,userSelect:"none"}}}},{key:"render",value:function(){var e=this;if(!this.props.colorScale)return null;var t=this.getStyles();return y.a.createElement("svg",{id:"TreeLegendContainer",width:this.getSVGWidth(),height:this.getSVGHeight(),style:t.svg},this.legendItems(),y.a.createElement("g",{id:"TitleAndChevron",onClick:function(){return e.toggleLegend()},style:{cursor:"pointer"}},this.legendTitle(),this.legendChevron()))}}]),t}(y.a.Component))||H,ce=n(29),de=n(88),he=n(519),pe=function(e){return 1===e["stroke-width"]?0:e["stroke-width"]>6?e["stroke-width"]+6:2*e["stroke-width"]},ue=(n(120),function(e){var t=e.n.node_attrs&&e.n.node_attrs.hidden;return t&&("always"===t||"timetree"===t&&"num_date"===e.that.distance||"divtree"===t&&"div"===e.that.distance)?"hidden":"visible"});var me={attrs:{".tip":{r:function(e){return e.r},cx:function(e){return e.xTip},cy:function(e){return e.yTip}},".branch":{},".vaccineCross":{d:function(e){return e.vaccineCross}},".conf":{d:function(e){return e.confLine}}},styles:{".tip":{fill:function(e){return e.fill},stroke:function(e){return e.tipStroke},visibility:function(e){return e.visibility===N.NODE_VISIBLE?"visible":"hidden"}},".conf":{stroke:function(e){return e.branchStroke},"stroke-width":pe},".branch":{stroke:function(e){return e.branchStroke},"stroke-width":function(e){return e["stroke-width"]+"px"},cursor:function(e){return e.visibility===N.NODE_VISIBLE?"pointer":"default"},visibility:ue}}},fe=function(e,t){return function(n){me.attrs[e]&&M()(t).filter((function(t){return me.attrs[e][t]})).forEach((function(t){n.attr(t,me.attrs[e][t])})),me.styles[e]&&M()(t).filter((function(t){return me.styles[e][t]})).forEach((function(t){n.style(t,me.styles[e][t])}))}},ge=function(e,t,n,a){e.selectAll(t).filter((function(e){return e.update})).transition().duration(a).call(n),a||Object(he.d)()},ve=n(11),ye=function e(t,n){t.x=t.px+t.branchLength*Math.cos(t.tau+.5*t.w),t.y=t.py+t.branchLength*Math.sin(t.tau+.5*t.w);var a=t.tau;if(!t.terminal)for(var i=0;i<t.children.length;i++){var r=t.children[i];r.w=2*Math.PI*r.leafCount/n,r.tau=a,a+=r.w,r.px=t.x,r.py=t.y,e(r,n)}},be=function(e,t){var n=Math.floor(Math.log10(e)),a=Math.pow(10,n);e/a<2?a/=5:e/a<5&&(a/=2);var i=t;return 5!==a&&10!==a||(i=5),[a,a/i]},we=function(e,t){if(e>=1)return t.toFixed(Math.max(0,-Math.floor(Math.log10(e))));var n=Object(j.numericToCalendar)(t).split("-"),a=ie()(n,3),i=a[0],r=a[1],o=a[2];return e>=1/12?"".concat(i,"-").concat(N.months[r]):"".concat(i,"-").concat(N.months[r],"-").concat(o)},xe=function(e,t,n,a,i,r){for(var o=[],s=[],l="num_date"===a?function(e,t){var n=function(e,t){return Math.ceil(e/t)*t},a=e/(Math.floor(t/(t<1200?100:150))||1);return[a=a>100?n(a,100):a>10?n(a,10):a>1?n(a,1):a>1/12?n(a,1/12):a>1/52?n(a,1/52):a>1/365.25?n(a,1/365.25):1/365.25,function(e){for(var t=0,n=[1/365.25,1/52,1/12,1,10,100,1e3];t<n.length;t++){var a=n[t];if(e/a<=12)return a}return e}(a)]}(t-e,Math.abs(r)):be(t-e,i),c=ie()(l,2),d=c[0],h=c[1],p=Math.floor(e/d)*d,u="radial"===n?e:p,m=t,f=0;f<=(t-p)/d+3;f++){var g=p+d*f;o.push({position:g,name:"num_date"===a?we(d,g):g.toFixed(Math.max(0,-Math.floor(Math.log10(d)))),visibility:g<u||g>m?"hidden":"visible",axis:"x"});for(var v=g+h;v<g+d&&v<t;v+=h)s.push({position:v,visibility:v<u||v>m+h?"hidden":"visible",axis:"x"})}return{majorGridPoints:o,minorGridPoints:s}},ke=function(e){return"aa"===e?"10px":"14px"},Ee=function(e){return"aa"===e?"500":"700"},Te=function(e,t,n){if("aa"!==e)return"visible";return function(e){return"rect"!==t?"hidden":Object.keys(e.n.branch_attrs.labels).filter((function(e){return"aa"!==e})).length?"visible":e.n.tipCount>.05*n?"visible":"hidden"}},Se=function(e,t){var n=this;this.grid=!1,this.attributes=["r","cx","cy","id","class","d"],this.params={regressionStroke:E.a,regressionWidth:6,majorGridStroke:"#DDD",majorGridWidth:2,minorGridStroke:"#EEE",minorGridWidth:1,tickLabelSize:12,tickLabelFill:E.a,minorTicks:4,orientation:[1,1],margins:{left:30,right:15,top:10,bottom:40},showGrid:!0,fillSelected:"#A73",radiusSelected:5,branchStroke:"#AAA",branchStrokeWidth:2,tipStroke:"#AAA",tipFill:"#CCC",tipStrokeWidth:1,tipRadius:4,fontFamily:E.b,branchLabelKey:!1,branchLabelFont:E.b,branchLabelFill:"#777",branchLabelFontWeight:500,branchLabelPadX:8,branchLabelPadY:5,tipLabels:!0,tipLabelFont:E.b,tipLabelFill:"#555",tipLabelPadX:8,tipLabelPadY:2,mapToScreenDebounceTime:500,tipLabelFontSizeL1:8,tipLabelFontSizeL2:10,tipLabelFontSizeL3:12,tipLabelBreakL1:75,tipLabelBreakL2:50,tipLabelBreakL3:25},this.groups={},this.debugId=t,this.nodes=e.map((function(e){var t={that:n,n:e,x:0,y:0,terminal:void 0===e.children,inView:void 0===e.inView||e.inView};return e.shell=t,t})),this.numberOfTips=Object(de.c)(this.nodes),Object(de.f)(this.nodes),this.xScale=Object(ce.a)(),this.yScale=Object(ce.a)(),this.zoomNode=this.nodes[0],this.strainToNode={},this.nodes.forEach((function(e){n.strainToNode[e.n.name]=e}))};Se.prototype.change=function(e){var t,n,a=e.changeColorBy,i=void 0!==a&&a,r=e.changeVisibility,o=void 0!==r&&r,s=e.changeTipRadii,l=void 0!==s&&s,c=e.changeBranchThickness,d=void 0!==c&&c,h=e.showConfidences,p=void 0!==h&&h,u=e.removeConfidences,m=void 0!==u&&u,f=e.zoomIntoClade,g=void 0!==f&&f,v=e.svgHasChangedDimensions,y=void 0!==v&&v,b=e.animationInProgress,w=void 0!==b&&b,x=e.newDistance,k=void 0===x?void 0:x,E=e.newLayout,T=void 0===E?void 0:E,S=e.updateLayout,C=void 0===S?void 0:S,O=e.newBranchLabellingKey,j=void 0===O?void 0:O,N=e.branchStroke,D=void 0===N?void 0:N,M=e.tipStroke,L=void 0===M?void 0:M,I=e.fill,B=void 0===I?void 0:I,_=e.visibility,P=void 0===_?void 0:_,A=e.tipRadii,R=void 0===A?void 0:A,F=e.branchThickness,z=void 0===F?void 0:F,V=new Set,W={},G=new Set,H=T,q=500;Date.now()-this.timeLastRenderRequested<1e3&&(q=0),i&&(V.add(".branch").add(".tip").add(".conf"),G.add("stroke").add("fill"),W.branchStroke=D,W.tipStroke=L,W.fill=B),o&&(V.add(".tip").add(".tipLabel"),G.add("visibility").add("cursor"),W.visibility=P),l&&(V.add(".tip"),G.add("r"),W.r=R),d&&(V.add(".branch").add(".conf"),G.add("stroke-width"),W["stroke-width"]=z),(k||T||C||g||y)&&(V.add(".tip").add(".branch.S").add(".branch.T").add(".branch"),V.add(".vaccineCross").add(".vaccineDottedLine").add(".conf"),V.add(".branchLabel").add(".tipLabel"),V.add(".grid").add(".regression"),G.add("cx").add("cy").add("d").add("opacity").add("visibility")),t=this.nodes,n=W,t.forEach((function(e,t){for(var a in e.update=!1,n){var i=n[a][t];i!==e[a]&&(e[a]=i,e.update=!0)}})),g&&(this.nodes.forEach((function(e){e.inView=!1,e.update=!0})),this.zoomNode=g.terminal?g.parent:g,Object(de.b)(this.zoomNode,(function(e){e.inView=!0}))),y&&this.nodes.forEach((function(e){e.update=!0})),k&&this.setDistance(k),(k||T||C)&&this.setLayout(T||this.layout),(G.has(["stroke-width"])||k||T||C||g||y)&&this.mapToScreen();var U={removeConfidences:m,showConfidences:p,newBranchLabellingKey:j};U.timeSliceHasPotentiallyChanged=o||k,U.hideTipLabels=w,H?this.modifySVGInStages(V,G,q,1e3):this.modifySVG(V,G,q,U),this.timeLastRenderRequested=Date.now()},Se.prototype.modifySVG=function(e,t,n,a){var i,r=this,o=[".tip",".vaccineDottedLine",".vaccineCross",".branch"];if(e.has(".branch.S")||e.has(".branch.T")){var s=e.has(".branch");s&&o.splice(o.indexOf(".branch"),1);[".S",".T"].forEach((function(a,o){e.has(".branch".concat(a))&&(i=s?function(e){fe(".branch",t)(e),e.attr("d",(function(e){return e.branch[o]}))}:function(e){e.attr("d",(function(e){return e.branch[o]}))},ge(r.svg,".branch".concat(a),i,n))}))}o.forEach((function(a){e.has(a)&&(i=fe(a,t),ge(r.svg,a,i,n))})),e.has(".branchLabel")&&this.updateBranchLabels(n),a.hideTipLabels?this.removeTipLabels():e.has(".tipLabel")&&this.updateTipLabels(),e.has(".grid")&&(this.grid&&"unrooted"!==this.layout?this.addGrid():this.hideGrid()),e.has(".regression")&&(this.removeRegression(),"clock"===this.layout&&"num_date"===this.distance&&this.drawRegression()),a.removeConfidences&&this.confidencesInSVG?this.removeConfidence():a.showConfidences&&!this.confidencesInSVG?this.drawConfidence():e.has(".conf")&&this.confidencesInSVG&&("rect"===this.layout&&"num_date"===this.distance?(i=fe(".conf",t),ge(this.svg,".conf",i,n)):this.removeConfidence()),a.timeSliceHasPotentiallyChanged&&this.addTemporalSlice(),a.newBranchLabellingKey&&(this.removeBranchLabels(),"none"!==a.newBranchLabellingKey&&this.drawBranchLabels(a.newBranchLabellingKey))},Se.prototype.modifySVGInStages=function(e,t,n,a){var i=this;e.delete(".tip"),this.hideGrid();var r=0,o=function(){i.drawBranches(),i.params.showGrid&&i.addGrid(),i.svg.selectAll(".tip").remove(),i.drawTips(),i.updateTipLabels(),i.vaccines&&i.drawVaccines(),i.addTemporalSlice(),"clock"===i.layout&&"num_date"===i.distance&&i.drawRegression(),e.has(".branchLabel")&&i.drawBranchLabels(i.params.branchLabelKey)};this.confidencesInSVG=!1,this.svg.selectAll(M()(e).join(", ")).transition().duration(n).style("opacity",0).remove().on("start",(function(){return r++})).on("end",(function(){if(!--r){var e=fe(".tip",t);ge(i.svg,".tip",e,a),setTimeout(o,a)}})),this.removeTemporalSlice(),n||Object(he.d)()},Se.prototype.render=function(e,t,n,a,i,r,o,s,l,c,d,h,p,u){var m=this;this.svg=e,this.params=Object.assign(this.params,a),this.callbacks=i,this.vaccines=l?l.map((function(e){return e.shell})):void 0,this.dateRange=u,this.setDistance(n),this.setLayout(t),this.mapToScreen(),this.nodes.forEach((function(e,t){e.branchStroke=c[t],e.tipStroke=d[t],e.fill=h[t],e.visibility=o[t],e["stroke-width"]=r[t],e.r=p?p[t]:m.params.tipRadius})),this.params.showGrid&&(this.addGrid(),this.addTemporalSlice()),this.drawBranches(),this.drawTips(),this.params.branchLabelKey&&this.drawBranchLabels(this.params.branchLabelKey),this.vaccines&&this.drawVaccines(),"clock"===this.layout&&"num_date"===this.distance&&this.drawRegression(),this.confidencesInSVG=!1,s&&this.drawConfidence(),this.updateTipLabels(),this.timeLastRenderRequested=Date.now()},Se.prototype.clearSVG=function(){this.svg.selectAll("*").remove()},Se.prototype.drawTips=function(){var e=this.params;"tips"in this.groups||(this.groups.tips=this.svg.append("g").attr("id","tips")),this.groups.tips.selectAll(".tip").data(this.nodes.filter((function(e){return e.terminal}))).enter().append("circle").attr("class","tip").attr("id",(function(e){return Object(de.e)("tip",e.n.name)})).attr("cx",(function(e){return e.xTip})).attr("cy",(function(e){return e.yTip})).attr("r",(function(e){return e.r})).on("mouseover",this.callbacks.onTipHover).on("mouseout",this.callbacks.onTipLeave).on("click",this.callbacks.onTipClick).style("pointer-events","auto").style("visibility",(function(e){return e.visibility===N.NODE_VISIBLE?"visible":"hidden"})).style("fill",(function(t){return t.fill||e.tipFill})).style("stroke",(function(t){return t.tipStroke||e.tipStroke})).style("stroke-width",(function(){return e.tipStrokeWidth})).style("cursor","pointer")},Se.prototype.drawBranches=function(){var e=this.params;"branchTee"in this.groups||(this.groups.branchTee=this.svg.append("g").attr("id","branchTee")),"clock"===this.layout||"unrooted"===this.layout?this.groups.branchTee.selectAll("*").remove():this.groups.branchTee.selectAll(".branch").data(this.nodes.filter((function(e){return!e.terminal}))).enter().append("path").attr("class","branch T").attr("id",(function(e){return Object(de.e)("branchT",e.n.name)})).attr("d",(function(e){return e.branch[1]})).style("stroke",(function(t){return t.branchStroke||e.branchStroke})).style("stroke-width",(function(t){return t["stroke-width"]||e.branchStrokeWidth})).style("fill","none").style("pointer-events","auto"),"branchStem"in this.groups||(this.groups.branchStem=this.svg.append("g").attr("id","branchStem")),this.groups.branchStem.selectAll(".branch").data(this.nodes).enter().append("path").attr("class","branch S").attr("id",(function(e){return Object(de.e)("branchS",e.n.name)})).attr("d",(function(e){return e.branch[0]})).style("stroke",(function(t){return t.branchStroke||e.branchStroke})).style("stroke-linecap","round").style("stroke-width",(function(e){return e["stroke-width"]+"px"||!1})).style("fill","none").style("visibility",ue).style("cursor",(function(e){return e.visibility===N.NODE_VISIBLE?"pointer":"default"})).style("pointer-events","auto").on("mouseover",this.callbacks.onBranchHover).on("mouseout",this.callbacks.onBranchLeave).on("click",this.callbacks.onBranchClick)},Se.prototype.drawVaccines=function(){this.vaccines&&this.vaccines.length&&("vaccines"in this.groups||(this.groups.vaccines=this.svg.append("g").attr("id","vaccines")),this.groups.vaccines.selectAll(".vaccineCross").data(this.vaccines).enter().append("path").attr("class","vaccineCross").attr("d",(function(e){return e.vaccineCross})).style("stroke","#333").style("stroke-width",2*this.params.branchStrokeWidth).style("fill","none").style("cursor","pointer").style("pointer-events","auto").on("mouseover",this.callbacks.onTipHover).on("mouseout",this.callbacks.onTipLeave).on("click",this.callbacks.onTipClick))},Se.prototype.drawRegression=function(){var e=this.yScale(this.regression.intercept+this.xScale.domain()[0]*this.regression.slope),t=this.yScale(this.regression.intercept+this.xScale.domain()[1]*this.regression.slope),n="M "+this.xScale.range()[0].toString()+" "+e.toString()+" L "+this.xScale.range()[1].toString()+" "+t.toString();"clockRegression"in this.groups||(this.groups.clockRegression=this.svg.append("g").attr("id","clockRegression")),this.groups.clockRegression.append("path").attr("d",n).attr("class","regression").style("fill","none").style("visibility","visible").style("stroke",this.params.regressionStroke).style("stroke-width",this.params.regressionWidth),this.groups.clockRegression.append("text").text(function(e,t){if(t>5)return"rate estimate: ".concat(Object(de.d)(e.slope)," subs per year");return"rate estimate: ".concat(e.slope.toExponential(2)," subs per site per year")}(this.regression,this.yScale.domain()[0])).attr("class","regression").attr("x",this.xScale.range()[1]/2-75).attr("y",this.yScale.range()[0]+50).style("fill",this.params.regressionStroke).style("font-size",this.params.tickLabelSize+8).style("font-weight",400).style("font-family",this.params.fontFamily)},Se.prototype.removeRegression=function(){"clockRegression"in this.groups&&this.groups.clockRegression.selectAll("*").remove()},Se.prototype.setDistance=function(e){this.nodes.forEach((function(e){e.update=!0})),this.distance=e||"div","div"===this.distance?this.nodes.forEach((function(e){e.depth=Object(W.getDivFromNode)(e.n),e.pDepth=Object(W.getDivFromNode)(e.n.parent),e.conf=[e.depth,e.depth]})):this.nodes.forEach((function(e){e.depth=Object(W.getTraitFromNode)(e.n,"num_date"),e.pDepth=Object(W.getTraitFromNode)(e.n.parent,"num_date"),e.conf=Object(W.getTraitFromNode)(e.n,"num_date",{confidence:!0})||[e.depth,e.depth]})),this.vaccines&&this.vaccines.forEach((function(e){e.crossDepth=e.depth}))},Se.prototype.setLayout=function(e){void 0!==e&&e===this.layout||this.nodes.forEach((function(e){e.update=!0})),this.layout=void 0===e?"rect":e,"rect"===this.layout?this.rectangularLayout():"clock"===this.layout?this.timeVsRootToTip():"radial"===this.layout?this.radialLayout():"unrooted"===this.layout&&this.unrootedLayout()},Se.prototype.rectangularLayout=function(){this.nodes.forEach((function(e){e.y=e.n.yvalue,e.x=e.depth,e.px=e.pDepth,e.py=e.y})),this.vaccines&&this.vaccines.forEach((function(e){e.xCross=e.crossDepth,e.yCross=e.y}))},Se.prototype.timeVsRootToTip=function(){this.nodes.forEach((function(e){e.y=Object(W.getDivFromNode)(e.n),e.x=Object(W.getTraitFromNode)(e.n,"num_date"),e.px=Object(W.getTraitFromNode)(e.n.parent,"num_date"),e.py=Object(W.getDivFromNode)(e.n.parent)})),this.vaccines&&this.vaccines.forEach((function(e){e.xCross=e.x,e.yCross=e.y}));var e=this.numberOfTips,t=this.nodes[0].depth,n=Object(ve.h)(this.nodes.filter((function(e){return e.terminal})).map((function(e){return e.y*(e.depth-t)})))/e/(Object(ve.h)(this.nodes.filter((function(e){return e.terminal})).map((function(e){return(e.depth-t)*(e.depth-t)})))/e),a=-t*n;this.regression={slope:n,intercept:a}},Se.prototype.unrootedLayout=function(){Object(de.a)(this.nodes[0]);var e=this.nodes[0].leafCount;this.nodes.forEach((function(e){e.branchLength=e.depth-e.pDepth})),this.nodes[0].x=0,this.nodes[0].y=0,this.nodes[0].px=0,this.nodes[0].py=0,this.nodes[0].w=2*Math.PI,this.nodes[0].tau=0;for(var t=1.5*Math.PI,n=0;n<this.nodes[0].children.length;n++)this.nodes[0].children[n].px=0,this.nodes[0].children[n].py=0,this.nodes[0].children[n].w=2*Math.PI*this.nodes[0].children[n].leafCount/e,this.nodes[0].children[n].tau=t,t+=this.nodes[0].children[n].w,ye(this.nodes[0].children[n],e);this.vaccines&&this.vaccines.forEach((function(e){var t=e.crossDepth-e.depth;e.xCross=e.px+t*Math.cos(e.tau+.5*e.w),e.yCross=e.py+t*Math.sin(e.tau+.5*e.w)}))},Se.prototype.radialLayout=function(){var e=this,t=this.numberOfTips,n=this.nodes[0].depth;this.nodes.forEach((function(e){var a=1.9*Math.PI*e.yRange[0]/t,i=1.9*Math.PI*e.yRange[1]/t;e.angle=1.9*Math.PI*e.n.yvalue/t,e.y=(e.depth-n)*Math.cos(e.angle),e.x=(e.depth-n)*Math.sin(e.angle),e.py=e.y*(e.pDepth-n)/(e.depth-n+1e-15),e.px=e.x*(e.pDepth-n)/(e.depth-n+1e-15),e.yCBarStart=(e.depth-n)*Math.cos(a),e.xCBarStart=(e.depth-n)*Math.sin(a),e.yCBarEnd=(e.depth-n)*Math.cos(i),e.xCBarEnd=(e.depth-n)*Math.sin(i),e.smallBigArc=Math.abs(i-a)>1*Math.PI})),this.vaccines&&this.vaccines.forEach((function(t){"div"===e.distance?(t.xCross=t.x,t.yCross=t.y):(t.xCross=(t.crossDepth-n)*Math.sin(t.angle),t.yCross=(t.crossDepth-n)*Math.cos(t.angle))}))},Se.prototype.setScales=function(e){var t=parseInt(this.svg.attr("width"),10),n=parseInt(this.svg.attr("height"),10);if("radial"===this.layout||"unrooted"===this.layout){var a=t-(e.left||0)-(e.right||0),i=n-(e.top||0)-(e.top||0),r=Object(ve.e)([a,i]),o=a-r,s=i-r;this.xScale.range([.5*o+e.left||0,t-.5*o-(e.right||0)]),this.yScale.range([.5*s+e.top||0,n-.5*s-(e.bottom||0)])}else this.params.orientation[0]>0?this.xScale.range([e.left||0,t-(e.right||0)]):this.xScale.range([t-(e.right||0),e.left||0]),this.params.orientation[1]>0?this.yScale.range([e.top||0,n-(e.bottom||0)]):this.yScale.range([n-(e.bottom||0),e.top||0])},Se.prototype.mapToScreen=function(){var e=this,t={left:this.params.margins.left,right:this.params.margins.right,top:this.params.margins.top,bottom:this.params.margins.bottom},n=this.nodes.filter((function(e){return e.terminal})).filter((function(e){return e.inView}));if(n.length<this.params.tipLabelBreakL1){var a=this.params.tipLabelFontSizeL1;n.length<this.params.tipLabelBreakL2&&(a=this.params.tipLabelFontSizeL2),n.length<this.params.tipLabelBreakL3&&(a=this.params.tipLabelFontSizeL3);var i=0;n.forEach((function(e){i<e.n.name.length&&(i=.65*e.n.name.length*a)})),t.right+=i}this.setScales(t);var r=1e6,o=0,s=1e6,l=0;if(this.nodes.filter((function(e){return e.inView})).forEach((function(e){e.x>l&&(l=e.x),e.y>o&&(o=e.y),e.x<s&&(s=e.x),e.y<r&&(r=e.y)})),s===l&&(s-=.005,l+=.005),n.length<30){var c=.05*(o-r);r-=c,o+=c}var d=l-s;if(d<1e-8&&(l=1e-8-s,d=1e-8),"radial"===this.layout||"unrooted"===this.layout){var h=o-r,p=Object(ve.d)([h,d]),u=d>h?.5*(d-h):0,m=d<h?.5*(h-d):0;this.xScale.domain([s-m,s+p-m]),this.yScale.domain([r-u,r+p-u])}else"clock"===this.layout?(this.xScale.domain([s,l]),this.yScale.domain([o,r])):(this.xScale.domain([s,l]),this.yScale.domain([r,o]));if(this.nodes.forEach((function(t){t.xTip=e.xScale(t.x),t.yTip=e.yScale(t.y),t.xBase=e.xScale(t.px),t.yBase=e.yScale(t.py)})),this.vaccines&&this.vaccines.forEach((function(t){var n=e.xScale(t.xCross),a=e.yScale(t.yCross);t.vaccineCross=" M ".concat(n-6,",").concat(a-6," L ").concat(n+6,",").concat(a+6," M ").concat(n-6,",").concat(a+6," L ").concat(n+6,",").concat(a-6)})),"clock"===this.layout||"unrooted"===this.layout)this.nodes.forEach((function(e){e.branch=[" M "+e.xBase.toString()+","+e.yBase.toString()+" L "+e.xTip.toString()+","+e.yTip.toString(),""]}));else if("rect"===this.layout)this.nodes.forEach((function(t){var n=.5*(t.parent["stroke-width"]-t["stroke-width"])||0,a=[e.yScale(t.yRange[0]),e.yScale(t.yRange[1])];t.branch=[" M ".concat(t.xBase-n,",").concat(t.yBase," L ").concat(t.xTip,",").concat(t.yTip," M ").concat(t.xTip,",").concat(a[0]," L ").concat(t.xTip,",").concat(a[1])],e.params.confidence&&(t.confLine=" M ".concat(e.xScale(t.conf[0]),",").concat(t.yBase," L ").concat(e.xScale(t.conf[1]),",").concat(t.yTip))}));else if("radial"===this.layout){var f=this.nodes[0].depth,g=this.nodes.map((function(e){return.5*(e.parent["stroke-width"]-e["stroke-width"])||0}));this.nodes.forEach((function(t){t.cBarStart=e.yScale(t.yRange[0])})),this.nodes.forEach((function(t){t.cBarEnd=e.yScale(t.yRange[1])})),this.nodes.forEach((function(t,n){t.branch=[" M "+(t.xBase-g[n]*Math.sin(t.angle)).toString()+" "+(t.yBase-g[n]*Math.cos(t.angle)).toString()+" L "+t.xTip.toString()+" "+t.yTip.toString(),""],t.terminal||(t.branch[1]=[" M "+e.xScale(t.xCBarStart).toString()+" "+e.yScale(t.yCBarStart).toString()+" A "+(e.xScale(t.depth)-e.xScale(f)).toString()+" "+(e.yScale(t.depth)-e.yScale(f)).toString()+" 0 "+(t.smallBigArc?"1 ":"0 ")+" 1  "+e.xScale(t.xCBarEnd).toString()+","+e.yScale(t.yCBarEnd).toString()])}))}},Se.prototype.removeConfidence=function(e){this.confidencesInSVG=!1,"confidenceIntervals"in this.groups&&(e?this.groups.confidenceIntervals.selectAll("*").transition().duration(e).style("opacity",0).remove():this.groups.confidenceIntervals.selectAll("*").remove())},Se.prototype.drawConfidence=function(e){var t=this;this.confidencesInSVG=!0,"confidenceIntervals"in this.groups||(this.groups.confidenceIntervals=this.svg.append("g").attr("id","confidenceIntervals")),e?(this.groups.confidenceIntervals.selectAll(".conf").data(this.nodes).enter().call((function(e){return t.drawSingleCI(e,0)})),this.groups.confidenceIntervals.transition().duration(e).style("opacity",.5)):this.groups.confidenceIntervals.selectAll(".conf").data(this.nodes).enter().call((function(e){return t.drawSingleCI(e,.5)}))},Se.prototype.drawSingleCI=function(e,t){e.append("path").attr("class","conf").attr("id",(function(e){return Object(de.e)("conf",e.n.name)})).attr("d",(function(e){return e.confLine})).style("stroke",(function(e){return e.branchStroke||"#888"})).style("opacity",t).style("fill","none").style("stroke-width",pe).style("pointer-events","none")},Se.prototype.drawBranchLabels=function(e){var t=this;this.params.branchLabelKey=e;var n=ke(e),a=Ee(e),i=Te(e,this.layout,this.zoomNode.n.tipCount);"branchLabels"in this.groups||(this.groups.branchLabels=this.svg.append("g").attr("id","branchLabels")),this.groups.branchLabels.selectAll(".branchLabel").data(this.nodes.filter((function(t){return t.n.branch_attrs&&t.n.branch_attrs.labels&&t.n.branch_attrs.labels[e]}))).enter().append("text").attr("class","branchLabel").attr("x",(function(e){return e.xTip+(t.params.orientation[0]>0?-5:5)})).attr("y",(function(e){return e.yTip-t.params.branchLabelPadY})).style("text-anchor",this.params.orientation[0]>0?"end":"start").style("visibility",i).style("fill",this.params.branchLabelFill).style("font-family",this.params.branchLabelFont).style("font-weight",a).style("font-size",n).text((function(t){return t.n.branch_attrs.labels[e]}))},Se.prototype.removeBranchLabels=function(){"branchLabels"in this.groups&&this.groups.branchLabels.selectAll("*").remove()},Se.prototype.updateBranchLabels=function(e){var t=this,n=Te(this.params.branchLabelKey,this.layout,this.zoomNode.n.tipCount),a=ke(this.params.branchLabelKey),i=Ee(this.params.branchLabelKey);this.groups.branchLabels.selectAll(".branchLabel").transition().duration(e).attr("x",(function(e){return e.xTip-5})).attr("y",(function(e){return e.yTip-t.params.branchLabelPadY})).style("visibility",n).style("font-weight",i).style("font-size",a),e||Object(he.d)()},Se.prototype.updateTipLabels=function(e){var t=this;"tipLabels"in this.groups?this.groups.tipLabels.selectAll("*").remove():this.groups.tipLabels=this.svg.append("g").attr("id","tipLabels");var n=this.callbacks.tipLabel,a=this.params.tipLabelPadX,i=this.params.tipLabelPadY,r=this.nodes.filter((function(e){return e.terminal})).filter((function(e){return e.inView}));if(r.length<this.params.tipLabelBreakL1){var o=this.params.tipLabelFontSizeL1;r.length<this.params.tipLabelBreakL2&&(o=this.params.tipLabelFontSizeL2),r.length<this.params.tipLabelBreakL3&&(o=this.params.tipLabelFontSizeL3),window.setTimeout((function(){t.groups.tipLabels.selectAll(".tipLabel").data(r).enter().append("text").attr("x",(function(e){return e.xTip+a})).attr("y",(function(e){return e.yTip+i})).text((function(e){return n(e)})).attr("class","tipLabel").style("font-size",o.toString()+"px").style("visibility",(function(e){return e.visibility===N.NODE_VISIBLE?"visible":"hidden"}))}),e)}},Se.prototype.removeTipLabels=function(){"tipLabels"in this.groups&&this.groups.tipLabels.selectAll("*").remove()},Se.prototype.hideGrid=function(){"majorGrid"in this.groups&&this.groups.majorGrid.selectAll("*").style("visibility","hidden"),"minorGrid"in this.groups&&this.groups.minorGrid.selectAll("*").style("visibility","hidden"),"gridText"in this.groups&&this.groups.gridText.selectAll("*").style("visibility","hidden"),"axisText"in this.groups&&this.groups.axisText.selectAll("*").style("visibility","hidden")},Se.prototype.addGrid=function(){var e,t,n=this.layout;if(e=this.groups,t=this.svg,"temporalWindow"in e||(e.temporalWindow=t.append("g").attr("id","temporalWindow")),"majorGrid"in e||(e.majorGrid=t.append("g").attr("id","majorGrid")),"minorGrid"in e||(e.minorGrid=t.append("g").attr("id","minorGrid")),"gridText"in e||(e.gridText=t.append("g").attr("id","gridText")),"axisText"in e||(e.axisText=t.append("g").attr("id","axisText")),"unrooted"!==n){var a,i=Object(ve.e)(this.yScale.domain()),r=Object(ve.d)(this.yScale.domain()),o="radial"===n?this.nodes[0].depth:this.xScale.domain()[0],s="radial"===n?o+Object(ve.d)([this.xScale.domain()[1],this.yScale.domain()[1],-this.xScale.domain()[0],-this.yScale.domain()[0]]):this.xScale.domain()[1],l=this.xScale.range()[1]-this.xScale.range()[0],c=xe(o,s,n,this.distance,this.params.minorTicks,l),d=c.majorGridPoints,h=c.minorGridPoints,p=function(e,t,n){return function(a){var i="";if("x"===a.axis){if("rect"===n||"clock"===n){var r=e(a.position);i="M"+r.toString()+" "+t.range()[1].toString()+" L "+r.toString()+" "+t.range()[0].toString()}else if("radial"===n){var l=e(a.position-o);i="M "+l.toString()+"  "+t(0).toString()+" A "+(l-e(0)).toString()+" "+(t(a.position)-t(o)).toString()+" 0 1 0 "+l.toString()+" "+(t(0)+.001).toString()}}else if("y"===a.axis){var c=t(a.position);i="M".concat(e(o)+20," ").concat(c," L ").concat(e(s)," ").concat(c)}return i}};if("clock"===this.layout&&d.push.apply(d,M()(function(e,t){var n,a=[];n=be(t-e)[0];for(var i=Math.max(0,-Math.floor(Math.log10(n))),r=Math.floor(e/n)*n,o=t,s=r,l=1;l<=(t-r)/n+10;l++){var c=r+n*l;a.push({position:c,name:c.toFixed(i),visibility:c<s||c>o?"hidden":"visible",axis:"y"})}return{majorGridPoints:a}}(i,r).majorGridPoints)),this.groups.majorGrid.selectAll("*").remove(),this.groups.majorGrid.selectAll(".majorGrid").data(d).enter().append("path").attr("d",p(this.xScale,this.yScale,n)).attr("class","majorGrid").style("fill","none").style("visibility",(function(e){return e.visibility})).style("stroke",this.params.majorGridStroke).style("stroke-width",this.params.majorGridWidth),this.groups.minorGrid.selectAll("*").remove(),this.svg.selectAll(".minorGrid").remove(),this.groups.minorGrid.selectAll(".minorGrid").data(h).enter().append("path").attr("d",p(this.xScale,this.yScale,n)).attr("class","minorGrid").style("fill","none").style("visibility",(function(e){return e.visibility})).style("stroke",this.params.minorGridStroke).style("stroke-width",this.params.minorGridWidth),this.groups.gridText.selectAll("*").remove(),this.svg.selectAll(".gridText").remove(),this.groups.gridText.selectAll(".gridText").data(d).enter().append("text").text((function(e){return e.name})).attr("class","gridText").style("font-size",this.params.tickLabelSize).style("font-family",this.params.fontFamily).style("fill",this.params.tickLabelFill).style("text-anchor",(a=n,function(e){return"x"===e.axis?"radial"===a?"end":"middle":"start"})).style("visibility",(function(e){return e.visibility})).attr("x",function(e,t){return function(n){return"x"===n.axis?e("radial"===t?0:n.position):e.range()[0]-15}}(this.xScale,n)).attr("y",function(e,t){return function(n){return"x"===n.axis?"radial"===t?e(n.position-o)-5:e.range()[1]+18:e(n.position)}}(this.yScale,n)),this.groups.axisText.selectAll("*").remove(),this.svg.selectAll(".axisText").remove(),"rect"===n||"clock"===n){var u="Date";"clock"===this.layout?u=this.yScale.domain()[0]>5?"Mutations":"Divergence":"div"===this.distance&&(u=this.xScale.domain()[1]>5?"Mutations":"Divergence"),this.groups.axisText.append("text").text("rect"===n?u:"Date").attr("class","gridText").style("font-size",this.params.tickLabelSize).style("font-family",this.params.fontFamily).style("fill",this.params.tickLabelFill).style("text-anchor","middle").attr("x",Math.abs(this.xScale.range()[1]-this.xScale.range()[0])/2).attr("y",this.yScale.range()[1]+this.params.margins.bottom-6),"clock"===n&&this.groups.axisText.append("text").text(u).attr("class","gridText").style("font-size",this.params.tickLabelSize).style("font-family",this.params.fontFamily).style("fill",this.params.tickLabelFill).style("text-anchor","middle").attr("transform","translate(10,"+this.yScale.range()[1]/2+") rotate(-90)")}this.grid=!0}},Se.prototype.addTemporalSlice=function(){if(this.removeTemporalSlice(),"rect"===this.layout&&"num_date"===this.distance){var e=[this.xScale(this.dateRange[0]),this.xScale(this.dateRange[1])],t=this.yScale.range()[1],n=-1===this.params.orientation[0],a=this.xScale(this.nodes[0].x),i=n?this.xScale.range()[0]:this.xScale.range()[1];i+=this.params.margins.left+this.params.margins.right,Math.abs(e[0]-a)>30&&this.groups.temporalWindow.append("rect").attr("x",n?e[0]:0).attr("width",n?i-e[0]:e[0]).attr("y",0).attr("height",t).attr("fill","#EEE");var r=n?this.params.margins.right:e[1],o=n?e[1]-this.params.margins.right:i-this.params.margins.right-e[1];o>30&&this.groups.temporalWindow.append("rect").attr("x",r).attr("width",o).attr("y",0).attr("height",t).attr("fill","#EEE")}},Se.prototype.removeTemporalSlice=function(){this.groups.temporalWindow.selectAll("*").remove()};var Ce=Se,Oe=n(34),je=function(e){var t=e.name,n=e.value,a=e.padBelow,i=void 0!==a&&a;return y.a.createElement("div",{style:{paddingBottom:i?"15px":"10px"},key:t},y.a.createElement("span",{style:{fontWeight:"500"}},t+" "),n?Array.isArray(n)?n.map((function(e){return y.a.createElement("div",{key:e,style:{fontWeight:"300",marginLeft:"0em"}},e)})):y.a.createElement("span",{style:{fontWeight:"300"}},n):null)},Ne=function(e){var t=e.name;return y.a.createElement("div",{style:E.e.tooltipHeading},t)},De=function(e){var t=e.node,n=[],a=Object(W.getDivFromNode)(t),i=Object(W.getTraitFromNode)(t,"num_date");if(a&&n.push(y.a.createElement(je,{name:"Divergence:",value:Object(de.d)(a),key:"div"})),void 0!==i){var r=Object(j.numericToCalendar)(i),o=Object(W.getTraitFromNode)(t,"num_date",{confidence:!0});if(o&&o[0]!==o[1]){n.push(y.a.createElement(je,{name:"Inferred Date:",value:r,key:"inferredDate"}));var s=[Object(j.numericToCalendar)(o[0]),Object(j.numericToCalendar)(o[1])];s[0]!==s[1]&&n.push(y.a.createElement(je,{name:"Date Confidence Interval:",value:"(".concat(s[0],", ").concat(s[1],")"),key:"dateConf"}))}else n.push(y.a.createElement(je,{name:"Date:",value:r,key:"date"}))}return n},Me=function(e){var t=e.node,n=e.colorBy,a=e.colorByConfidence,i=e.colorScale,r=e.colorings;if("num_date"===n)return null;if(Object(se.isColorByGenotype)(n)){var o=Object(se.decodeColorByGenotype)(n),s=o.aa?"Amino Acid at ".concat(o.gene," site ").concat(o.positions.join(", "),":"):"Nucleotide at pos ".concat(o.positions.join(", "),":");return y.a.createElement(je,{name:s,value:Object(Oe.getTipColorAttribute)(t,i)})}if("author"===n){var l=Object(W.getFullAuthorInfoFromNode)(t);return l?y.a.createElement(y.a.Fragment,null,l.title?y.a.createElement(je,{name:"Title:",value:l.title}):null,l.journal?y.a.createElement(je,{name:"Journal:",value:l.journal}):null):null}var c=r&&r[n]&&r[n].title?r[n].title:n,d=function(){var e=Object(W.getTraitFromNode)(t,n);return Object(N.isValueValid)(e)?y.a.createElement(je,{name:"".concat(c,":"),value:e}):null};if(!0===a){var h=Object(W.getTraitFromNode)(t,n,{confidence:!0});if(!h)return console.error("couldn't find confidence vals for ",n),null;if(!t.hasChildren&&1===Object.keys(h).length&&Object.values(h)[0]>.99)return d();var p=Object.keys(h).filter((function(e){return Object(N.isValueValid)(e)})).sort((function(e,t){return h[e]>h[t]?-1:1})).slice(0,4).map((function(e){return"".concat(e," (").concat((100*h[e]).toFixed(0),"%)")}));return p.length?y.a.createElement(je,{name:"".concat(c," (confidence):"),value:p}):null}return d()},Le=function(e){var t=e.node;if(!t.branch_attrs||!t.branch_attrs.mutations)return null;var n=[],a=t.branch_attrs.mutations;if(a.nuc&&a.nuc.length){var i=function(e){return"-"===e.slice(-1)||"-"===e.slice(0,1)},r=function(e){return"N"===e.slice(-1)||"N"===e.slice(0,1)},o=a.nuc.filter((function(e){return!i(e)&&!r(e)})),s=o.length,l=o.slice(0,Math.min(9,s)).join(", ");l+=s>9?" + "+(s-9)+" more":"",0!==s&&n.push(y.a.createElement(je,{name:"Nucleotide mutations:",value:l,key:"nuc"}));var c=a.nuc.filter((function(e){return i(e)})).length;c&&n.push(y.a.createElement(je,{name:'Gaps ("-"):',value:c,key:"gaps"}));var d=a.nuc.filter((function(e){return r(e)})).length;d&&n.push(y.a.createElement(je,{name:"Ns:",value:d,key:"Ns"}))}else n.push(y.a.createElement(je,{name:"No nucleotide mutations",value:"",key:"nuc"}));var h=Object.keys(a).filter((function(e){return"nuc"!==e})),p={},u=!1,m=!0,f=!1,g=void 0;try{for(var v,b=h[Symbol.iterator]();!(m=(v=b.next()).done);m=!0){var w=v.value,x=a[w].filter((function(e){return!e.endsWith("X")}));x.length&&(p[w]=x,u=!0)}}catch(e){f=!0,g=e}finally{try{m||null==b.return||b.return()}finally{if(f)throw g}}if(u){var k=[];Object.keys(p).forEach((function(e,t){if(t<7){var n=e+":"+p[e].slice(0,Math.min(3,p[e].length)).join(", ");p[e].length>3&&(n+=" + "+(p[e].length-3)+" more"),k.push(n)}else 7===t&&k.push("(protein mutations truncated)")})),n.push(y.a.createElement(je,{name:"AA mutations:",value:k,key:"aa"}))}else a.nuc&&a.nuc.length&&n.push(y.a.createElement(je,{name:"No amino acid mutations",key:"aa"}));return n},Ie=function(e){var t=e.node,n=1===t.fullTipCount?["Branch leading to",t.name]:["Number of descendants:",t.fullTipCount],a=ie()(n,2),i=a[0],r=a[1];return y.a.createElement(je,{name:i,value:r,padBelow:!0})},Be=function(e){var t=e.node,n=Object(W.getVaccineFromNode)(t);if(!n)return null;var a=[];return n.selection_date&&a.push(y.a.createElement(je,{name:"Vaccine selected:",value:n.selection_date,key:"seldate"})),n.start_date&&a.push(y.a.createElement(je,{name:"Vaccine start date:",value:n.start_date,key:"startdate"})),n.end_date&&a.push(y.a.createElement(je,{name:"Vaccine end date:",value:n.end_date,key:"enddate"})),n.serum&&a.push(y.a.createElement(je,{name:"Serum strain",key:"serum"})),a},_e=function(e){var t=e.node,n=[],a=Object(W.getFullAuthorInfoFromNode)(t);a&&n.push(y.a.createElement(je,{name:"Author:",value:a.value,key:"author"}));var i=Object(W.getTraitFromNode)(t,"gisaid_epi_isl");if(Object(N.isValueValid)(i)){var r=i.split("_")[2];n.push(y.a.createElement(je,{name:"GISAID EPI ISL:",value:r,key:"gisaid_epi_isl"}))}return n},Pe=function(e){var t=e.node,n=e.panelDims,a=e.children,i=-1===t.shell.that.params.orientation[0]?n.width/2+n.spaceBetweenTrees+t.shell.xTip:t.shell.xTip,r=t.shell.yTip,o={container:{position:"absolute",width:200,padding:"10px",borderRadius:10,zIndex:1e3,pointerEvents:"none",fontFamily:E.e.panel.fontFamily,fontSize:14,lineHeight:1,fontWeight:E.e.panel.fontWeight,color:E.e.panel.color,backgroundColor:E.e.panel.backgroundColor,wordWrap:"break-word",wordBreak:"break-word"}};return i<.6*n.width?o.container.left=i+10:o.container.right=n.width-i+10,r<.55*n.height?o.container.top=r+40:o.container.bottom=n.height-r+10,y.a.createElement("div",{style:o.container},y.a.createElement("div",{className:"tooltip",style:E.e.tooltip},a))},Ae=function(e){var t=e.children;return y.a.createElement("div",{style:E.e.comment},t)},Re=function(e){var t=e.hovered,n=e.colorBy,a=e.colorByConfidence,i=e.colorScale,r=e.panelDims,o=e.colorings;if(!t)return null;var s=t.d.n;return y.a.createElement(Pe,{node:s,panelDims:r},".tip"===t.type?y.a.createElement(y.a.Fragment,null,y.a.createElement(Ne,{name:s.name}),y.a.createElement(Be,{node:s}),y.a.createElement(Le,{node:s}),y.a.createElement(De,{node:s}),y.a.createElement(Me,{node:s,colorBy:n,colorByConfidence:a,colorScale:i,colorings:o}),y.a.createElement(_e,{node:s}),y.a.createElement(Ae,null,"Click on tip to display more info")):y.a.createElement(y.a.Fragment,null,y.a.createElement(Ie,{node:s}),y.a.createElement(Le,{node:s}),y.a.createElement(De,{node:s}),y.a.createElement(Me,{node:s,colorBy:n,colorByConfidence:a,colorScale:i,colorings:o}),y.a.createElement(Ae,null,"Click to zoom into clade")))},Fe=function(e,t,n,a){var i={},r={},o=e?n.tree:n.treeToo,s=e?a.tree:a.treeToo;if(t.dateRange=[a.dateMinNumeric,a.dateMaxNumeric],o.selectedStrain&&!s.selectedStrain&&(r.selectedTip=null,r.hovered=null),!s.nodeColorsVersion||o.nodeColorsVersion===s.nodeColorsVersion&&a.colorByConfidence===n.colorByConfidence||(i.changeColorBy=!0,i.branchStroke=Object(Oe.calcBranchStrokeCols)(s,a.colorByConfidence,a.colorBy),i.tipStroke=s.nodeColors,i.fill=s.nodeColors.map((function(e){return Object(re.f)(e).brighter([.65]).toString()}))),s.visibilityVersion&&o.visibilityVersion!==s.visibilityVersion&&(i.changeVisibility=!0,i.visibility=s.visibility),s.tipRadiiVersion&&o.tipRadiiVersion!==s.tipRadiiVersion&&(i.changeTipRadii=!0,i.tipRadii=s.tipRadii),o.branchThicknessVersion!==s.branchThicknessVersion&&(i.changeBranchThickness=!0,i.branchThickness=s.branchThickness),n.distanceMeasure!==a.distanceMeasure&&(i.newDistance=a.distanceMeasure),n.selectedBranchLabel!==a.selectedBranchLabel&&(i.newBranchLabellingKey=a.selectedBranchLabel),!0===n.temporalConfidence.display&&!1===a.temporalConfidence.display?i.removeConfidences=!0:!0===n.temporalConfidence.on&&!1===a.temporalConfidence.on?i.removeConfidences=!0:!0===a.temporalConfidence.display&&!1===n.temporalConfidence.on&&!0===a.temporalConfidence.on&&(i.showConfidences=!0),n.layout!==a.layout&&(i.newLayout=a.layout),o.idxOfInViewRootNode!==s.idxOfInViewRootNode){var l=t.nodes[s.idxOfInViewRootNode];i.zoomIntoClade=l,r.selectedBranch=0===s.idxOfInViewRootNode?null:l,r.selectedTip=null,r.hovered=null,"unrooted"===a.layout&&(i.updateLayout=!0)}n.width===a.width&&n.height===a.height||(i.svgHasChangedDimensions=!0),e&&n.showTreeToo!==a.showTreeToo&&(i.svgHasChangedDimensions=!0);var c=Object.keys(i).length;return c&&(i.animationInProgress="Pause"===a.animationPlayPauseButton,t.change(i)),[!!Object.keys(r).length&&r,c]},ze=n(19),Ve=function(e){e.visibility===N.NODE_VISIBLE&&((1===e.that.params.orientation[0]?this.state.tree:this.state.treeToo).svg.select(Object(de.e)("#tip",e.n.name)).attr("r",(function(e){return e.r+4})),this.setState({hovered:{d:e,type:".tip"}}))},We=function(e){if(e.visibility===N.NODE_VISIBLE&&!this.props.narrativeMode){this.setState({hovered:null,selectedTip:e});var t=1===e.that.params.orientation[0]?{treeIdx:e.n.arrayIdx}:{treeTooIdx:e.n.arrayIdx};this.props.dispatch(Object(C.f)({tipSelected:t,cladeSelected:this.props.tree.selectedClade}))}},Ge=function(e){var t=this;if(e.visibility===N.NODE_VISIBLE){for(var n=0,a=[Object(de.e)("#branchS",e.n.name),Object(de.e)("#branchT",e.n.name)];n<a.length;n++){var i=a[n];this.props.colorByConfidence?this.state.tree.svg.select(i).style("stroke",(function(e){var n=Object(W.getTraitFromNode)(t.props.tree.nodes[e.n.arrayIdx],t.props.colorBy,{entropy:!0}),a=Object(Oe.branchOpacityFunction)(n),i=t.props.tree.nodeColors[e.n.arrayIdx],r=e.branchStroke;return Object(re.f)(Object(ze.e)(i,r)(a)).toString()})):this.state.tree.svg.select(i).style("stroke",(function(e){return t.props.tree.nodeColors[e.n.arrayIdx]}))}if(this.props.temporalConfidence.exists&&this.props.temporalConfidence.display&&!this.props.temporalConfidence.on){var r=1===e.that.params.orientation[0]?this.state.tree:this.state.treeToo;"confidenceIntervals"in r.groups||(r.groups.confidenceIntervals=r.svg.append("g").attr("id","confidenceIntervals")),r.groups.confidenceIntervals.selectAll(".conf").data([e]).enter().call((function(e){return r.drawSingleCI(e,.5)}))}this.setState({hovered:{d:e,type:".branch"}})}},He=function(e){if(e.visibility===N.NODE_VISIBLE&&!this.props.narrativeMode){var t,n,a=[void 0,void 0];if(e.n.branch_attrs&&void 0!==e.n.branch_attrs.labels&&(n=Object.keys(e.n.branch_attrs.labels).filter((function(e){return"aa"!==e}))),n&&n.length){var i=this.props.tree.availableBranchLabels;n.sort((function(e,t){return i.indexOf(e)-i.indexOf(t)}));var r=n[0];t="".concat(r,":").concat(e.n.branch_attrs.labels[r])}1===e.that.params.orientation[0]?a[0]=e.n.arrayIdx:a[1]=e.n.arrayIdx,this.props.dispatch(Object(C.f)({root:a,cladeSelected:t}))}},qe=function(e){for(var t=0,n=[Object(de.e)("#branchT",e.n.name),Object(de.e)("#branchS",e.n.name)];t<n.length;t++){var a=n[t];this.state.tree.svg.select(a).style("stroke",(function(e){return e.branchStroke}))}this.props.temporalConfidence.exists&&this.props.temporalConfidence.display&&!this.props.temporalConfidence.on&&(1===e.that.params.orientation[0]?this.state.tree:this.state.treeToo).removeConfidence();this.state.hovered&&this.setState({hovered:null})},Ue=function(e){var t=1===e.that.params.orientation[0]?this.state.tree:this.state.treeToo;this.state.selectedTip||t.svg.select(Object(de.e)("#tip",e.n.name)).attr("r",(function(e){return e.r})),this.state.hovered&&this.setState({hovered:null})},Xe=function(e){(1===e.that.params.orientation[0]?this.state.tree:this.state.treeToo).svg.select(Object(de.e)("#tip",e.n.name)).attr("r",(function(e){return e.r})),this.setState({selectedTip:null,hovered:null}),this.props.dispatch(Object(C.f)({tipSelected:{clear:!0},cladeSelected:this.props.tree.selectedClade}))},Ke=n(499),Je=(n(503),function(e,t,n,a){var i=t?e.domRefs.mainTree:e.domRefs.secondTree,r=t?a.tree:a.treeToo;r.loaded?n.render(Object(Ke.f)(i),a.layout,a.distanceMeasure,{grid:!0,confidence:a.temporalConfidence.display,branchLabelKey:a.selectedBranchLabel,orientation:t?[1,1]:[-1,1],tipLabels:!0,showTipLabels:!0},{onTipHover:Ve.bind(e),onTipClick:We.bind(e),onBranchHover:Ge.bind(e),onBranchClick:He.bind(e),onBranchLeave:qe.bind(e),onTipLeave:Ue.bind(e),tipLabel:function(e){return e.n.name}},r.branchThickness,r.visibility,a.temporalConfidence.on,r.vaccines,Object(Oe.calcBranchStrokeCols)(r,a.colorByConfidence,a.colorBy),r.nodeColors,r.nodeColors.map((function(e){return Object(re.f)(e).brighter([.65]).toString()})),r.tipRadii,[a.dateMinNumeric,a.dateMaxNumeric]):console.warn("can't run renderTree (not loaded)")});function Ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ye(n,!0).forEach((function(t){g()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ye(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $e=function(e){function t(e){var n;return i()(this,t),(n=l()(this,d()(t).call(this,e))).state={left:0,top:31,lookup:void 0,drawn:!1},n.timeout=!1,n}return m()(t,e),o()(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.width!==e.width||this.props.height!==e.height||this.props.leftTreeName!==e.leftTreeName||this.props.rightTreeName!==e.rightTreeName}},{key:"drawLines",value:function(e){e||(e=this.props);var t=e.lookup.length>750?.25:e.lookup.length>100?.5:1;Object(Ke.f)(this.d3ref).selectAll("*").remove();var n=function(e){return function(t){var n=e.leftNodes[t[0]].shell,a=e.rightNodes[t[1]].shell;return"M ".concat(n.xTip,",").concat(n.yTip," H ").concat(e.width/2-e.spaceBetweenTrees/2," L ").concat(e.width/2+e.spaceBetweenTrees/2,",").concat(a.yTip," H ").concat(e.width/2+e.spaceBetweenTrees/2+a.xTip)}}(e);Object(Ke.f)(this.d3ref).selectAll(".tangleLine").data(e.lookup).enter().append("path").attr("class","tangleLine").attr("d",n).attr("stroke-width",t).attr("stroke",(function(t){return e.colors[t[0]]})).attr("fill","none")}},{key:"componentWillReceiveProps",value:function(e){!this.state.drawn&&e.rightNodes[0].shell&&(this.drawLines(e),this.setState({drawn:!0}))}},{key:"componentDidMount",value:function(){!this.state.drawn&&this.props.rightNodes[0].shell&&(this.drawLines(this.props),this.setState({drawn:!0}))}},{key:"componentDidUpdate",value:function(e){this.props.width===e.width&&this.props.height===e.height||(this.timeout?window.clearTimeout(this.timeout):Object(Ke.f)(this.d3ref).selectAll(".tangleLine").remove(),this.timeout=window.setTimeout(this.drawLines.bind(this),1e3))}},{key:"render",value:function(){var e=this,t={position:"absolute",top:5,zIndex:100,fontSize:16,color:"#000",fontWeight:500},n=[this.props.width/2-this.props.spaceBetweenTrees/2,this.props.width/2+this.props.spaceBetweenTrees/2];return y.a.createElement("div",{id:"TangleContainer"},y.a.createElement("div",{id:"MainTreeTitle",style:Ze({},t,{left:n[0],transform:"translateX(-100%)"})},this.props.leftTreeName),y.a.createElement("div",{id:"SecondTreeTitle",style:Ze({},t,{left:n[1]})},this.props.rightTreeName),y.a.createElement("div",{id:"TangleSvgContainer",style:{position:"absolute",left:this.state.left,top:this.state.top,zIndex:100,pointerEvents:"none"}},y.a.createElement("svg",{id:"Tangle",style:{cursor:"default",width:this.props.width,height:this.props.height},ref:function(t){e.d3ref=t}})))}}]),t}(y.a.Component),Qe=n(158),et=function(e,t){for(var n=0,a=0,i=0,r=0,o=0,s=0,l=0;l<t.nodes.length;l++){var c=t.nodes[l].n;if(!c.children&&e.strainToNode[c.name]){var d=e.strainToNode[c.name].n.yvalue,h=c.yvalue;n++,a+=d,i+=h,r+=Math.pow(d,2),o+=Math.pow(h,2),s+=d*h}}return r/=n,o/=n,((s/=n)-(a/=n)*(i/=n))/Math.sqrt((r-Math.pow(a,2))*(o-Math.pow(i,2)))},tt=function(e,t){var n=et(e,t);!function(e,t){for(var n=et(e,t),a=0;a<t.nodes.length;a++){var i=t.nodes[a],r=i.n;if(i.children){for(var o=r,s=function(){var e=o.children[0];o.children.forEach((function(t){t.yvalue<e.yvalue&&(e=t)})),o=e};o.hasChildren;)s();var l=o.yvalue-1;i.children.reverse(),r.children.reverse(),Object(de.g)(i,l);var c=et(e,t);n>c?(i.children.reverse(),r.children.reverse(),Object(de.g)(i,l)):n=c}}}(e,t),console.log("Untangling ".concat(n," -> ").concat(et(e,t))),Object(de.f)(t.nodes)};function nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function at(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nt(n,!0).forEach((function(t){g()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var it,rt=function(e){function t(e){var n;return i()(this,t),n=l()(this,d()(t).call(this,e)),g()(p()(n),"getStyles",(function(){var e=0!==n.props.tree.idxOfInViewRootNode||0!==n.props.treeToo.idxOfInViewRootNode;return{resetTreeButton:{zIndex:100,position:"absolute",right:5,top:0,cursor:e?"pointer":"auto",color:e?E.a:E.f}}})),n.domRefs={mainTree:void 0,secondTree:void 0},n.tangleRef=void 0,n.state={hover:null,selectedBranch:null,selectedTip:null,tree:null,treeToo:null},n.clearSelectedTip=Xe.bind(p()(n)),n.redrawTree=function(){n.props.dispatch(Object(C.f)({root:[0,0]}))},n}return m()(t,e),o()(t,[{key:"setUpAndRenderTreeToo",value:function(e,t){t.treeToo=new Ce(e.treeToo.nodes,"RIGHT"),N.attemptUntangle&&tt(t.tree,t.treeToo),Je(this,!1,t.treeToo,e)}},{key:"componentDidMount",value:function(){if(this.props.tree.loaded){var e={};e.tree=new Ce(this.props.tree.nodes,"LEFT"),Je(this,!0,e.tree,this.props),this.props.showTreeToo&&this.setUpAndRenderTreeToo(this.props,e),this.setState(e)}}},{key:"componentDidUpdate",value:function(e){var t={},n=!1,a=Fe(!0,this.state.tree,e,this.props),i=ie()(a,2),r=i[0],o=i[1];if(r&&(t=r),e.showTreeToo!==this.props.showTreeToo)this.props.showTreeToo?(this.state.treeToo&&this.state.treeToo.clearSVG(),t.tree=this.state.tree,this.setUpAndRenderTreeToo(this.props,t),this.tangleRef&&this.tangleRef.drawLines()):t.treeToo=null;else if(this.state.treeToo){var s=Fe(!1,this.state.treeToo,e,this.props),l=ie()(s,2);l[0],n=l[1]}this.tangleRef&&(o||n)&&this.tangleRef.drawLines(),Object.keys(t).length&&this.setState(t)}},{key:"renderTreeDiv",value:function(e){var t=this,n=e.width,a=e.height,i=e.mainTree;return y.a.createElement("svg",{id:i?"MainTree":"SecondTree",style:{pointerEvents:"auto",cursor:"default",userSelect:"none"},width:n,height:a,ref:function(e){i?t.domRefs.mainTree=e:t.domRefs.secondTree=e}})}},{key:"render",value:function(){var e=this,t=this.getStyles(),n=this.props.showTreeToo?(this.props.width-100)/2:this.props.width;return y.a.createElement(S.a,{center:!0,title:"Phylogeny"},y.a.createElement(Qe.default,null,y.a.createElement(le,{width:this.props.width})),y.a.createElement(Re,{hovered:this.state.hovered,colorBy:this.props.colorBy,colorByConfidence:this.props.colorByConfidence,colorScale:this.props.colorScale,colorings:this.props.metadata.colorings,panelDims:{width:this.props.width,height:this.props.height,spaceBetweenTrees:100}}),y.a.createElement(te,{goAwayCallback:this.clearSelectedTip,tip:this.state.selectedTip,colorings:this.props.metadata.colorings}),this.props.showTangle&&this.state.tree&&this.state.treeToo?y.a.createElement($e,{ref:function(t){e.tangleRef=t},width:this.props.width,height:this.props.height,lookup:this.props.treeToo.tangleTipLookup,leftNodes:this.props.tree.nodes,rightNodes:this.props.treeToo.nodes,colors:this.props.tree.nodeColors,cVersion:this.props.tree.nodeColorsVersion,vVersion:this.props.tree.visibilityVersion,metric:this.props.distanceMeasure,spaceBetweenTrees:100,leftTreeName:this.props.tree.name,rightTreeName:this.props.showTreeToo}):null,this.renderTreeDiv({width:n,height:this.props.height,mainTree:!0}),this.props.showTreeToo?y.a.createElement("div",{id:"treeSpacer",style:{width:100}}):null,this.props.showTreeToo?this.renderTreeDiv({width:n,height:this.props.height,mainTree:!1}):null,this.props.narrativeMode?null:y.a.createElement("button",{style:at({},E.o,{},t.resetTreeButton),onClick:this.redrawTree},"reset layout"))}}]),t}(y.a.Component),ot=function(e){return Object.prototype.hasOwnProperty.call(e,"paper_url")&&!e.paper_url.endsWith("/")&&"?"!==e.paper_url},st="text/plain;charset=utf-8;",lt="text/tab-separated-values;charset=utf-8;",ct="image/svg+xml;charset=utf-8",dt=function(e,t,n){var a=new Blob([n],{type:t}),i=document.createElement("a"),r=URL.createObjectURL(a);i.setAttribute("href",r),i.setAttribute("download",e),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)},ht=function(e,t,n,a){var i=a?t+"_timetree.nwk":t+"_tree.nwk",r=a?"TimeTree":"Tree";dt(i,st,function(e,t){return function e(n,a){var i="";if(n.hasChildren){var r=[];n.children.forEach((function(a){var i=e(a,t?Object(W.getTraitFromNode)(n,"num_date"):Object(W.getDivFromNode)(n));r.push(i)})),i+="("+r.join(",")+")"+n.name+":",i+=(t?Object(W.getTraitFromNode)(n,"num_date"):Object(W.getDivFromNode)(n))-a}else{var o=n.name+":";i+=o+=(t?Object(W.getTraitFromNode)(n,"num_date"):Object(W.getDivFromNode)(n))-a}return i}(e,0)+";"}(n,a)),e(Object(ne.b)({message:r+" written to "+i}))},pt=function(e){var t=e.match(/^(<.+?>)(.+)<\/.+?>$/);if(t){var n=t[1].match(/width.+?([0-9.]+).+height.+?([0-9.]+)/);if(n){var a=t[1].match(/viewBox="([0-9-]+)\s([0-9-]+)\s([0-9-]+)\s([0-9-]+)"/);return{x:0,y:0,viewbox:a?a.slice(1):void 0,width:parseFloat(n[1]),height:parseFloat(n[2]),inner:t[2]}}}},ut=function(e,t,n){var a='<svg id="'.concat(t,'" width="').concat(n.width,'" height="').concat(n.height,'" x="').concat(n.x,'" y="').concat(n.y,'">');e.push(a),e.push(n.inner),e.push("</svg>")},mt=function(e,t,n,a,i,r){var o=[],s={tree:void 0,mapTiles:void 0,mapD3:void 0,entropy:void 0,frequencies:void 0};if(-1!==n.indexOf("tree")){try{s.tree=pt((new XMLSerializer).serializeToString(document.getElementById("MainTree"))),s.treeLegend=pt((new XMLSerializer).serializeToString(document.getElementById("TreeLegendContainer")))}catch(e){s.tree=void 0,o.push("tree"),console.error("Tree SVG save error:",e)}if(s.tree&&document.getElementById("SecondTree"))try{s.secondTree=pt((new XMLSerializer).serializeToString(document.getElementById("SecondTree"))),document.getElementById("Tangle")&&(s.tangle=pt((new XMLSerializer).serializeToString(document.getElementById("Tangle"))))}catch(e){o.push("second tree / tanglegram"),console.error("Second Tree / tanglegram SVG save error:",e)}}if(-1!==n.indexOf("entropy"))try{s.entropy=pt((new XMLSerializer).serializeToString(document.getElementById("d3entropyParent"))),s.entropy.inner=s.entropy.inner.replace(/<text/g,'<text class="txt"'),s.entropy.inner='<style>.txt { font-family: "Lato", "Helvetica Neue", "Helvetica", "sans-serif"; }</style>'.concat(s.entropy.inner)}catch(e){s.entropy=void 0,o.push("entropy"),console.error("Entropy SVG save error:",e)}if(-1!==n.indexOf("frequencies"))try{s.frequencies=pt((new XMLSerializer).serializeToString(document.getElementById("d3frequenciesSVG")))}catch(e){s.frequencies=void 0,o.push("frequencies"),console.error("Frequencies SVG save error:",e)}if(-1!==n.indexOf("map")&&r){s.mapTiles={x:0,y:0,viewbox:void 0,width:parseFloat(r.mapDimensions.x),height:parseFloat(r.mapDimensions.y),inner:'<image width="'.concat(r.mapDimensions.x,'" height="').concat(r.mapDimensions.y,'" xlink:href="').concat(r.base64map,'"/>')};try{s.mapD3=pt((new XMLSerializer).serializeToString(document.getElementById("d3DemesTransmissions"))),s.mapD3.width=s.mapTiles.width,s.mapD3.height=s.mapTiles.height,s.mapD3._panOffsets=r.panOffsets}catch(e){s.mapD3=void 0,s.mapTiles=void 0,o.push("map"),console.error("Map demes & tranmisions SVG save error:",e)}}var l=[],c=function(e,t,n){var a=0,i=0;for(var r in e.secondTree&&(e.secondTree.x=100+e.tree.width,e.tree.width+=100+e.secondTree.width),e.tree&&e.mapD3&&e.mapTiles?("grid"===t?(a=e.tree.width+50+e.mapTiles.width,i=Math.max(e.tree.height,e.mapTiles.height),e.mapD3.x=e.tree.width+50):(a=Math.max(e.tree.width,e.mapTiles.width),i=e.tree.height+50+e.mapTiles.height,e.mapD3.y=e.tree.height+50),e.mapTiles.x=e.mapD3.x,e.mapTiles.y=e.mapD3.y):e.tree?(a=e.tree.width,i=e.tree.height):e.mapD3&&e.mapTiles&&(a=e.mapTiles.width,i=e.mapTiles.height),e.mapD3&&(e.mapD3.x+=e.mapD3._panOffsets.x,e.mapD3.y+=e.mapD3._panOffsets.y),e.entropy&&(a<e.entropy.width?a=e.entropy.width:e.entropy.x=(a-e.entropy.width)/2,i?(e.entropy.y=i+50,i+=50+e.entropy.height):i=e.entropy.height),e.frequencies&&(a<e.frequencies.width?a=e.frequencies.width:e.frequencies.x=(a-e.frequencies.width)/2,i?(e.frequencies.y=i+50,i+=50+e.frequencies.height):i=e.frequencies.height),e)e[r]&&(e[r].x+=50,e[r].y+=50);i+=100;var o=36*n+20;return{width:a+=100,height:i+=o,padding:50,textY:i-o,textHeight:o}}(s,a,i.length);for(var d in l.push('<svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="'.concat(c.width,'" height="').concat(c.height,'">')),s)s[d]&&ut(l,d,s[d]);l.push('<foreignObject x="'.concat(c.padding,'" y="').concat(c.height-c.textHeight,'" height="').concat(c.textHeight,'" width="').concat(c.width-2*c.padding,'">')),i.forEach((function(e){l.push('<p xmlns="http://www.w3.org/1999/xhtml" style="font-family:lato,sans-serif;">'),l.push(e),l.push("</p>")})),l.push("</foreignObject>"),l.push("</svg>"),dt(t+".svg",ct,l.join("\n")),o.length?e(Object(ne.d)({message:"Vector image saved",details:"Saved to ".concat(t,".svg, however there were errors with ").concat(o.join(", "))})):e(Object(ne.b)({message:"Vector image saved",details:t+".svg"}))},ft=function(e){console.warn("getMapTiles errorCallback",e)},gt=function(e,t,n,a,i){-1!==n.indexOf("map")?window.L.getMapTiles(mt.bind(void 0,e,t,n,a,i),ft):mt(e,t,n,a,i,void 0)},vt=function(e){var t=e.theme,n=e.selected,a=e.width,i=n?t.selectedColor:t.unselectedColor;return y.a.createElement("svg",{width:a,height:a+5},y.a.createElement("g",{transform:"translate(0,2)"},y.a.createElement("svg",{width:a,height:a,viewBox:"16 19 27 22"},y.a.createElement("g",{id:"Group",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",transform:"translate(17.000000, 20.000000)"},y.a.createElement("polyline",{id:"Path-3",stroke:i,points:"2.94117647 12.8571429 2.94117647 18.6083984 17.8459616 18.6083984 17.8459616 16.0260882 24.870031 16.0260882"}),y.a.createElement("polyline",{id:"Path-4",stroke:i,points:"17.8500004 18.5714286 17.8500004 20 25.0119374 20"}),y.a.createElement("polyline",{id:"Path-5",stroke:i,points:"2.94117647 12.8571429 3.00303284 7.21191058 10.2360102 7.11220045 10.4159559 2.99881623 17.1561911 2.93803403 17.1561911 0 24.313534 0"}),y.a.createElement("polyline",{id:"Path-6",stroke:i,points:"17.1599998 2.85714286 17.1599998 4.28571429 24.512941 4.28571429"}),y.a.createElement("path",{d:"M0,12.8571429 L2.94117647,12.8571429",id:"Path-6",stroke:i}),y.a.createElement("polyline",{id:"Path-7",stroke:i,points:"10.2941176 7.14285714 10.2941176 11.4285714 24.5454676 11.4285714"})))))},yt=function(e){var t=e.theme,n=e.selected,a=e.width,i=n?t.selectedColor:t.unselectedColor;return y.a.createElement("svg",{width:a,height:a+5},y.a.createElement("g",{transform:"translate(0,6)"},y.a.createElement("svg",{width:a,height:a,viewBox:"0 0 30 30 "},y.a.createElement("g",{id:"Group",stroke:"none",strokeWidth:"1",fillRule:"evenodd"},y.a.createElement("rect",{fill:"none",stroke:i,x:"1",y:"1",width:"14",height:"17"}),y.a.createElement("rect",{fill:"none",stroke:i,x:"15",y:"1",width:"14",height:"17"}),y.a.createElement("rect",{fill:"none",stroke:i,x:"1",y:"18",width:"28",height:"8"})))))};function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var wt,xt=Object(k.d)(vt),kt=Object(k.d)(yt),Et=Object(k.d)((function(e){var t=e.theme,n=e.selected,a=e.width,i=n?t.selectedColor:t.unselectedColor;return y.a.createElement("svg",{width:a,height:a+5},y.a.createElement("g",{transform:"translate(0,7)"},y.a.createElement("svg",{width:a,height:a,viewBox:"0 0 30 30 "},y.a.createElement("g",{id:"Group",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},y.a.createElement("line",{stroke:i,x1:"3.3",y1:"3.8",x2:"27.7",y2:"3.8"}),y.a.createElement("line",{stroke:i,x1:"3.3",y1:"9.2",x2:"27.7",y2:"9.2"}),y.a.createElement("line",{stroke:i,x1:"3.3",y1:"14.5",x2:"27.7",y2:"14.5"}),y.a.createElement("line",{stroke:i,x1:"3.3",y1:"19.9",x2:"27.7",y2:"19.9"}),y.a.createElement("line",{stroke:i,x1:"3.3",y1:"25.2",x2:"27.7",y2:"25.2"})))))})),Tt=["The data presented here is intended to rapidly disseminate analysis of important pathogens.\n  Unpublished data is included with permission of the data generators, and does not impact their right to publish.","Please contact the respective authors (available via the TSV files below) if you intend to carry out further research using their data.\n  Derived data, such as phylogenies, can be downloaded below - please contact the relevant authors where appropriate."],St={nextstrain:{author:"Hadfield et al",title:"Nextstrain: real-time tracking of pathogen evolution",year:"2018",journal:"Bioinformatics",href:"https://doi.org/10.1093/bioinformatics/bty407"},treetime:{author:"Sagulenko et al",title:"TreeTime: Maximum-likelihood phylodynamic analysis",journal:"Virus Evolution",year:"2017",href:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5758920/"},titers:{author:"Neher et al",titleJournalYear:"Prediction, dynamics, and visualization of antigenic phenotypes of seasonal influenza viruses",journal:"PNAS",year:"2016",href:"http://www.pnas.org/content/113/12/E1701.abstract"}},Ct=Object(x.b)((function(e){return{browserDimensions:e.browserDimensions.browserDimensions,show:e.controls.showDownload,colorBy:e.controls.colorBy,metadata:e.metadata,tree:e.tree,nodes:e.tree.nodes,visibleStateCounts:e.tree.visibleStateCounts,filters:e.controls.filters,visibility:e.tree.visibility,panelsToDisplay:e.controls.panelsToDisplay,panelLayout:e.controls.panelLayout}}))(it=function(e){function t(e){var n;return i()(this,t),(n=l()(this,d()(t).call(this,e))).getStyles=function(e,t){return{behind:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"all",zIndex:2e3,backgroundColor:"rgba(80, 80, 80, .20)",display:"flex",justifyContent:"center",alignItems:"center",wordWrap:"break-word",wordBreak:"break-word"},title:{fontWeight:500,fontSize:32,marginTop:"20px",marginBottom:"20px"},secondTitle:{fontWeight:500,marginTop:"0px",marginBottom:"20px"},modal:{marginLeft:200,marginTop:130,width:e-400,height:t-260,borderRadius:2,backgroundColor:"rgba(250, 250, 250, 1)",overflowY:"auto"},break:{marginBottom:"10px"}}},n.dismissModal=n.dismissModal.bind(p()(n)),n}return m()(t,e),o()(t,[{key:"componentDidMount",value:function(){var e=this;V.a.bind("d",(function(){gt(e.props.dispatch,e.getFilePrefix(),e.props.panelsToDisplay,e.props.panelLayout,e.makeTextStringsForSVGExport())}))}},{key:"getRelevantPublications",value:function(){var e=[St.nextstrain,St.treetime];return-1!==["cTiter","rb","ep","ne"].indexOf(this.props.colorBy)&&e.push(St.titers),e}},{key:"formatPublications",value:function(e){return y.a.createElement("span",null,y.a.createElement("ul",null,e.map((function(e){return y.a.createElement("li",{key:e.href},y.a.createElement("a",{href:e.href,target:"_blank",rel:"noreferrer noopener"},e.author,", ",e.title,", ",y.a.createElement("i",null,e.journal)," (",e.year,")"))}))))}},{key:"getFilePrefix",value:function(){return"nextstrain_"+window.location.pathname.replace(/^\//,"").replace(/:/g,"-").replace(/\//g,"_")}},{key:"makeTextStringsForSVGExport",value:function(){var e=[];e.push(this.props.metadata.title),e.push("Last updated ".concat(this.props.metadata.updated));var t=window.location.href.replace(/&/g,"&amp;");return e.push('Downloaded from <a href="'.concat(t,'">').concat(t,"</a> on ").concat((new Date).toLocaleString())),e.push(this.createSummaryWrapper()),e.push(""),e.push(Tt[0]+' A full list of sequence authors is available via <a href="https://nextstrain.org">nextstrain.org</a>.'),e.push("Relevant publications:"),this.getRelevantPublications().forEach((function(t){e.push('<a href="'.concat(t.href,'">').concat(t.author,", ").concat(t.title,", ").concat(t.journal," (").concat(t.year,")</a>"))})),e}},{key:"downloadButtons",value:function(){var e=this,t=this.getFilePrefix(),n=[["Tree (newick)",y.a.createElement(xt,{width:25,selected:!0}),function(){return ht(e.props.dispatch,t,e.props.nodes[0],!1)}],["TimeTree (newick)",y.a.createElement(xt,{width:25,selected:!0}),function(){return ht(e.props.dispatch,t,e.props.nodes[0],!0)}],["Strain Metadata (TSV)",y.a.createElement(Et,{width:25,selected:!0}),function(){return function(e,t,n,a){var i={},r=["Strain"],o=!0,s=!1,l=void 0;try{for(var c,d=function(){var e=c.value;if(e.hasChildren)return"continue";if(i[e.name]={Strain:e.name},!e.node_attrs)return"continue";var t=["author","div","num_date","vaccine","accession"],n=Object.keys(e.node_attrs).filter((function(e){return!t.includes(e)})),a=!0,o=!1,s=void 0;try{for(var l,d=n[Symbol.iterator]();!(a=(l=d.next()).done);a=!0){var h=l.value;r.includes(h)||r.push(h);var p=Object(W.getTraitFromNode)(e,h);p&&("string"==typeof p?i[e.name][h]=p:"number"==typeof p&&(i[e.name][h]=parseFloat(p).toFixed(2)))}}catch(e){o=!0,s=e}finally{try{a||null==d.return||d.return()}finally{if(o)throw s}}var u=Object(W.getTraitFromNode)(e,"num_date");if(u){var m="Collection Data";r.includes(m)||r.push(m);var f=Object(W.getTraitFromNode)(e,"num_date",{confidence:!0});f&&f[0]!==f[1]?i[e.name][m]="".concat(Object(j.numericToCalendar)(u)," (").concat(Object(j.numericToCalendar)(f[0])," - ").concat(Object(j.numericToCalendar)(f[1]),")"):i[e.name][m]=Object(j.numericToCalendar)(u)}var g=Object(W.getFullAuthorInfoFromNode)(e);if(g){r.includes("Author")||r.push("Author"),i[e.name].Author=g.value,ot(g)&&(i[e.name].Author+=" (".concat(g.paper_url,")"))}var v=Object(W.getVaccineFromNode)(e);if(v&&v.selection_date){var y="Vaccine Selection Date";r.includes(y)||r.push(y),i[e.name][y]=v.selection_date}var b=Object(W.getAccessionFromNode)(e);if(b){r.includes("Accession")||r.push("Accession"),i[e.name].Accession=b}},h=n[Symbol.iterator]();!(o=(c=h.next()).done);o=!0)d()}catch(e){s=!0,l=e}finally{try{o||null==h.return||h.return()}finally{if(s)throw l}}for(var p=[r.map((function(e){return a&&a[e]&&a[e].title?a[e].title:e})).join("\t")],u=0,m=Object.values(i);u<m.length;u++){for(var f=m[u],g=[],v=0,y=r;v<y.length;v++){var b=y[v];g.push(f[b]||"")}p.push(g.join("\t"))}var w="".concat(t,"_metadata.tsv");dt(w,lt,p.join("\n")),e(Object(ne.b)({message:"Metadata exported to ".concat(w)}))}(e.props.dispatch,t,e.props.nodes,e.props.metadata.colorings)}]];(function(e){for(var t=0;t<e.nodes.length;t++)if(Object(W.getFullAuthorInfoFromNode)(e.nodes[t]))return!0;return!1})(this.props.tree)&&n.push(["Author Metadata (TSV)",y.a.createElement(Et,{width:25,selected:!0}),function(){return function(e,t,n){var a=[];a.push(["Author","n (strains)","publication title","journal","publication URL","strains"].join("\t"));var i=t+"_authors.tsv",r={};n.nodes.filter((function(e){return!e.hasChildren})).forEach((function(e){var t=Object(W.getFullAuthorInfoFromNode)(e);t&&(r[t.value]?(r[t.value].count+=1,r[t.value].strains.push(e.name)):r[t.value]={author:t.value,title:t.title||"unknown",journal:t.journal||"unknown",url:ot(t)?t.paper_url:"unknown",count:1,strains:[e.name]})})),Object.values(r).forEach((function(e){a.push([e.author,e.count,e.title,e.journal,e.url,e.strains.join(",")].join("\t"))})),dt(i,lt,a.join("\n")),e(Object(ne.b)({message:"Author metadata exported",details:i}))}(e.props.dispatch,t,e.props.tree)}]),n.push(["Screenshot (SVG)",y.a.createElement(kt,{width:25,selected:!0}),function(){return gt(e.props.dispatch,t,e.props.panelsToDisplay,e.props.panelLayout,e.makeTextStringsForSVGExport())}]);var a=Object.assign({},E.g,{backgroundColor:"rgba(0,0,0,0)",paddingLeft:"10px",color:"white"});return y.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"space-around"}},n.map((function(e){return y.a.createElement("div",{key:e[0],onClick:e[2],style:{cursor:"pointer"}},e[1],y.a.createElement("button",{style:a},e[0]))})))}},{key:"dismissModal",value:function(){this.props.dispatch({type:A.w})}},{key:"createSummaryWrapper",value:function(){return Qt(this.props.metadata.mainTreeNumTips,this.props.nodes,this.props.filters,this.props.visibility,this.props.visibleStateCounts)}},{key:"render",value:function(){if(!this.props.show)return null;var e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(n,!0).forEach((function(t){g()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},E.e.panel);e.width=.66*this.props.browserDimensions.width,e.maxWidth=e.width,e.maxHeight=.66*this.props.browserDimensions.height,e.fontSize=14,e.lineHeight=1.4;var t=this.props.metadata;return y.a.createElement("div",{style:E.e.modalContainer,onClick:this.dismissModal},y.a.createElement("div",{style:e,onClick:function(e){return q(e)}},y.a.createElement("p",{style:E.e.topRightMessage},"(click outside this box to return to the app)"),y.a.createElement("div",{style:E.e.modalSubheading},t.title," (last updated ",t.updated,")"),y.a.createElement("div",null,this.createSummaryWrapper()),y.a.createElement("div",{style:E.e.break})," A full list of sequence authors is available via the TSV files below.",y.a.createElement("div",{style:E.e.break}),Rt({},{preamble:{fontWeight:300},acknowledgments:{fontWeight:300}}),y.a.createElement("div",{style:E.e.modalSubheading},"Data usage policy"),Tt.join(" "),y.a.createElement("div",{style:E.e.modalSubheading},"Please cite the authors who contributed genomic data (where relevant), as well as:"),this.formatPublications(this.getRelevantPublications()),y.a.createElement("div",{style:E.e.modalSubheading},"Download data:"),this.downloadButtons()))}}]),t}(y.a.Component))||it,Ot=n(522),jt=function(){return y.a.createElement("div",null,y.a.createElement("div",null,"This work is made possible by the open sharing of genetic data by research groups."),y.a.createElement("div",{className:"acknowledgments"},"These sequences were generated by the Democratic Republic of the Congo Sequencing Consortium led by the Institut National de Recherche Biomdicales (INRB), Kinshasa, DRC, partnered with the United States Army Medical Reseach Insititute of Infectious Diseases (USAMRIID), Maryland, USA; University of Nebraska Medical Center (UNMC), Nebraska, USA; Institut Pasteur de Dakar, Dakar, Senegal; TransVIHMI, Institut de Recherche pour le Dveloppement (IRD), Institut National de la Sant et de la Recherche Mdicale (INSERM), Universit de Montpellier, Montpellier, France."),y.a.createElement("div",{className:"acknowledgments"},"These data were shared with the Ministry of Health of the DRC, and with the public via this ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"http://virological.org/t/drc-2018-viral-genome-characterization/230"},"virological.org")," post, which is continually updated. If you intend to use these sequences prior to publication, please contact Drs. Muyembe-Tamfum and Ahuka to coordinate."))},Nt=function(e){return y.a.createElement("div",null,e,y.a.createElement("div",{className:"acknowledgments"},"Special thanks to Nick Loman, Matt Cotten, Ian Goodfellow and Paul Kellam for spearheading data sharing efforts during the outbreak. For a more complete phylogeographic analysis of these data see ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"http://dx.doi.org/10.1038/nature22040"},"Dudas et al"),". Curated data used in the paper are available at ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://github.com/ebov/space-time"},"github.com/ebov/space-time"),". The animation shown here was inspired by ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://youtu.be/eWnIhWUpQiQ"},"a work")," by ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"http://bedford.io/team/gytis-dudas/"},"Gytis Dudas"),"."))},Dt=function(e){return y.a.createElement("div",null,e,y.a.createElement("div",{className:"acknowledgments"},"Special thanks to Nick Loman, Nathan Grubaugh, Kristof Theys, Nuno Faria, Kristian Andersen, Andrew Rambaut and Karl Erlandson for data sharing, comments and suggestions."))},Mt=function(e){return y.a.createElement("div",null,e,y.a.createElement("div",{className:"acknowledgments"},"Special thanks to Duah Alkam, Piroon Jenjaroenpun , Thidathip Wongsurawat, Zulema Udaondo, Preecha Patumcharoenpol, Michael Robeson, Dirk Haselow, William Mason, Intawat Nookaew, David Ussery, Se-Ran Jun, Jennifer Gardy, Shirlee Wohl, Jeff Joy, Patrick Stapleton, Nathan Yozwiak, Hayden Metsky, Agatha Jassem, Louise Moncla, Gytis Dudas and Pardis Sabeti for data sharing, comments and suggestions."))},Lt=function(e){return y.a.createElement("div",{className:"acknowledgments"},"This work is made possible by the open sharing of genetic data by research groups, including these groups currently collecting Lassa sequences:",y.a.createElement("p",null),y.a.createElement("a",{href:"http://acegid.org/"},"Christian Happi"),", ",y.a.createElement("a",{href:"https://www.sabetilab.org/"},"Pardis Sabeti"),", ",y.a.createElement("a",{href:"https://www.sabetilab.org/katherine-siddle/"},"Katherine Siddle")," and colleagues, whose data was shared via ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"http://virological.org/t/new-lassa-virus-genomes-from-nigeria-2015-2016/191"},"this viroligical.org post. "),"If you intend to use these sequences prior to publication, please contact them directly to coordinate. ",y.a.createElement("span",{className:"link",onClick:function(){return e(Object(C.a)("set","authors",["Odia_et_al"]))}},"Click here")," here to see these sequences in isolation.",y.a.createElement("p",null),"The Irrua specialist Teaching Hospital (ISTH) and Institute for Lassa Fever Research and Control (ILFRC), Irrua, Edo State, Nigeria;\n        The Bernhard-Nocht Institute for Tropical Medicine (BNITM), Hamburg, Germany;\n        Public Health England (PHE);\n        African Center of Excellence for Genomics of Infectious Disease (ACEGID ), Redeemers University, Ede, Nigeria;\n        Broad Institute of MIT and Harvard University (Cambridge, MA, USA).\n        For further details, including conditions of reuse, please contact ",y.a.createElement("a",{href:"mailto:epogbaini@yahoo.com"},"Ephraim Epogbaini"),", ",y.a.createElement("a",{href:"http://www.who.int/blueprint/about/stephan-gunther/en/"},"Stephan Gnther")," and ",y.a.createElement("a",{href:"https://rega.kuleuven.be/cev/ecv/lab-members/PhilippeLemey.html"},"Philippe Lemey"),". Their data was first shared via ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"http://virological.org/t/2018-lasv-sequencing-continued/192/8"},"this viroligical.org post"),", which is continually updated. ",y.a.createElement("span",{className:"link",onClick:function(){return e(Object(C.a)("set","authors",["ISTH-BNITM-PHE"]))}},"Click here")," here to see these sequences in isolation.")},It=function(e){return y.a.createElement("div",{className:"acknowledgments"},"This work is possible due to the groups who have made their data openly available for analysis -\n        with a special thanks to Nikos Gurfield, Saran Grewal, Chris Barker, Ying Fang and the Andersen Lab for making ",y.a.createElement("a",{href:"https://andersen-lab.com/secrets/data/west-nile-genomics/"},"their data")," available ahead of publication. ","We also thank Simon Dellicour, Sebastian Lequime, Bram Vrancken, Philippe Lemey, Karthik Gangavarapu, Nate Matteson, Sharada Saraf\n        and Nathan Grubaugh for curating the original dataset; and Zhe Zheng and Anderson Brito helping with the updates\n        The data is being maintained by ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"http://bedford.io/team/james-hadfield/"},"James Hadfield")," and ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"http://grubaughlab.com"},"Nathan Grubaugh's lab."),y.a.createElement("p",null),"Our goal is to promote sequencing and sharing of West Nile virus genomes to improve our understanding of virus spread and evolution.\n        To aid in this effort, Nathan Grubaugh, Ryan Smith, and Kristian Andersen have initiated a large study,\n        including >70 collaborators from >30 US states, to sequence ~4,000 West Nile virus genomes from across the country: ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://westnile4k.org/"},"WestNile 4K.")," Their website includes a complete list of collaborators and information on how to join the project.\n      To conduct such an ambitious sequencing project, they adapted their highly multiplexed PCR approach for ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://www.nature.com/articles/nprot.2017.066"},"Zika virus sequencing")," on the Illumina and Minion platforms for West Nile Virus circulating in North America. Their ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"http://grubaughlab.com/open-science/amplicon-sequencing/"},"sequencing protocol and primers")," are free to use.\n        If you have any questions about West Nile virus sequencing, or if you have unpublished data that you would like to share, please email ",y.a.createElement("a",{href:"emailto:grubaughlab@gmail.com"},"grubaughlab@gmail.com"),".",y.a.createElement("p",null),"All data shown here are coding-complete genomes.",y.a.createElement("p",null),"WNV is split into three phenotypically relevant strains - NY99, WN02 and SW03 (",y.a.createElement("span",{className:"link",onClick:function(){return e(Object(Ot.a)("wnv_strain"))}},"click here")," to colour the tree by this). These strains are defined by these mutations (click to change the colouring of the tree):",y.a.createElement("ul",null,y.a.createElement("li",null,y.a.createElement("span",{className:"link",onClick:function(){return e(Object(Ot.a)(Object(se.encodeColorByGenotype)({gene:"env",positions:[159]})))}},"env-V159A")," designates the switch from NY99 (the original sequence) to WN02."),y.a.createElement("li",null,y.a.createElement("span",{className:"link",onClick:function(){return e(Object(Ot.a)(Object(se.encodeColorByGenotype)({gene:"NS4A",positions:[85]})))}},"NS4A-A85T")," designates the switch from WN02 to SW03 (WN02 displaced NY99; WN02 and SW03 co-circulate).")))},Bt=function(){return y.a.createElement("div",{className:"acknowledgments"},"We thank the ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://gisaid.org"},"GISAID Initiative")," for enabling genomic surveillance of influenza and for providing a critical data sharing platform, and all of the groups who contribute to it.")},_t=function(){return y.a.createElement("div",null,y.a.createElement("div",{className:"acknowledgments"},"We thank the ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://gisaid.org"},"GISAID Initiative")," and the ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"http://www.who.int/influenza/gisrs_laboratory/en/"},"GISRS Network")," for critical surveillance efforts and open data sharing. Titer data used in antigenic analysis was generated by the ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://www.cdc.gov/flu/"},"Influenza Division at the US Centers for Disease Control and Prevention"),", the ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"http://www.crick.ac.uk/research/worldwide-influenza-centre"},"Worldwide Influenza Centre at the Francis Crick Institute"),", the ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"http://www.vidrl.org.au/"},"Victorian Infectious Diseases Reference Laboratory at the Australian Peter Doherty Institute for Infection and Immunity")," and the ",y.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://www.niid.go.jp/niid/en/flu-e.html"},"Influenza Virus Research Center at the Japan National Institute of Infectious Diseases"),"."),y.a.createElement("div",{className:"acknowledgments"},"Special thanks to Jackie Katz, Dave Wentworth, Becky Garten, Vivien Dugan, Xiyan Xu, Elizabeth Neuhaus, Sujatha Seenu, John McCauley, Rod Daniels, Vicki Gregory, Kanta Subbarao, Ian Barr, Aeron Hurt, Takato Odagiri, Shinji Watanabe, Tomoko Kuwahara, Michael Lssig, Marta uksza, Richard Reeve, Colin Russell, Sebastian Maurer-Stroh and Peter Bogner for feedback and advice. This analysis represents an updated frontend to the Nextflu informatic pipeline, originally available at nextflu.org."),y.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},y.a.createElement("div",{style:{flex:5}}),y.a.createElement("a",{key:5,href:"https://gisaid.org",target:"_blank",rel:"noreferrer noopener",style:{display:"flex",flexDirection:"column",justifyContent:"center"}},y.a.createElement("img",{alt:"gisaid-logo",width:"120",src:n(569)})),y.a.createElement("div",{style:{flex:1}}),y.a.createElement("a",{key:6,href:"http://www.who.int/influenza/gisrs_laboratory/en/",target:"_blank",rel:"noreferrer noopener"},y.a.createElement("img",{alt:"gisrs-logo",width:"120",src:n(570)})),y.a.createElement("div",{style:{flex:5}})))};var Pt=y.a.createElement("span",{style:{marginLeft:10,marginRight:10}},""),At=k.c.div.withConfig({displayName:"footer__FooterStyles",componentId:"n42vt4-0"})(["margin-left:30px;padding-bottom:30px;font-family:",";font-size:15px;font-weight:300;color:rgb(136,136,136);line-height:1.4;h1{font-weight:700;font-size:2.2em;margin:0.2em 0;}h2{font-weight:600;font-size:2em;margin:0.2em 0;}h3{font-weight:500;font-size:1.8em;margin:0.2em 0;}h4{font-weight:500;font-size:1.6em;margin:0.1em 0;}h5{font-weight:500;font-size:1.4em;margin:0.1em 0;}h6{font-weight:500;font-size:1.2em;margin:0.1em 0;}pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px;}pre code{padding:0;margin:0;overflow:visible;font-size:100%;line-height:inherit;word-wrap:normal;background-color:initial;border:0;}p code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px;}.line{margin-top:20px;margin-bottom:20px;border-bottom:1px solid #CCC;}.finePrint{font-size:14px;}.acknowledgments{margin-top:10px;}.filterList{margin-top:10px;line-height:1.0;}.imageContainer{display:flex;justify-content:center;align-items:center;flex-wrap:wrap;}img{margin-left:30px;margin-right:30px;margin-top:2px;margin-bottom:2px;}"],E.b),Rt=function(e,t){if(e.description){P.a.addHook("afterSanitizeAttributes",(function(e){"href"in e&&location.hostname!==e.hostname&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noreferrer nofollow")),M()(e.childNodes).filter((function(e){return"img"===e.localName})).length>0&&("a"===e.localName?e.parentNode.className+=" imageContainer":e.className+=" imageContainer")}));var n=(0,P.a.sanitize)(B()(e.description),{ALLOWED_TAGS:["div","h1","h2","h3","h4","h5","h6","p","em","strong","del","ol","ul","li","a","img","#text","code","pre","hr"],ALLOWED_ATTR:["href","src","width","height","alt"],KEEP_CONTENT:!1,ALLOW_DATA_ATTR:!1});return y.a.createElement("div",{className:"acknowledgments",dangerouslySetInnerHTML:{__html:n}})}var a=y.a.createElement("div",null,"This work is made possible by the open sharing of genetic data by research groups from all over the world. We gratefully acknowledge their contributions.");return"nextstrain.org"===window.location.hostname?function(e,t){if(window.location.pathname.includes("inrb-drc"))return jt();if(!window.location.pathname.includes("community")){if(window.location.pathname.includes("ebola"))return Nt(t);if(window.location.pathname.includes("zika"))return Dt(t);if(window.location.pathname.includes("mumps"))return Mt(t);if(window.location.pathname.includes("lassa"))return Lt(e);if(window.location.pathname.includes("WNV/NA"))return It(e);if(window.location.pathname.includes("h7n9"))return Bt();if(window.location.pathname.includes("flu"))return _t()}return y.a.createElement("div",null,t)}(t,a):y.a.createElement("div",null,a)},Ft=function(e,t,n,a){var i=-1===t[n].indexOf(a)?"add":"remove";e(Object(C.a)(i,n,[a]))},zt=function(e,t,n,a,i,r){var o=-1!==t[n].indexOf(a);return o&&r?y.a.createElement("div",{key:a,style:{display:"inline-block"}},y.a.createElement("div",{className:"boxed-item-icon",onClick:function(){Ft(e,t,n,a)},role:"button",tabIndex:0},""),y.a.createElement("div",{className:"boxed-item active-with-icon"},i)):o?y.a.createElement("div",{className:"boxed-item active-clickable",key:a,onClick:function(){Ft(e,t,n,a)},role:"button",tabIndex:0},i):y.a.createElement("div",{className:"boxed-item inactive",key:a,onClick:function(){Ft(e,t,n,a)},role:"button",tabIndex:0},i)},Vt=Object(x.b)((function(e){return{tree:e.tree,totalStateCounts:e.tree.totalStateCounts,metadata:e.metadata,colorOptions:e.metadata.colorOptions,browserDimensions:e.browserDimensions.browserDimensions,activeFilters:e.controls.filters}}))(wt=function(e){function t(){return i()(this,t),l()(this,d()(t).apply(this,arguments))}return m()(t,e),o()(t,[{key:"shouldComponentUpdate",value:function(e){if(this.props.tree.version!==e.tree.version||this.props.browserDimensions!==e.browserDimensions)return!0;if(Object.keys(this.props.activeFilters)!==Object.keys(e.activeFilters))return!0;if(Object.keys(this.props.activeFilters)){var t=!0,n=!1,a=void 0;try{for(var i,r=this.props.activeFilters[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;if(this.props.activeFilters[o]!==e.activeFilters[o])return!0}}catch(e){n=!0,a=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw a}}}return!1}},{key:"displayFilter",value:function(e){var t,n,a,i,r=this,o=this.props.totalStateCounts[e],s=this.props.metadata.colorings[e]?this.props.metadata.colorings[e].title:e;return y.a.createElement("div",null,"Filter by ".concat(s),this.props.activeFilters[e].length?(t=this.props.dispatch,n=[e],a="inlineRight",i="Clear ".concat(e," filter"),y.a.createElement("div",{className:"".concat(a," boxed-item active-clickable"),style:{paddingLeft:"5px",paddingRight:"5px",display:"inline-block"},onClick:function(){n.forEach((function(e){return t(Object(C.a)("set",e,[]))}))}},i)):null,y.a.createElement("div",{className:"filterList"},y.a.createElement(R.a,{wrap:"wrap",justifyContent:"flex-start",alignItems:"center"},Array.from(o.keys()).filter((function(e){return Object(N.isValueValid)(e)})).sort().map((function(t){var n=y.a.createElement("span",null,"".concat(t," (").concat(o.get(t),")"));return zt(r.props.dispatch,r.props.activeFilters,e,t,n,!1)})))))}},{key:"getUpdated",value:function(){return this.props.metadata.updated?y.a.createElement("span",null,"Data updated ",this.props.metadata.updated):null}},{key:"downloadDataButton",value:function(){var e=this;return y.a.createElement("button",{style:Object.assign({},E.g,{backgroundColor:"rgba(0,0,0,0)",color:E.h,margin:0,padding:0}),onClick:function(){e.props.dispatch({type:A.S})}},y.a.createElement("i",{className:"fa fa-download","aria-hidden":"true"}),y.a.createElement("span",{style:{position:"relative"}}," download data"))}},{key:"getCitation",value:function(){return y.a.createElement("span",null,"Nextstrain: ",y.a.createElement("a",{href:St.nextstrain.href,target:"_blank"},St.nextstrain.author,", ",y.a.createElement("i",null,St.nextstrain.journal)," (".concat(St.nextstrain.year,")")))}},{key:"render",value:function(){var e=this;if(!this.props.metadata||!this.props.tree.nodes)return null;var t=this.props.width-30;return y.a.createElement(At,null,y.a.createElement("div",{style:{width:t}},y.a.createElement("div",{className:"line"}),Rt(this.props.metadata,this.props.dispatch),y.a.createElement("div",{className:"line"}),Object.keys(this.props.activeFilters).map((function(t){return y.a.createElement("div",{key:t},e.displayFilter(t),y.a.createElement("div",{className:"line"}))})),y.a.createElement(R.a,{className:"finePrint"},this.getUpdated(),Pt,this.downloadDataButton(),Pt,"Auspice v"+F.version),y.a.createElement("div",{style:{height:"3px"}}),y.a.createElement(R.a,{className:"finePrint"},this.getCitation())))}}]),t}(y.a.Component))||wt,Wt={avatar:{marginRight:5,marginBottom:2},byline:{fontFamily:E.d,fontSize:15,marginLeft:2,marginTop:5,marginBottom:5,fontWeight:500,color:"#555",lineHeight:1.4,verticalAlign:"middle"},bylineWeight:{fontFamily:E.d,fontSize:15,fontWeight:500}};function Gt(e){var t=e.buildUrl;if("string"==typeof t){var n=t.match(/(https?:\/\/)?(www\.)?github.com\/([^/]+)/);if(n)return y.a.createElement("img",{style:Wt.avatar,alt:"avatar",width:"28",src:"https://github.com/".concat(n[3],".png?size=200")})}return null}function Ht(e){var t;return Object.prototype.hasOwnProperty.call(e,"maintainers")&&(t=e.maintainers,Array.isArray(t)&&t.length)?y.a.createElement("span",null,"Maintained by ",t.map((function(e,n){return y.a.createElement(y.a.Fragment,{key:e.name},e.url?y.a.createElement(qt,{url:e.url},e.name):e.name,n===t.length-1?"":n===t.length-2?" and ":", ")})),"."):null}function qt(e){var t=e.url,n=e.children;return y.a.createElement("a",{style:Wt.bylineWeight,rel:"noopener noreferrer",href:t,target:"_blank"},n)}var Ut,Xt,Kt,Jt,Yt=function(e){var t=e.width,n=e.metadata;return"nextstrain.org"===window.location.hostname&&window.location.pathname.startsWith("/ncov")?y.a.createElement("div",{width:t,style:Wt.byline},Gt(n),Ht(n),y.a.createElement("span",null," Enabled by data from ",y.a.createElement("img",{src:"https://www.gisaid.org/fileadmin/gisaid/img/schild.png",alt:"gisaid-logo",width:"65"}))):y.a.createElement("div",{width:t,style:Wt.byline},Gt(n),function(e){if(Object.prototype.hasOwnProperty.call(e,"buildUrl")){var t=e.buildUrl;if("string"==typeof t&&(t.startsWith("https://")||t.startsWith("http://")||t.startsWith("www.")))return y.a.createElement("span",null,"Built with ",y.a.createElement(qt,{url:t},t.replace(/^(http[s]?:\/\/)/,"").replace(/^www\./,"").replace(/^github.com\//,"")),". ")}return null}(n),Ht(n))},Zt={country:"countries",authors:"authors"},$t=function(e){var t="number"==typeof e?Object(j.numericToCalendar)(e):e,n=t.split("-");return 3===n.length?"".concat(N.months[n[1]]," ").concat(n[0]):t},Qt=function(e,t,n,a,i,r){var o=function(e,t){var n=0;return e.forEach((function(e,a){e.hasChildren||t[a]!==N.NODE_VISIBLE||(n+=1)})),n}(t,a),s=Object(O.getVisibleDateRange)(t,a),l="Showing ".concat(o," of ").concat(e," genomes");"divOnly"!==r&&(l+=" sampled between ".concat($t(s[0])," and ").concat($t(s[1])));var c=[];Object.keys(n).forEach((function(e){var t=Object.keys(i[e]).length;t&&c.push("".concat(t," ").concat(function(e,t){return 1===t?"authors"===e&&(e="author"):(e in Zt&&(e=Zt[e]),"s"!==e.slice(-1).toLowerCase()&&(e+="s")),e=e.replace(/_/g," ")}(e,t)))}));var d=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.prefix,i=void 0===a?void 0:a,r=n.suffix,o=void 0===r?void 0:r,s=n.capatalise,l=void 0===s||s,c=n.fullStop,d=void 0===c||c;return e.length?(t=1===e.length?e[0]:e.slice(0,-1).join(", ")+" and "+e[e.length-1],i&&(t=i+" "+t),o&&(t+=" "+o),l&&(t=t.charAt(0).toUpperCase()),d&&(t+="."),t+" "):""}(c,{prefix:"divOnly"!==r?"and comprising":"comprising",capatalise:!1});return d.length?l+=" ".concat(d):l+=". ",l},en=Object(x.b)((function(e){return{browserDimensions:e.browserDimensions.browserDimensions,filters:e.controls.filters,animationPlayPauseButton:e.controls.animationPlayPauseButton,metadata:e.metadata,nodes:e.tree.nodes,visibleStateCounts:e.tree.visibleStateCounts,totalStateCounts:e.tree.totalStateCounts,visibility:e.tree.visibility,selectedStrain:e.tree.selectedStrain,selectedClade:e.tree.selectedClade,dateMin:e.controls.dateMin,dateMax:e.controls.dateMax,absoluteDateMin:e.controls.absoluteDateMin,absoluteDateMax:e.controls.absoluteDateMax,branchLengthsToDisplay:e.controls.branchLengthsToDisplay}}))(Ut=function(e){function t(e){return i()(this,t),l()(this,d()(t).call(this,e))}return m()(t,e),o()(t,[{key:"getStyles",value:function(e){var t=28;return this.props.browserDimensions.width<1e3&&(t=27),this.props.browserDimensions.width<800&&(t=26),this.props.browserDimensions.width<600&&(t=25),this.props.browserDimensions.width<400&&(t=24),{base:{width:e+34,display:"inline-block",maxWidth:e,marginTop:0},title:{fontFamily:E.p,fontSize:t,marginLeft:0,marginTop:0,marginBottom:5,fontWeight:500,color:E.a,letterSpacing:"-0.5px",lineHeight:1.2},n:{fontFamily:E.d,fontSize:14,marginLeft:2,marginTop:5,marginBottom:5,fontWeight:500,color:E.h,lineHeight:1.4}}}},{key:"addFilteredDatesButton",value:function(e){var t=this;e.push(y.a.createElement("div",{key:"timefilter",style:{display:"inline-block"}},y.a.createElement("div",{className:"boxed-item-icon",onClick:function(){t.props.dispatch(Object(C.c)({newMin:t.props.absoluteDateMin,newMax:t.props.absoluteDateMax}))},role:"button",tabIndex:0},""),y.a.createElement("div",{className:"boxed-item active-with-icon"},"".concat($t(this.props.dateMin)," to ").concat($t(this.props.dateMax)))))}},{key:"addNonAuthorFilterButton",value:function(e,t){var n=this;this.props.filters[t].sort().forEach((function(a){var i=y.a.createElement("span",null,a," (".concat(n.props.totalStateCounts[t].get(a),")"));e.push(zt(n.props.dispatch,n.props.filters,t,a,i,!0))}))}},{key:"selectedStrainButton",value:function(e){var t=this;return y.a.createElement("span",null,"Showing a single strain ",y.a.createElement("div",{style:{display:"inline-block"}},y.a.createElement("div",{className:"boxed-item-icon",onClick:function(){t.props.dispatch(Object(C.f)({tipSelected:{clear:!0},cladeSelected:t.props.selectedClade}))},role:"button",tabIndex:0},""),y.a.createElement("div",{className:"boxed-item active-with-icon"},e)))}},{key:"clearFilterButton",value:function(e){var t=this;return y.a.createElement("span",{style:{cursor:"pointer",color:"#5097BA"},key:e,onClick:function(){return t.props.dispatch(Object(C.a)("set",e,[]))},role:"button",tabIndex:0},e)}},{key:"renderTitle",value:function(e){var t="";return this.props.metadata.title&&(t=this.props.metadata.title),y.a.createElement("div",{width:this.props.width,style:e.title},t)}},{key:"render",value:function(){var e=this;if(!this.props.metadata||!this.props.nodes||!this.props.visibility)return null;var t=this.getStyles(this.props.width),n="Pause"===this.props.animationPlayPauseButton,a=!n&&!this.props.selectedStrain,i=this.props.dateMin===this.props.absoluteDateMin&&this.props.dateMax===this.props.absoluteDateMax,r=Qt(this.props.metadata.mainTreeNumTips,this.props.nodes,this.props.filters,this.props.visibility,this.props.visibleStateCounts,this.props.branchLengthsToDisplay),o=[];return Object.keys(this.props.filters).filter((function(t){return e.props.filters[t].length>0})).forEach((function(t){return e.addNonAuthorFilterButton(o,t)})),i||this.addFilteredDatesButton(o),y.a.createElement(S.a,{center:!0,infocard:!0},y.a.createElement("div",{style:t.base},this.renderTitle(t),y.a.createElement(Yt,{styles:t,width:this.props.width,metadata:this.props.metadata}),y.a.createElement("div",{width:this.props.width,style:t.n},n?"Animation in progress. ":null,this.props.selectedStrain?this.selectedStrainButton(this.props.selectedStrain):null,a?r:null,a&&o.length?y.a.createElement("span",null,"Filtered to ",o.map((function(e){return e})),". "):null)))}}]),t}(y.a.Component))||Ut,tn=Object(x.b)((function(e){return{tree:e.tree,treeToo:e.treeToo,dateMinNumeric:e.controls.dateMinNumeric,dateMaxNumeric:e.controls.dateMaxNumeric,quickdraw:e.controls.quickdraw,colorBy:e.controls.colorBy,colorByConfidence:e.controls.colorByConfidence,layout:e.controls.layout,temporalConfidence:e.controls.temporalConfidence,distanceMeasure:e.controls.distanceMeasure,mutType:e.controls.mutType,colorScale:e.controls.colorScale,metadata:e.metadata,showTreeToo:e.controls.showTreeToo,showTangle:e.controls.showTangle,panelsToDisplay:e.controls.panelsToDisplay,selectedBranchLabel:e.controls.selectedBranchLabel,narrativeMode:e.narrative.display,animationPlayPauseButton:e.controls.animationPlayPauseButton}}))(rt),nn=n(571),an=n.n(nn),rn=n(572),on=n.n(rn),sn=n(537),ln=n.n(sn),cn=n(574),dn=n.n(cn),hn=n(576),pn=n.n(hn),un=n(651),mn=n.n(un),fn=n(561),gn=n(562),vn=Object(fn.d)().x((function(e){return e.x})).y((function(e){return e.y})).curve(fn.c),yn=function(e,t,n,a,i,r,o,s,l){if("hidden"===o)return[];var c=pn()(l,(function(t){return t>e})),d=mn()(l,(function(e){return e<t}));if(-1===c||-1===d)return[];var h,p,u=s.slice(c,d+1);if(c>0){var m=l[c]-l[c-1],f=(e-l[c-1])/m,g=(l[c]-e)/m;h={x:g*s[c-1].x+f*s[c].x,y:g*s[c-1].y+f*s[c].y}}if(d<s.length-1){var v=l[d+1]-l[d],y=(t-l[d])/v,b=(l[d+1]-t)/v;p={x:b*s[d].x+y*s[d+1].x,y:b*s[d].y+y*s[d+1].y}}return h&&u.unshift(h),p&&u.push(p),u},bn=function(e){var t=[];return e.forEach((function(e){e.arcs.forEach((function(e){t.push(e)}))})),t},wn=function(e,t,n,a,i,r,o,s){var l,c=n.selectAll("transmissions").data(t).enter().append("path").attr("d",(function(e){return vn(yn(r,o,e.originCoords,e.destinationCoords,e.originNumDate,e.destinationNumDate,e.visible,e.bezierCurve,e.bezierDates))})).attr("fill","none").attr("stroke-opacity",.6).attr("stroke-linecap","round").attr("stroke",(function(e){return e.color})).attr("stroke-width",1),d=N.demeCountMultiplier/Math.sqrt(ln()([i.length,N.demeCountMinimum]));if(s){var h=bn(e);h.forEach((function(t){t.outerRadius=Math.sqrt(e[t.demeDataIdx].count)*d})),l=n.selectAll("demes").data(h).enter().append("path").attr("d",(function(e){return Object(fn.a)()(e)})).style("stroke","none").style("fill-opacity",.65).style("fill",(function(e){return e.color})).style("stroke-opacity",.85).style("stroke",(function(e){return e.color})).attr("transform",(function(t){return"translate("+e[t.demeDataIdx].coords.x+","+e[t.demeDataIdx].coords.y+")"}))}else l=n.selectAll("demes").data(e).enter().append("circle").attr("r",(function(e){return d*Math.sqrt(e.count)})).style("stroke","none").style("fill-opacity",.65).style("fill",(function(e){return e.color})).style("stroke-opacity",.85).style("stroke",(function(e){return e.color})).attr("transform",(function(e){return"translate("+e.coords.x+","+e.coords.y+")"}));return{demes:l,transmissions:c}},xn=n(652),kn=n.n(xn),En=n(659),Tn=n.n(En),Sn=n(660),Cn=n.n(Sn),On=n(663),jn=n.n(On),Nn=n(665),Dn=n.n(Nn),Mn=n(666),Ln=n.n(Mn),In=function(e,t){var n=Ln.a.get(e,t);return function(a){return n*Math.pow(a,t)*Math.pow(1-a,e-t)}},Bn=function(e,t,n){var a=e.x,i=e.y,r=t.x,o=t.y,s=Math.sign(r-a),l=(o-i)/(r-a),c=Math.sqrt(Math.pow(o-i,2)+Math.pow(r-a,2)),d=200*Math.log(Math.pow(c,.05))+n*N.transmissionThickness,h=Math.sqrt(Math.pow(d,2)+Math.pow(c,2)/4);return{x:a+h*Math.cos(Math.atan(2*d/c)+Math.atan(l))*s,y:i+h*Math.sin(Math.atan(2*d/c)+Math.atan(l))*s}},_n=function(e,t,n){return n.latLngToLayerPoint(new L.LatLng(e,t))},Pn=function(e,t,n){var a={};return e.forEach((function(e,i){if(!e.children){var r=Object(W.getTraitFromNode)(e,n);r&&(a[r]||(a[r]=[]),t[i]!==N.NODE_NOT_VISIBLE&&a[r].push(e))}})),a},An=function(e,t,n,a){var i,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,o=Object(se.isColorByGenotype)(n),s={},l=t.length;r?(i=r,t.forEach((function(e,t){s[e]=t,i[t]._count=0})),i[l]._count=0):(i=t.map((function(e,t){return s[e]=t,{innerRadius:0,_count:0}}))).push({innerRadius:0,_count:0}),e.forEach((function(e){var t=o?e.currentGt:Object(W.getTraitFromNode)(e,n),r=s[t];void 0===r&&(r=l),i[r]._count++,i[r].color||(i[r].color=a[e.arrayIdx])}));var c=0;return i.forEach((function(t){t.startAngle=c,c+=2*Math.PI*t._count/e.length,t.endAngle=c,t.startAngle===t.endAngle&&(t.color="")})),i},Rn=function(e,t,n){return function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:15,i=Bn(e,t,n),r=[e,i,t],o=Cn()(r.length),s=jn()(0,1,a),l=[];return Cn()(a).forEach((function(e){l[e]={x:0,y:0}})),o.forEach((function(e){var t=In(o.length-1,e),n=s.map(t),i=[r[e].x,r[e].y],c=Dn()([Cn()(n.length),Cn()(i.length)]);Cn()(l.length).forEach((function(e){l[e].x+=n[c[e][0]]*i[c[e][1]],l[e].y+=n[c[e+a][0]]*i[c[e+a][1]]}))})),l}(e,t,n)},Fn=function(e,t,n,a,i,r,o,s,l,c,d){var h,p,u,m,f,g=Object(W.getTraitFromNode)(e,a),v=Object(W.getTraitFromNode)(t,a),y=n.filter((function(e){return e.key===a}))[0].demes;try{h=y[g].latitude,p=y[g].longitude}catch(e){c.add(g)}try{u=y[v].latitude,m=y[v].longitude}catch(e){c.add(v)}var b=function(e,t,n,a,i){var r=null;return(t>-360||a>-360)&&(t<360||a<360)&&Math.abs(t-a)<180&&(r=[_n(e,t,i),_n(n,a,i)]),r}(h,p+s,u,m+l,o);if(b){var w=Rn(b[0],b[1],d),x=Object(ze.d)(Object(W.getTraitFromNode)(e,"num_date"),Object(W.getTraitFromNode)(t,"num_date")),k=[];w.forEach((function(e,t){k.push(x(t/(w.length-1)))})),f={id:e.arrayIdx.toString()+"-"+t.arrayIdx.toString(),originNode:e,destinationNode:t,bezierCurve:w,bezierDates:k,originName:Object(W.getTraitFromNode)(e,a),destinationName:Object(W.getTraitFromNode)(t,a),originCoords:b[0],destinationCoords:b[1],originLatitude:h,destinationLatitude:u,originLongitude:p+s,destinationLongitude:m+l,originNumDate:Object(W.getTraitFromNode)(e,"num_date"),destinationNumDate:Object(W.getTraitFromNode)(t,"num_date"),color:i[e.arrayIdx],visible:r[t.arrayIdx]!==N.NODE_NOT_VISIBLE?"visible":"hidden",extend:d}}return f},zn=function(e,t,n,a,i,r,o){var s=i?[-360,0,360]:[0],l=[],c={},d=new Set,h={};return e.forEach((function(e){var i=Object(W.getTraitFromNode)(e,n);e.children&&e.children.forEach((function(c){var p=Object(W.getTraitFromNode)(c,n);if(i&&p&&i!==p){[i,p]in h?h[[i,p]]+=1:h[[i,p]]=1;var u=h[[i,p]];s.forEach((function(i){var s=function(e,t,n,a,i,r,o,s,l,c){var d=[];return[-360,0,360].forEach((function(h){var p=Fn(e,t,n,a,i,r,o,s,h,l,c);p&&d.push(p)})),d.length>0?Tn()(d,(function(e){return Math.abs(e.destinationCoords.x-e.originCoords.x)})):null}(e,c,r.geoResolutions,n,a,t,o,i,d,u);s&&l.push(s)}))}}))})),l.forEach((function(e,t){c[e.id]?c[e.id].push(t):c[e.id]=[t]})),{transmissionData:l,transmissionIndices:c,demesMissingLatLongs:d}},Vn=function(e,t,n,a,i,r,o,s,l,c,d){var h=function(e,t,n,a,i,r,o,s,l,c){var d=[],h={},p=Pn(e,t,n),u=i?[-360,0,360]:[0],m=r.geoResolutions.filter((function(e){return e.key===n}))[0].demes,f=0;return u.forEach((function(e){for(var t=0,n=Object.entries(p);t<n.length;t++){var i=ie()(n[t],2),r=i[0],u=i[1],g=0,v=0,y=!0;m[r]?(g=m[r].latitude,v=m[r].longitude+e):(y=!1,console.warn("Warning: Lat/long missing from metadata for",r));var b=_n(g,v,o);if(v>-360&&v<360&&!0===y){var w={name:r,count:u.length,latitude:g,longitude:v,coords:b};s?function(){w.arcs=An(u,l,c,a);var e=d.length;w.arcs.forEach((function(t){t.demeDataIdx=e}))}():w.color=Object(Oe.getAverageColorFromNodes)(u,a),d.push(w),h[r]?h[r].push(f):h[r]=[f],f+=1}}})),{demeData:d,demeIndices:h}}(e,t,n,a,i,r,o,s,l,c),p=h.demeData,u=h.demeIndices,m=zn(e,t,n,a,i,r,o),f=m.transmissionData,g=m.transmissionIndices,v=m.demesMissingLatLongs,y=M()(v).filter((function(e){return"unknown"!==e.toLowerCase()}));return y.size&&d(Object(ne.a)({message:"The following demes are missing lat/long information",details:M()(y).join(", ")})),{demeData:p,transmissionData:f,demeIndices:u,transmissionIndices:g,demesMissingLatLongs:v}},Wn=function(e,t,n,a,i,r,o,s,l,c,d){return{newDemes:e?function(e,t,n,a,i,r,o,s,l){for(var c=e.slice(),d=Pn(n,a,i),h=function(){var e=ie()(u[p],2),n=e[0],a=e[1];t[n]&&t[n].forEach((function(e){c[e].count=a.length,o?c[e].arcs=An(a,l,s,r,c[e].arcs):c[e].color=Object(Oe.getAverageColorFromNodes)(a,r)}))},p=0,u=Object.entries(d);p<u.length;p++)h();return c}(e,n,i,r,o,s,l,c,d):e,newTransmissions:t&&t.length?function(e,t,n,a,i,r){var o=e.slice();return n.forEach((function(e){e.children&&e.children.forEach((function(n){var s=Object(W.getTraitFromNode)(e,i),l=Object(W.getTraitFromNode)(n,i);if(s&&l&&s!==l){var c=e.arrayIdx.toString()+"-"+n.arrayIdx.toString(),d=r[e.arrayIdx],h=a[n.arrayIdx]!==N.NODE_NOT_VISIBLE?"visible":"hidden";try{t[c].forEach((function(e){o[e].color=d,o[e].visible=h}))}catch(e){console.warn("Error trying to access ".concat(c," in transmissionIndices. Map transmissions may be wrong."))}}}))})),o}(t,a,i,r,o,s):t}};function Gn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Hn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gn(n,!0).forEach((function(t){g()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qn,Un=Object(x.b)((function(e){return{branchLengthsToDisplay:e.controls.branchLengthsToDisplay,absoluteDateMin:e.controls.absoluteDateMin,absoluteDateMax:e.controls.absoluteDateMax,treeVersion:e.tree.version,treeLoaded:e.tree.loaded,nodes:e.tree.nodes,nodeColors:e.tree.nodeColors,visibility:e.tree.visibility,visibilityVersion:e.tree.visibilityVersion,metadata:e.metadata,colorScaleVersion:e.controls.colorScale.version,map:e.map,geoResolution:e.controls.geoResolution,animationPlayPauseButton:e.controls.animationPlayPauseButton,mapTriplicate:e.controls.mapTriplicate,dateMinNumeric:e.controls.dateMinNumeric,dateMaxNumeric:e.controls.dateMaxNumeric,panelLayout:e.controls.panelLayout,colorBy:e.controls.colorScale.colorBy,narrativeMode:e.narrative.display,pieChart:!e.controls.colorScale.continuous&&e.controls.geoResolution!==e.controls.colorScale.colorBy,legendValues:e.controls.colorScale.legendValues}}))((Jt=Kt=function(e){function t(e){var n;return i()(this,t),n=l()(this,d()(t).call(this,e)),g()(p()(n),"getStyles",(function(){return{resetZoomButton:{zIndex:100,position:"absolute",right:5,top:0,cursor:"pointer",color:E.a}}})),n.state={map:null,d3DOMNode:null,d3elems:null,responsive:null,demeData:null,transmissionData:null,demeIndices:null,transmissionIndices:null,userHasInteractedWithMap:!1},n.playPauseButtonClicked=n.playPauseButtonClicked.bind(p()(n)),n.resetButtonClicked=n.resetButtonClicked.bind(p()(n)),n.fitMapBoundsToData=n.fitMapBoundsToData.bind(p()(n)),n}return m()(t,e),o()(t,[{key:"componentWillMount",value:function(){var e=this;window.L||an()(),window.L.getMapTiles||(window.L.getMapTiles=function(t,n){dn()(e.state.map,(function(a,i){if(a)n(a);else{var r=e.state.map.getSize(),o=function(n){t({base64map:n.srcElement.result,mapDimensions:r,panOffsets:e.state.map._getMapPanePos()})};i.toBlob((function(e){var t=new FileReader;t.addEventListener("loadend",o),t.addEventListener("onerror",n),t.readAsDataURL(e)}),"image/png;base64;",1)}}))})}},{key:"componentDidMount",value:function(){this.maybeChangeSize(this.props),this.maybeRemoveAllDemesAndTransmissions(this.props)||this.maybeUpdateDemesAndTransmissions(this.props),this.maybeInvalidateMapSize(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.modulateInterfaceForNarrativeMode(e),this.maybeChangeSize(e),this.maybeRemoveAllDemesAndTransmissions(e)||this.maybeUpdateDemesAndTransmissions(e),this.maybeInvalidateMapSize(e)}},{key:"componentDidUpdate",value:function(e){null!==this.props.nodes&&(this.maybeCreateLeafletMap(),this.maybeSetupD3DOMNode(),this.maybeDrawDemesAndTransmissionsAndMoveMap(e))}},{key:"maybeInvalidateMapSize",value:function(e){!this.state.map||this.props.width===e.width&&this.props.height===e.height||(this.map_timeout&&window.clearTimeout(this.map_timeout),this.map_timeout=window.setTimeout(this.invalidateMapSize.bind(this),this.props.narrativeMode?100:750))}},{key:"invalidateMapSize",value:function(){this.state.map.invalidateSize()}},{key:"maybeCreateLeafletMap",value:function(){this.props.metadata.loaded&&!this.state.map&&document.getElementById("map")&&this.createMap()}},{key:"maybeChangeSize",value:function(e){this.props.width===e.width&&this.props.height===e.height&&this.state.responsive&&this.props.treeVersion===e.treeVersion||this.setState({responsive:{width:e.width,height:e.height}})}},{key:"maybeSetupD3DOMNode",value:function(){if(this.state.map&&this.state.responsive&&!this.state.d3DOMNode){var e=Object(Ke.f)("#map svg").attr("id","d3DemesTransmissions");this.setState({d3DOMNode:e})}}},{key:"modulateInterfaceForNarrativeMode",value:function(e){this.props.narrativeMode!==e.narrativeMode&&this.state.map&&(e.narrativeMode?(L.zoomControlButtons.remove(),this.state.map.dragging.disable(),this.state.map.doubleClickZoom.disable()):(L.zoomControlButtons=L.control.zoom({position:"bottomright"}).addTo(this.state.map),this.state.map.dragging.enable(),this.state.map.doubleClickZoom.enable()))}},{key:"maybeDrawDemesAndTransmissionsAndMoveMap",value:function(e){var t=!!this.state.map,n=!!(this.props.metadata.loaded&&this.props.treeLoaded&&this.state.responsive&&this.state.d3DOMNode),a=!this.state.demeData&&!this.state.transmissionData;if(t&&n&&a){var i=Vn(this.props.nodes,this.props.visibility,this.props.geoResolution,this.props.nodeColors,this.props.mapTriplicate,this.props.metadata,this.state.map,this.props.pieChart,this.props.legendValues,this.props.colorBy,this.props.dispatch),r=i.demeData,o=i.transmissionData,s=i.demeIndices,l=i.transmissionIndices;this.moveMapAccordingToData({geoResolutionChanged:e.geoResolution!==this.props.geoResolution,visibilityChanged:e.visibility!==this.props.visibility,demeData:r,demeIndices:s});var c=wn(r,o,this.state.d3DOMNode,this.state.map,this.props.nodes,this.props.dateMinNumeric,this.props.dateMaxNumeric,this.props.pieChart);this.setState({boundsSet:!0,d3elems:c,demeData:r,transmissionData:o,demeIndices:s,transmissionIndices:l})}}},{key:"maybeRemoveAllDemesAndTransmissions",value:function(e){var t=!!this.state.map,n=this.props.geoResolution!==e.geoResolution,a=!e.treeLoaded||this.props.treeVersion!==e.treeVersion,i=e.colorScaleVersion!==this.props.colorScaleVersion;return!(!t||!(n||a||i))&&(this.state.d3DOMNode.selectAll("*").remove(),this.setState({d3elems:null,demeData:null,transmissionData:null,demeIndices:null,transmissionIndices:null}),!0)}},{key:"respondToLeafletEvent",value:function(e){var t,n,a=this;if("moveend"===e.type){if(!this.state.demeData||!this.state.transmissionData)return void window.setTimeout((function(){return a.respondToLeafletEvent(e)}),50);var i=(t=this.state.demeData,n=this.state.map,kn()(t,(function(e){return e.coords=_n(e.latitude,e.longitude,n),e}))),r=function(e,t){var n=e.slice();return n.forEach((function(e){e.originCoords=_n(e.originLatitude,e.originLongitude,t),e.destinationCoords=_n(e.destinationLatitude,e.destinationLongitude,t),e.bezierCurve=Rn(e.originCoords,e.destinationCoords,e.extend)})),n}(this.state.transmissionData,this.state.map);!function(e,t,n,a,i,r){if(n){if(r){var o=bn(e);n.demes.data(o).attr("transform",(function(t){return"translate("+e[t.demeDataIdx].coords.x+","+e[t.demeDataIdx].coords.y+")"}))}else n.demes.data(e).attr("transform",(function(e){return"translate("+e.coords.x+","+e.coords.y+")"}));n.transmissions.data(t).attr("d",(function(e){return vn(yn(a,i,e.originCoords,e.destinationCoords,e.originNumDate,e.destinationNumDate,e.visible,e.bezierCurve,e.bezierDates))}))}}(i,r,this.state.d3elems,this.props.dateMinNumeric,this.props.dateMaxNumeric,this.props.pieChart),this.setState({demeData:i,transmissionData:r})}}},{key:"getGeoRange",value:function(e,t){var n=this,a=[],i=[];this.props.metadata.geoResolutions.forEach((function(r){if(r.key===n.props.geoResolution){var o=r.demes;Object.keys(o).forEach((function(n){t&&e&&t[n]?t[n].forEach((function(t){e[t]&&e[t].count>0&&(a.push(o[n].latitude),i.push(o[n].longitude))})):(a.push(o[n].latitude),i.push(o[n].longitude))}))}}));var r=ln()(a),o=on()(a),s=ln()(i),l=on()(i),c=(s-l)%360,d=r-o,h=ln()([-55,o-.1*d]),p=on()([70,r+.1*d]),u=ln()([-180,l-.1*c]),m=on()([180,s+.1*c]);return[L.latLng(h,m),L.latLng(p,u)]}},{key:"maybeUpdateDemesAndTransmissions",value:function(e){if(this.state.map&&this.props.treeLoaded&&this.state.d3elems){var t=e.visibilityVersion!==this.props.visibilityVersion,n=e.nodes&&e.visibility&&e.geoResolution&&e.nodeColors;if(t&&n)if(this.props.geoResolution!==e.geoResolution){var a=Vn(e.nodes,e.visibility,e.geoResolution,e.nodeColors,e.mapTriplicate,e.metadata,this.state.map,e.pieChart,e.legendValues,e.colorBy,e.dispatch),i=a.demeData,r=a.transmissionData,o=a.demeIndices,s=a.transmissionIndices,l=wn(i,r,this.state.d3DOMNode,this.state.map,e.nodes,e.dateMinNumeric,e.dateMaxNumeric,e.pieChart);this.setState({d3elems:l,demeData:i,transmissionData:r,demeIndices:o,transmissionIndices:s})}else{var c=Wn(this.state.demeData,this.state.transmissionData,this.state.demeIndices,this.state.transmissionIndices,e.nodes,e.visibility,e.geoResolution,e.nodeColors,e.pieChart,e.colorBy,e.legendValues),d=c.newDemes,h=c.newTransmissions;!function(e,t,n,a,i,r,o,s){if(n){var l=N.demeCountMultiplier/Math.sqrt(ln()([i.length,N.demeCountMinimum]));if(s){var c=bn(e);c.forEach((function(t){t.outerRadius=Math.sqrt(e[t.demeDataIdx].count)*l})),n.demes.data(c).attr("d",(function(e){return Object(fn.a)()(e)})).style("fill",(function(e){return e.color})).style("stroke",(function(e){return e.color}))}else n.demes.data(e).transition().duration(200).ease(gn.b).style("stroke",(function(e){return e.count>0?e.color:"white"})).style("fill",(function(e){return e.count>0?e.color:"white"})).attr("r",(function(e){return l*Math.sqrt(e.count)}));n.transmissions.data(t).attr("d",(function(e){return vn(yn(r,o,e.originCoords,e.destinationCoords,e.originNumDate,e.destinationNumDate,e.visible,e.bezierCurve,e.bezierDates))})).attr("stroke",(function(e){return e.color}))}else console.error("d3elems is not defined!")}(d,h,this.state.d3elems,this.state.map,e.nodes,e.dateMinNumeric,e.dateMaxNumeric,e.pieChart),this.moveMapAccordingToData({geoResolutionChanged:e.geoResolution!==this.props.geoResolution,visibilityChanged:e.visibility!==this.props.visibility,demeData:d,demeIndices:this.state.demeIndices}),this.setState({demeData:d,transmissionData:h})}}}},{key:"getInitialBounds",value:function(){var e,t;return this.props.mapTriplicate?(e=L.latLng(-70,-360),t=L.latLng(80,360)):(e=L.latLng(-70,-180),t=L.latLng(80,180)),L.latLngBounds(e,t)}},{key:"createMap",value:function(){var e=this,t=L.map("map",{center:[0,0],zoom:2,scrollWheelZoom:!1,maxBounds:this.getInitialBounds(),minZoom:1,maxZoom:14,zoomSnap:.5,zoomControl:!1,sleep:!1,sleepTime:750,wakeTime:750,sleepNote:!0,hoverToWake:!1,dragging:!L.Browser.mobile&&!this.props.narrativeMode,doubleClickZoom:!this.props.narrativeMode,tap:!1});t.getRenderer(t).options.padding=2,L.tileLayer("https://api.mapbox.com/styles/v1/trvrb/ciu03v244002o2in5hlm3q6w2/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoidHJ2cmIiLCJhIjoiY2l1MDRoMzg5MDEwbjJvcXBpNnUxMXdwbCJ9.PMqX7vgORuXLXxtI3wISjw",{attribution:' <a href="https://www.mapbox.com/about/maps/">Mapbox</a>  <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>'}).addTo(t),this.props.narrativeMode||(L.zoomControlButtons=L.control.zoom({position:"bottomright"}).addTo(t)),t.on("moveend",this.respondToLeafletEvent.bind(this)),t.on("resize",(function(){e.props.narrativeMode&&e.fitMapBoundsToData(e.state.demeData,e.state.demeIndices)})),this.setState({map:t})}},{key:"animationButtons",value:function(){if(this.props.narrativeMode)return null;var e={color:"#FFFFFF",fontWeight:400,fontSize:12,borderRadius:3,padding:12,border:"none",zIndex:900,position:"absolute",textTransform:"uppercase"};return"divOnly"!==this.props.branchLengthsToDisplay?y.a.createElement("div",null,y.a.createElement("button",{style:Hn({},e,{top:20,left:20,width:60,backgroundColor:"Pause"===this.props.animationPlayPauseButton?E.i:E.c}),onClick:this.playPauseButtonClicked},this.props.animationPlayPauseButton),y.a.createElement("button",{style:Hn({},e,{top:20,left:88,width:60,backgroundColor:E.f}),onClick:this.resetButtonClicked},"Reset")):y.a.createElement("div",null)}},{key:"maybeCreateMapDiv",value:function(){var e=this,t=null;return this.state.responsive&&(t=y.a.createElement("div",{style:{position:"relative"}},this.animationButtons(),y.a.createElement("div",{onClick:function(){e.setState({userHasInteractedWithMap:!0})},id:"map",style:{height:this.state.responsive.height,width:this.state.responsive.width}}))),t}},{key:"playPauseButtonClicked",value:function(){"Play"===this.props.animationPlayPauseButton?this.props.dispatch({type:A.B,data:"Pause"}):this.props.dispatch({type:A.B,data:"Play"})}},{key:"resetButtonClicked",value:function(){this.props.dispatch({type:A.B,data:"Play"}),this.props.dispatch(Object(C.c)({newMin:this.props.absoluteDateMin,newMax:this.props.absoluteDateMax,quickdraw:!1}))}},{key:"moveMapAccordingToData",value:function(e){var t=e.geoResolutionChanged,n=e.visibilityChanged,a=e.demeData,i=e.demeIndices;this.state.boundsSet?"Pause"!==this.props.animationPlayPauseButton&&(t||n)&&(this.props.narrativeMode?this.state.map.fire("resize"):this.state.userHasInteractedWithMap||this.fitMapBoundsToData(a,i)):this.fitMapBoundsToData(a,i)}},{key:"getMaxZoomForFittingMapToData",value:function(){switch(this.props.geoResolution.toLowerCase()){case"region":return 4;case"country":return 5;case"state":return 7;case"city":return 12;case"block":return 14;default:return 8}}},{key:"fitMapBoundsToData",value:function(e,t){var n=this.getGeoRange(e,t);this.state.currentBounds=window.L.latLngBounds(n[0],n[1]);var a=this.getMaxZoomForFittingMapToData();this.state.map.fitBounds(window.L.latLngBounds(n[0],n[1]),{maxZoom:a})}},{key:"render",value:function(){var e=this,t=this.getStyles(),n=this.state.transmissionData&&this.state.transmissionData.length;return y.a.createElement(S.a,{center:!0,title:n?"Transmissions":"Geography"},this.maybeCreateMapDiv(),this.props.narrativeMode?null:y.a.createElement("button",{style:Hn({},E.o,{},t.resetZoomButton),onClick:function(){e.fitMapBoundsToData(e.state.demeData,e.state.demeIndices),e.setState({userHasInteractedWithMap:!1})}},"reset zoom"))}}]),t}(y.a.Component),g()(Kt,"propTypes",{treeVersion:w.a.number.isRequired,treeLoaded:w.a.bool.isRequired,colorScaleVersion:w.a.number.isRequired}),Xt=Jt))||Xt,Xn=n(98),Kn=n(97),Jn=n.n(Kn),Yn=n(154),Zn=n.n(Yn),$n=n(667),Qn=n.n($n),ea=["text/csv","application/vnd.ms-excel"],ta=ea.concat("text/tab-separated-values"),na=function(e){return ta.includes(e.type)||function(e){return""===e.type&&e.name.endsWith(".tsv")}(e)},aa=function(e){return new Promise((function(t,n){na(e)||n(new Error("Cannot parse this filetype")),Qn.a.parse(e,{header:!0,complete:function(e){t(e)},error:function(e){n(e)},encoding:"UTF-8",comments:"#",delimiter:ea.includes(e.type)?",":"\t",skipEmptyLines:!0,dynamicTyping:!1})}))},ia=function(){var e=Zn()(Jn.a.mark((function e(t,n,a){var i,r,o,s,l,c,d,h,p,u,m,f,g,v,y,b,w;return Jn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,aa(a);case 3:if(s=e.sent,i=s.data,r=s.errors,o=s.meta,!r.length){e.next=10;break}throw console.error(r),new Error(r.map((function(e){return e.message})).join(", "));case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",t(Object(ne.a)({message:"Parsing of ".concat(a.name," failed"),details:e.t0.message})));case 15:if(l=o.fields[0],c=n(),d=c.controls,h=c.tree,p=[],u=[],m=new Set(["name","div","num_date","vaccine","labels","hidden","mutations","url","authors","accession","traits","children"]),o.fields.slice(1).forEach((function(e){d.coloringsPresentOnTree.has(e)||m.has(e)?u.push(e):p.push(e)})),f=new Set,g={},v=[],y=new Set(h.nodes.map((function(e){return e.name}))),i.forEach((function(e){var t=e[l];y.has(t)?(f.add(t),g[t]={},p.forEach((function(n){e[n]&&(g[t][n]={value:e[n]})}))):v.push(t)})),0!==f.size&&0!==p.length){e.next=28;break}return e.abrupt("return",t(Object(ne.a)({message:"".concat(a.name," had no (relevent) information"),details:0===p.length?"No columns to add as colorings":"No taxa which match those in the tree"})));case 28:return v.length&&(b=v.length,t(Object(ne.d)({message:"Ignoring ".concat(b," taxa which ").concat(b>1?"don't":"doesn't"," appear in the tree!"),details:v.join(", ")})),console.warn("Ignoring these taxa from the CSV as they don't appear in the tree:",v)),u.length&&t(Object(ne.d)({message:"Ignoring ".concat(u.length,' CSV fields as they are already set as colorings or are "special" cases to be ignored'),details:u.join(", ")})),w={},p.forEach((function(e){w[e]={title:e,type:"categorical"}})),t({type:A.a,newColorings:w,strains:f,traits:g}),e.abrupt("return",t(Object(ne.c)({message:"Adding metadata from "+a.name,details:"".concat(p.length," new field").concat(p.length>1?"s":""," for ").concat(f.size," node").concat(f.size>1?"s":"")})));case 34:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n,a){return e.apply(this,arguments)}}(),ra=function(e){return function(t,n){if(1!==e.length)return t(Object(ne.d)({message:"More than one file dropped",details:"Currently we only allow a single CSV to be used"}));var a=e[0];return na(a)?ia(t,n,a):t(Object(ne.d)({message:"Cannot parse ".concat(a.name),details:"Currently only CSV & TSV files are allowed, not ".concat(a.type)}))}},oa=Object(x.b)((function(e){return{animationPlayPauseButton:e.controls.animationPlayPauseButton,absoluteDateMaxNumeric:e.controls.absoluteDateMaxNumeric,absoluteDateMinNumeric:e.controls.absoluteDateMinNumeric,dateMinNumeric:e.controls.dateMinNumeric,dateMaxNumeric:e.controls.dateMaxNumeric,mapAnimationCumulative:e.controls.mapAnimationCumulative,mapAnimationShouldLoop:e.controls.mapAnimationShouldLoop,mapAnimationDurationInMilliseconds:e.controls.mapAnimationDurationInMilliseconds}}))(qn=function(e){function t(e){return i()(this,t),l()(this,d()(t).call(this,e))}return m()(t,e),o()(t,[{key:"componentDidMount",value:function(){this.maybeAnimate()}},{key:"componentDidUpdate",value:function(){this.maybeAnimate()}},{key:"render",value:function(){return null}},{key:"maybeAnimate",value:function(){var e=this;if("Pause"===this.props.animationPlayPauseButton&&!window.NEXTSTRAIN.animationTickReference){var t=this.props.absoluteDateMaxNumeric-this.props.absoluteDateMinNumeric,n=N.animationTick*t/this.props.mapAnimationDurationInMilliseconds,a=N.animationWindowWidth*t;this.props.dateMaxNumeric-this.props.dateMinNumeric<1.3*a?window.NEXTSTRAIN.animationStartPoint&&window.NEXTSTRAIN.animationEndPoint||(window.NEXTSTRAIN.animationStartPoint=this.props.dateMinNumeric,window.NEXTSTRAIN.animationEndPoint=this.props.absoluteDateMaxNumeric):(window.NEXTSTRAIN.animationStartPoint=this.props.dateMinNumeric,window.NEXTSTRAIN.animationEndPoint=this.props.dateMaxNumeric);var i=this.props.dateMinNumeric,r=i+a;this.props.dispatch({type:A.C});window.NEXTSTRAIN.animationTickReference=setInterval((function(){if("Play"===e.props.animationPlayPauseButton)return clearInterval(window.NEXTSTRAIN.animationTickReference),void(window.NEXTSTRAIN.animationTickReference=null);e.props.dispatch(Object(C.c)({newMin:Object(j.numericToCalendar)(i),newMax:Object(j.numericToCalendar)(r),quickdraw:!0})),e.props.mapAnimationCumulative||(i+=n),(r+=n)>=window.NEXTSTRAIN.animationEndPoint&&(e.props.mapAnimationShouldLoop?(i=window.NEXTSTRAIN.animationStartPoint,r=i+a):(clearInterval(window.NEXTSTRAIN.animationTickReference),window.NEXTSTRAIN.animationTickReference=null,e.props.dispatch({type:A.B,data:"Play"}),e.props.dispatch(Object(C.c)({newMin:Object(j.numericToCalendar)(window.NEXTSTRAIN.animationStartPoint),newMax:Object(j.numericToCalendar)(window.NEXTSTRAIN.animationEndPoint),quickdraw:!1})),window.NEXTSTRAIN.animationStartPoint=void 0,window.NEXTSTRAIN.animationEndPoint=void 0))}),N.animationTick)}}}]),t}(y.a.Component))||qn,sa=n(159);function la(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ca(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?la(n,!0).forEach((function(t){g()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):la(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var da=n(42),ha=n.n(da),pa=k.c.div.withConfig({displayName:"styles__NarrativeStyles",componentId:"sc-19vjmtz-0"})(["top:",";font-weight:300;font-size:14px;line-height:1.3;@media (max-width:1080px){font-size:13px;line-height:1.1;}p,h1,h2,h3,h4,li{color:",";}h1{font-weight:700;font-size:2em;margin-bottom:30px;@media (max-width:1080px){font-size:1.8em;margin-bottom:10px;}}h2{font-weight:500;font-size:1.8em;@media (max-width:1080px){font-size:1.6em;}}h3{font-weight:500;font-size:1.6em;@media (max-width:1080px){font-size:1.4em;}}h4{font-weight:500;font-size:1.4em;@media (max-width:1080px){font-size:1.2em;}}div p{text-align:justify;margin:0;font-weight:inherit;line-height:inherit;}li{margin:10px 0px 10px 0px;font-weight:inherit;line-height:inherit;}strong{font-weight:500;background-color:inherit;font-size:inherit;line-height:inherit;}img{display:block;margin-left:auto;margin-right:auto;width:90%;padding:15px 0px 15px 0px;}figcaption{font-style:italic;font-size:0.9em;text-align:center;margin-bottom:15px;}#NarrativeBlock_0{margin-top:15px;}#NarrativeBlock_0 h3{font-weight:inherit;font-size:1.2em;}#NarrativeBlock_0 h4{text-align:justify;font-size:inherit;margin:0;margin-bottom:30px;font-weight:inherit;font-style:italic;line-height:inherit;}#NarrativeBlock_0 .explanation{text-align:justify;font-size:inherit;color:",";margin:0;margin-bottom:30px;font-weight:inherit;font-style:italic;line-height:inherit;}#NarrativeBlock_0 sup{font-size:65%;vertical-align:super;}"],(function(e){return e.narrativeNavBarHeight+"px"}),(function(e){return e.theme.unselectedColor}),(function(e){return e.theme.selectedColor})),ua=k.c.div.withConfig({displayName:"styles__OpacityFade",componentId:"sc-19vjmtz-1"})(["z-index:200;position:absolute;background-image:",";width:100%;height:30px;",";",";"],(function(e){return"linear-gradient(to ".concat(e.position,", rgba(255, 255, 255, 0), ").concat(e.theme.background,")")}),(function(e){return"top"===e.position&&"top: ".concat(e.topHeight,"px")}),(function(e){return"bottom"===e.position&&"bottom: 0px;"})),ma={color:"#5097BA",textDecoration:"none",cursor:"pointer",fontFamily:'"Lato", "Helvetica Neue", "Helvetica", "sans-serif"',fontWeight:"400",fontSize:"1.8em"},fa=k.c.div.withConfig({displayName:"styles__ProgressBar",componentId:"sc-19vjmtz-2"})(["width:100%;background-color:inherit;box-shadow:0px -3px 3px -3px rgba(0,0,0,0.2) inset;display:flex;flex-direction:row;justify-content:space-evenly;align-items:center;"]),ga=k.c.div.withConfig({displayName:"styles__ProgressButton",componentId:"sc-19vjmtz-3"})(["background:#74a9cf;border-radius:50%;cursor:pointer;align-self:center;margin:auto;"]),va=Object(k.b)(["width:100%;color:white;font-size:24px;font-weight:500;cursor:pointer;display:flex;align-items:center;justify-content:center;"]),ya=k.c.div.withConfig({displayName:"styles__EndOfNarrative",componentId:"sc-19vjmtz-4"})(["text-align:center;display:grid;grid-template-rows:1fr;grid-row-gap:10px;"]),ba=k.c.nav.withConfig({displayName:"styles__MobileBannerTop",componentId:"sc-19vjmtz-5"})([""," top:0;height:","px;background-color:#E67F2C;"],va,(function(e){return e.height})),wa=k.c.nav.withConfig({displayName:"styles__MobileBannerBottom",componentId:"sc-19vjmtz-6"})([""," bottom:0;height:","px;background-color:#65B0A4;"],va,(function(e){return e.height})),xa=k.c.div.withConfig({displayName:"styles__MobileContentContainer",componentId:"sc-19vjmtz-7"})(["min-height:","px;max-height:","px;overflow-y:scroll;color:",";background-color:",";font-weight:300;font-size:14px;line-height:1.3;"],(function(e){return e.height}),(function(e){return e.height}),(function(e){return e.theme.unselectedColor}),(function(e){return e.theme.background})),ka=(n(161),n(115)),Ea=n.n(ka),Ta=Symbol(),Sa=Symbol(),Ca=Symbol(),Oa=Symbol(),ja=Symbol(),Na=Symbol(),Da=Symbol(),Ma=Symbol(),La=Symbol(),Ia=200,Ba=38,_a=40,Pa=function(e){function t(e){var n;return i()(this,t),n=l()(this,d()(t).call(this,e)),g()(p()(n),"componentDidMount",(function(){window.addEventListener("resize",n[Na]),document.ontouchmove=function(e){e.preventDefault()},n._pageContainer.addEventListener("wheel",n[Ca]),n._pageContainer.addEventListener("touchmove",n[Oa]),n._pageContainer.addEventListener("keydown",n[ja]);var e=[];Ea.a.isNil(n.props.children[n.state.componentIndex])?e.push(y.a.createElement("div",{ref:function(e){return n["container_"+n.state.componentIndex]=e},style:{height:"100%",width:"100%"}},n.props.children)):e.push(y.a.createElement("div",{key:n.state.componentIndex,ref:function(e){return n["container_"+n.state.componentIndex]=e},style:{height:"100%",width:"100%"}},n.props.children[n.state.componentIndex])),n[Da](e)})),g()(p()(n),"componentWillUnmount",(function(){window.removeEventListener("resize",n[Na]),n._pageContainer.removeEventListener("wheel",n[Ca]),n._pageContainer.removeEventListener("touchmove",n[Oa]),n._pageContainer.removeEventListener("keydown",n[ja])})),g()(p()(n),"goToPage",(function(e){var t=n.props,a=t.pageOnChange,i=t.children,r=n.state.componentIndex,o=M()(n.state.componentsToRender);if(!Ea.a.isEqual(r,e))if(Ea.a.isNil(n["container_"+e])||n[Sa]){if(!n[Sa]&&!Ea.a.isNil(i[e])){for(var s=function(e){o.push(y.a.createElement("div",{key:e,ref:function(t){return n["container_"+e]=t},style:{height:"100%",width:"100%"}},i[e]))},l=o.length;l<=e;l++)s(l);Ea.a.isNil(i[e+1])||o.push(y.a.createElement("div",{key:e+1,ref:function(t){return n["container_"+(e+1)]=t},style:{height:"100%",width:"100%"}},i[e+1])),n[Sa]=!0,n.setState({componentsToRender:o},(function(){n._pageContainer.style.transform="translate3d(0, ".concat(-100*e,"%, 0)"),a&&a(e+1),setTimeout((function(){n.setState({componentIndex:e},(function(){n[Sa]=!1,n[Ta]=null}))}),n.props.animationTimer+Ia)}))}}else n[Sa]=!0,n._pageContainer.style.transform="translate3d(0, ".concat(-100*e,"%, 0)"),a&&a(e+1),Ea.a.isNil(n["container_"+(e+1)])&&!Ea.a.isNil(i[e+1])&&o.push(y.a.createElement("div",{key:e+1,ref:function(t){return n["container_"+(e+1)]=t},style:{height:"100%",width:"100%"}},i[e+1])),setTimeout((function(){n.setState({componentIndex:e,componentsToRender:o},(function(){n[Sa]=!1,n[Ta]=null}))}),n.props.animationTimer+Ia)})),n.state={componentIndex:0,componentsToRender:[]},n[Ta]=null,n[Sa]=!1,n[Ca]=function(e){e.deltaY<0?n[Ma]():n[La]()},n[Oa]=function(e){Ea.a.isNull(n[Ta])?n[Ta]=e.touches[0].clientY:e.touches[0].clientY>n[Ta]?n[Ma]():n[La]()},n[ja]=function(e){Ea.a.isEqual(e.keyCode,Ba)&&n[Ma](),Ea.a.isEqual(e.keyCode,_a)&&n[La]()},n[Na]=function(){n.forceUpdate()},n[Da]=function(e){var t=[];Ea.a.isNil(e)||(t=M()(e)),(t=[].concat(M()(t),M()(n.state.componentsToRender)))[n.state.componentIndex+1]||Ea.a.isNil(n.props.children[n.state.componentIndex+1])||t.push(y.a.createElement("div",{key:n.state.componentIndex+1,ref:function(e){return n["container_"+(n.state.componentIndex+1)]=e},style:{height:"100%",width:"100%",overflow:"hidden"}},n.props.children[n.state.componentIndex+1])),n.setState({componentsToRender:M()(t)})},n[Ma]=function(){Ea.a.isNil(n["container_"+(n.state.componentIndex-1)])||n[Sa]?n.props.scrollUnavailable&&n.props.scrollUnavailable():(n[Sa]=!0,n._pageContainer.style.transform="translate3d(0, ".concat(-100*(n.state.componentIndex-1),"%, 0)"),n.props.pageOnChange&&n.props.pageOnChange(n.state.componentIndex),setTimeout((function(){n.setState((function(e){return{componentIndex:e.componentIndex-1}}),(function(){n[Sa]=!1,n[Ta]=null}))}),n.props.animationTimer+Ia))},n[La]=function(){Ea.a.isNil(n["container_"+(n.state.componentIndex+1)])||n[Sa]?n.props.scrollUnavailable&&n.props.scrollUnavailable():(n[Sa]=!0,n._pageContainer.style.transform="translate3d(0, ".concat(-100*(n.state.componentIndex+1),"%, 0)"),n.props.pageOnChange&&n.props.pageOnChange(n.state.componentIndex+2),setTimeout((function(){n.setState((function(e){return{componentIndex:e.componentIndex+1}}),(function(){n[Sa]=!1,n[Ta]=null,n[Da]()}))}),n.props.animationTimer+Ia))},n}return m()(t,e),o()(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.animationTimer,a=t.transitionTimingFunction,i=t.containerHeight;t.containerWidth;return y.a.createElement("div",{id:"PageScroller",style:{height:i,width:"inherit",overflow:"hidden",padding:"0px 0px 0px 0px"}},y.a.createElement("div",{ref:function(t){return e._pageContainer=t},tabIndex:0,style:{height:"100%",width:"100%",transition:"transform ".concat(n,"ms ").concat(a)}},this.state.componentsToRender))}}]),t}(y.a.Component);g()(Pa,"propTypes",{animationTimer:w.a.number,transitionTimingFunction:w.a.string,pageOnChange:w.a.func,scrollUnavailable:w.a.func,containerHeight:w.a.number,containerWidth:w.a.number}),g()(Pa,"defaultProps",{animationTimer:1e3,transitionTimingFunction:"ease-in-out",containerHeight:window.innerHeight,containerWidth:window.innerWidth});var Aa,Ra=n(67);function Fa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function za(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fa(n,!0).forEach((function(t){g()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fa(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Va,Wa,Ga,Ha=Object(x.b)((function(e){return{loaded:e.narrative.loaded,blocks:e.narrative.blocks,currentInFocusBlockIdx:e.narrative.blockIdx}}))(Aa=function(e){function t(e){var n;return i()(this,t),(n=l()(this,d()(t).call(this,e))).state={showingEndOfNarrativePage:!1},n.exitNarrativeMode=function(){n.props.dispatch(Object(Ra.b)({path:n.props.blocks[0].dataset,query:!0}))},n.changeAppStateViaBlock=function(e){var t=e-1;t!==n.props.blocks.length?(n.state.showingEndOfNarrativePage&&n.setState({showingEndOfNarrativePage:!1}),n.props.blocks[t].mainDisplayMarkdown?n.props.dispatch(Object(Ra.a)({query:ha.a.parse(n.props.blocks[t].query),queryToDisplay:{n:t}})):n.props.dispatch(Object(Ra.b)({changeDataset:!1,query:ha.a.parse(n.props.blocks[t].query),queryToDisplay:{n:t},push:!0}))):n.setState({showingEndOfNarrativePage:!0})},n.goToNextSlide=function(){n.state.showingEndOfNarrativePage||n.reactPageScroller.goToPage(n.props.currentInFocusBlockIdx+1)},n.goToPreviousSlide=function(){0!==n.props.currentInFocusBlockIdx&&n.reactPageScroller.goToPage(n.props.currentInFocusBlockIdx-1)},n}return m()(t,e),o()(t,[{key:"componentDidMount",value:function(){window.twttr&&window.twttr.ready&&window.twttr.widgets.load(),0!==this.props.currentInFocusBlockIdx&&this.reactPageScroller.goToPage(this.props.currentInFocusBlockIdx),V.a.bind(["left","up"],this.goToPreviousSlide),V.a.bind(["right","down"],this.goToNextSlide)}},{key:"renderChevron",value:function(e){var t=30,n=30,a={zIndex:200,position:"absolute",cursor:"pointer",left:"".concat(this.props.width/2-t/2,"px")};e?a.top=N.narrativeNavBarHeight+25:a.bottom=0;var i=e?"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z":"M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z";return y.a.createElement("div",{id:"hand".concat(e?"Up":"Down"),style:a,onClick:e?this.goToPreviousSlide:this.goToNextSlide},y.a.createElement("svg",{width:"".concat(t,"px"),height:"".concat(n,"px"),viewBox:"0 0 448 512"},y.a.createElement("path",{d:i,fill:"black"})))}},{key:"renderProgress",value:function(){var e=this;return y.a.createElement(fa,{style:{height:"".concat(25,"px")},role:"navigation"},this.props.blocks.map((function(t,n){var a=e.state.showingEndOfNarrativePage||e.props.currentInFocusBlockIdx!==n?"6px":"14px";return y.a.createElement(ga,{key:n,style:{width:a,height:a},onClick:function(){return e.reactPageScroller.goToPage(n)}})})))}},{key:"renderBlocks",value:function(){var e=this,t=this.props.blocks.map((function(e,t){var n=0===t?'\n  <p class="explanation">\n  Explore the content by scrolling the left hand side (or click on the arrows), and the data visualizations will change accordingly.\n  Clicking "explore the data yourself" (top right of page) will replace this narrative with a set of controls so that you may interact with the data.\n  </p>\n'+e.__html:e.__html;return y.a.createElement("div",{dir:"auto",id:"NarrativeBlock_".concat(t),key:t,style:{padding:"10px 20px",height:"inherit",overflow:"hidden"},dangerouslySetInnerHTML:{__html:n}})}));return t.push(y.a.createElement(ya,{key:"EON",id:"EndOfNarrative"},y.a.createElement("h1",null,"END OF NARRATIVE"),y.a.createElement("a",{style:za({},ma),onClick:function(){return e.reactPageScroller.goToPage(0)}},"Scroll back to the beginning"),y.a.createElement("br",null),y.a.createElement("a",{style:za({},ma),onClick:this.exitNarrativeMode},"Leave the narrative & explore the data yourself"))),t}},{key:"render",value:function(){var e=this;return this.props.loaded?y.a.createElement(pa,{id:"NarrativeContainer",narrativeNavBarHeight:N.narrativeNavBarHeight},this.renderProgress(),y.a.createElement(ua,{position:"top",topHeight:N.narrativeNavBarHeight+25}),y.a.createElement(ua,{position:"bottom"}),0!==this.props.currentInFocusBlockIdx?this.renderChevron(!0):null,this.state.showingEndOfNarrativePage?null:this.renderChevron(!1),y.a.createElement(Pa,{ref:function(t){e.reactPageScroller=t},containerHeight:this.props.height-25,pageOnChange:this.changeAppStateViaBlock},this.renderBlocks())):null}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:A.s,pathname:this.props.blocks[this.props.currentInFocusBlockIdx].dataset,query:ha.a.parse(this.props.blocks[this.props.currentInFocusBlockIdx].url)}),V.a.unbind(["left","right","up","down"])}}]),t}(y.a.Component))||Aa,qa=n(533),Ua=n(508);function Xa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Ka=Object(x.b)((function(e){return{colorBy:e.controls.colorBy,geneLength:e.controls.geneLength,colorings:e.metadata.colorings,geneMap:e.entropy.geneMap}}))((Ga=Wa=function(e){function t(e){var n;return i()(this,t),n=l()(this,d()(t).call(this,e)),g()(p()(n),"dispatchColorByGenotype",Object(ka.debounce)((function(e){n.dispatchColorBy(e,"genotype")}),400)),n.BLANK_STATE={colorBySelected:"",geneSelected:"",positionSelected:""},n.state=n.newState({colorBySelected:e.colorBy}),n}return m()(t,e),o()(t,[{key:"replaceState",value:function(e){var t=this;this.setState((function(n,a){return t.newState(e)}))}},{key:"newState",value:function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xa(n,!0).forEach((function(t){g()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xa(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.BLANK_STATE,{},e)}},{key:"componentWillReceiveProps",value:function(e){if(this.props.colorBy!==e.colorBy)if(Object(se.isColorByGenotype)(e.colorBy)){var t=Object(se.decodeColorByGenotype)(e.colorBy);t&&this.replaceState({colorBySelected:"gt",geneSelected:t.gene,positionSelected:t.positions.join(",")})}else this.replaceState({colorBySelected:e.colorBy})}},{key:"componentDidUpdate",value:function(){var e=this.state.colorBySelected;if("gt"===e){var t=this.state,n=t.geneSelected,a=t.positionSelected;if(n&&a){var i=Object(se.encodeColorByGenotype)({gene:n,positions:Object(se.decodePositions)(a,this.props.geneLength[n])});i&&this.dispatchColorByGenotype(i)}}else this.dispatchColorBy(e)}},{key:"dispatchColorBy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;Object(Xn.analyticsControlsEvent)("color-by-".concat(t)),this.props.dispatch(Object(Ot.a)(e))}},{key:"getGtGeneOptions",value:function(){var e=[];return this.props.geneMap&&((e=Object.keys(this.props.geneMap).map((function(e){return{value:e,label:e}})))[e.length]={value:N.nucleotide_gene,label:"nucleotide"}),e}},{key:"gtGeneSelect",value:function(){var e=this,t=this.getGtGeneOptions();return y.a.createElement(Ua.a,{name:"selectGenotype",id:"selectGenotype",placeholder:"gene",value:this.state.geneSelected,options:t,clearable:!1,searchable:!0,multi:!1,onChange:function(t){e.setState({geneSelected:t.value})}})}},{key:"gtPositionInput",value:function(){var e=this,t=this.state.geneSelected,n=Math.floor(this.props.geneLength[t]),a=t?"".concat(t," position (1").concat(n,")"):"position";return y.a.createElement("input",{type:"text",style:E.k,placeholder:a,value:this.state.positionSelected,onChange:function(t){e.setState({positionSelected:t.target.value})}})}},{key:"isNormalInteger",value:function(e){var t=Math.floor(Number(e));return String(t)===e&&t>=0}},{key:"getStyles",value:function(){return{base:{width:N.controlsWidth,marginBottom:0,fontSize:14}}}},{key:"render",value:function(){var e=this,t=this.getStyles(),n=Object.keys(this.props.colorings).map((function(t){return{value:t,label:e.props.colorings[t].title}}));return y.a.createElement("div",{style:t.base},y.a.createElement(Ua.a,{name:"selectColorBy",id:"selectColorBy",value:this.state.colorBySelected,options:n,clearable:!1,searchable:!1,multi:!1,onChange:function(t){e.replaceState({colorBySelected:t.value})}}),"gt"===this.state.colorBySelected?y.a.createElement("div",null,this.gtGeneSelect(),this.gtPositionInput()):null)}}]),t}(y.a.Component),g()(Wa,"propTypes",{colorBy:w.a.string.isRequired,geneLength:w.a.object.isRequired,colorings:w.a.object.isRequired,dispatch:w.a.func.isRequired}),Va=Ga))||Va,Ja=n(670),Ya=n.n(Ja),Za=n(674),$a=n.n(Za),Qa=n(502),ei=n.n(Qa);function ti(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ni(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ti(n,!0).forEach((function(t){g()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ti(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ai={base:{position:"relative",borderRadius:6},horizontalSlider:{width:"100%",height:12},verticalSlider:{maxHeight:500,width:12,border:"1px solid grey"},handle:{fontSize:"0.9em",textAlign:"center",backgroundColor:"#FAFAFA",color:"white",border:"1px solid #555",cursor:"pointer",height:12,width:12,borderRadius:12,top:-4},bar:{position:"relative",backgroundColor:"rgb(200,200,200)",borderRadius:2},unselectedBar:{backgroundColor:"#777",height:1,top:2},selectedBar:{backgroundColor:"#CCC",height:6}};function ii(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1}function ri(e){return null==e?[]:Array.isArray(e)?e:[e]}function oi(e){return null!=e&&1===e.length?e[0]:e}var si,li,ci,di,hi,pi,ui,mi,fi,gi,vi,yi,bi,wi,xi=Ya()({displayName:"Slider",propTypes:{min:w.a.number,max:w.a.number,step:w.a.number,minDistance:w.a.number,defaultValue:w.a.oneOfType([w.a.number,w.a.arrayOf(w.a.number)]),value:w.a.oneOfType([w.a.number,w.a.arrayOf(w.a.number)]),orientation:w.a.oneOf(["horizontal","vertical"]),className:w.a.string,handleClassName:w.a.string,handleActiveClassName:w.a.string,withBars:w.a.bool,barClassName:w.a.string,pearling:w.a.bool,disabled:w.a.bool,snapDragDisabled:w.a.bool,invert:w.a.bool,onBeforeChange:w.a.func,onChange:w.a.func,onAfterChange:w.a.func,onSliderClick:w.a.func},getDefaultProps:function(){return{min:0,max:100,step:1e-5,minDistance:0,defaultValue:0,orientation:"horizontal",className:"slider",handleClassName:"handle",handleActiveClassName:"active",barClassName:"bar",withBars:!1,pearling:!1,disabled:!1,snapDragDisabled:!1,invert:!1}},getInitialState:function(){var e=this._or(ri(this.props.value),ri(this.props.defaultValue));this.tempArray=e.slice();for(var t=[],n=0;n<e.length;n++)e[n]=this._trimAlignValue(e[n],this.props),t.push(n);return{index:-1,upperBound:208,sliderLength:220,handleSize:12,sliderStart:20,value:e,zIndices:t}},componentWillReceiveProps:function(e){var t=this._or(ri(e.value),this.state.value);this.tempArray=t.slice();for(var n=[],a=0;a<t.length;a++)n[a]=this._trimAlignValue(t[a],e);this.setState({value:n})},_or:function(e,t){var n=y.a.Children.count(this.props.children);switch(n){case 0:return e.length>0?e:t;case e.length:return e;case t.length:return t;default:return e.length===n&&t.length===n||console.warn(this.constructor.displayName+": Number of values does not match number of children."),function(e,t,n){for(var a=(t-e)/(n-1),i=[],r=0;r<n;r++)i.push(e+a*r);return i}(this.props.min,this.props.max,n)}},getValue:function(){return oi(this.state.value)},_calcOffset:function(e){return(e-this.props.min)/(this.props.max-this.props.min)*this.state.upperBound},_calcValue:function(e){return e/this.state.upperBound*(this.props.max-this.props.min)+this.props.min},_buildHandleStyle:function(e,t){var n={position:"absolute",willChange:this.state.index>=0?this._posMinKey():""};return n[this._posMinKey()]=e+"px",n},_getClosestIndex:function(e){for(var t=Number.MAX_VALUE,n=-1,a=this.state.value,i=a.length,r=0;r<i;r++){var o=this._calcOffset(a[r]),s=Math.abs(e-o);s<t&&(t=s,n=r)}return n},_calcOffsetFromPosition:function(e){var t=e-this.state.sliderStart;return this.props.invert&&(t=this.state.sliderLength-t),t-=this.state.handleSize/2},_forceValueFromPosition:function(e,t){var n=this._calcOffsetFromPosition(e),a=this._getClosestIndex(n),i=this._trimAlignValue(this._calcValue(n)),r=this.state.value.slice();r[a]=i;for(var o=0;o<r.length-1;o+=1)if(r[o+1]-r[o]<this.props.minDistance)return;this.setState({value:r},t.bind(this,a))},_getMousePosition:function(e){return[e["page"+this._axisKey()],e["page"+this._orthogonalAxisKey()]]},_getTouchPosition:function(e){var t=e.touches[0];return[t["page"+this._axisKey()],t["page"+this._orthogonalAxisKey()]]},_getMouseEventMap:function(){return{mousemove:this._onMouseMove,mouseup:this._onMouseUp}},_getTouchEventMap:function(){return{touchmove:this._onTouchMove,touchend:this._onTouchEnd}},_createOnMouseDown:function(e){return function(t){if(!this.props.disabled){var n=this._getMousePosition(t);this._start(e,n[0]),this._addHandlers(this._getMouseEventMap()),ii(t)}}.bind(this)},_createOnTouchStart:function(e){return function(t){if(!(this.props.disabled||t.touches.length>1)){var n=this._getTouchPosition(t);this.startPosition=n,this.isScrolling=void 0,this._start(e,n[0]),this._addHandlers(this._getTouchEventMap()),function(e){e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0}(t)}}.bind(this)},_addHandlers:function(e){for(var t in e)document.addEventListener(t,e[t],!1)},_removeHandlers:function(e){for(var t in e)document.removeEventListener(t,e[t],!1)},_start:function(e,t){document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),this.hasMoved=!1,this._fireChangeEvent("onBeforeChange");var n=this.state.zIndices;n.splice(n.indexOf(e),1),n.push(e),this.setState({startValue:this.state.value[e],startPosition:t,index:e,zIndices:n})},_onMouseUp:function(){this._onEnd(this._getMouseEventMap())},_onTouchEnd:function(){this._onEnd(this._getTouchEventMap())},_onEnd:function(e){this._removeHandlers(e),this.setState({index:-1},this._fireChangeEvent.bind(this,"onAfterChange"))},_onMouseMove:function(e){var t=this._getMousePosition(e);this._move(t[0])},_onTouchMove:function(e){if(!(e.touches.length>1)){var t=this._getTouchPosition(e);if(void 0===this.isScrolling){var n=t[0]-this.startPosition[0],a=t[1]-this.startPosition[1];this.isScrolling=Math.abs(a)>Math.abs(n)}this.isScrolling?this.setState({index:-1}):(ii(e),this._move(t[0]))}},_move:function(e){this.hasMoved=!0;var t=this.props,n=this.state,a=n.index,i=n.value,r=i.length,o=i[a],s=e-n.startPosition;t.invert&&(s*=-1);var l=s/(n.sliderLength-n.handleSize)*(t.max-t.min),c=this._trimAlignValue(n.startValue+l),d=t.minDistance;if(!t.pearling){if(a>0){var h=i[a-1];c<h+d&&(c=h+d)}if(a<r-1){var p=i[a+1];c>p-d&&(c=p-d)}}i[a]=c,t.pearling&&r>1&&(c>o?(this._pushSucceeding(i,d,a),this._trimSucceeding(r,i,d,t.max)):c<o&&(this._pushPreceding(i,d,a),this._trimPreceding(r,i,d,t.min))),c!==o&&this.setState({value:i},this._fireChangeEvent.bind(this,"onChange"))},_pushSucceeding:function(e,t,n){var a,i;for(i=e[a=n]+t;null!=e[a+1]&&i>e[a+1];i=e[++a]+t)e[a+1]=this._alignValue(i)},_trimSucceeding:function(e,t,n,a){for(var i=0;i<e;i++){var r=a-i*n;t[e-1-i]>r&&(t[e-1-i]=r)}},_pushPreceding:function(e,t,n){var a,i;for(i=e[a=n]-t;null!=e[a-1]&&i<e[a-1];i=e[--a]-t)e[a-1]=this._alignValue(i)},_trimPreceding:function(e,t,n,a){for(var i=0;i<e;i++){var r=a+i*n;t[i]<r&&(t[i]=r)}},_axisKey:function(){var e=this.props.orientation;return"horizontal"===e?"X":"vertical"===e?"Y":"X"},_orthogonalAxisKey:function(){var e=this.props.orientation;return"horizontal"===e?"Y":"vertical"===e?"X":"Y"},_posMinKey:function(){var e=this.props.orientation;return"horizontal"===e?this.props.invert?"right":"left":"vertical"===e?this.props.invert?"bottom":"top":this.props.invert?"right":"left"},_posMaxKey:function(){var e=this.props.orientation;return"horizontal"===e?this.props.invert?"left":"right":"vertical"===e?this.props.invert?"top":"bottom":this.props.invert?"left":"right"},_sizeKey:function(){var e=this.props.orientation;return"horizontal"===e?"clientWidth":"vertical"===e?"clientHeight":"clientWidth"},_trimAlignValue:function(e,t){return this._alignValue(this._trimValue(e,t),t)},_trimValue:function(e,t){return e<=(t=t||this.props).min&&(e=t.min),e>=t.max&&(e=t.max),e},_alignValue:function(e,t){var n=(e-(t=t||this.props).min)%t.step,a=e-n;return 2*Math.abs(n)>=t.step&&(a+=n>0?t.step:-t.step),parseFloat(a.toFixed(5))},_renderHandle:function(e,t){var n=this.props.handleClassName+" "+this.props.handleClassName+"-"+t+" "+(this.state.index===t?this.props.handleActiveClassName:"");return y.a.createElement("div",{ref:"handle"+t,key:"handle"+t,className:n,style:ni({},ai.handle,{},e),onMouseDown:this._createOnMouseDown(t),onTouchStart:this._createOnTouchStart(t)})},_renderHandles:function(e){for(var t=e.length,n=this.tempArray,a=0;a<t;a++)n[a]=this._buildHandleStyle(e[a],a);for(var i=this.tempArray,r=0;r<t;r++)i[r]=this._renderHandle(n[r],r);return i},_buildBarStyle:function(e,t){var n={position:"absolute",willChange:this.state.index>=0?this._posMinKey()+","+this._posMaxKey():""};return n[this._posMinKey()]=e,n[this._posMaxKey()]=t,n},_renderBar:function(e,t,n){var a=this.props.barClassName+" "+this.props.barClassName+"-"+e,i=this._buildBarStyle(t,this.state.upperBound-n);return i=0===e&&!ei()(this.props.defaultValue)||1===e&&ei()(this.props.defaultValue)?$a()({},i,ai.selectedBar):$a()({},i,ai.unselectedBar),y.a.createElement("div",{key:"bar"+e,ref:"bar"+e,className:a,style:ni({},ai.bar,{},i)})},_renderBars:function(e){var t=[],n=e.length-1;t.push(this._renderBar(0,0,e[0]));for(var a=0;a<n;a++)t.push(this._renderBar(a+1,e[a],e[a+1]));return t.push(this._renderBar(n+1,e[n],this.state.upperBound)),t},_onSliderMouseDown:function(e){if(!this.props.disabled){if(this.hasMoved=!1,!this.props.snapDragDisabled){var t=this._getMousePosition(e);this._forceValueFromPosition(t[0],function(e){this._fireChangeEvent("onChange"),this._start(e,t[0]),this._addHandlers(this._getMouseEventMap())}.bind(this))}ii(e)}},_onSliderClick:function(e){if(!this.props.disabled&&this.props.onSliderClick&&!this.hasMoved){var t=this._getMousePosition(e),n=this._trimAlignValue(this._calcValue(this._calcOffsetFromPosition(t[0])));this.props.onSliderClick(n)}},_fireChangeEvent:function(e){this.props[e]&&this.props[e](oi(this.state.value))},render:function(){for(var e=this.tempArray,t=this.state.value,n=this.state.value.length,a=0;a<n;a++)e[a]=this._calcOffset(t[a],a);var i="vertical"===this.props.orientation?ai.verticalSlider:ai.horizontalSlider;return y.a.createElement("div",{ref:"slider",style:ni({},ai.base,{},i),onMouseDown:this._onSliderMouseDown,onClick:this._onSliderClick},this.props.withBars?this._renderBars(e):null,this._renderHandles(e))}}),ki=k.c.div.withConfig({displayName:"date-range-inputs__DateLabel",componentId:"sc-1amycy9-0"})(["font-family:",";margin-bottom:5px;font-size:12px;font-weight:400;color:",";float:",";"],(function(e){return e.theme["font-family"]}),(function(e){return e.theme.color}),(function(e){return e.right?"right":"left"})),Ei=Object(x.b)((function(e){return{branchLengthsToDisplay:e.controls.branchLengthsToDisplay,dateMin:e.controls.dateMin,dateMax:e.controls.dateMax,dateMinNumeric:e.controls.dateMinNumeric,dateMaxNumeric:e.controls.dateMaxNumeric,absoluteDateMin:e.controls.absoluteDateMin,absoluteDateMax:e.controls.absoluteDateMax,absoluteDateMinNumeric:e.controls.absoluteDateMinNumeric,absoluteDateMaxNumeric:e.controls.absoluteDateMaxNumeric}}))(si=function(e){function t(e){var n;return i()(this,t),(n=l()(this,d()(t).call(this,e))).state={lastSliderUpdateTime:Date.now()},n}return m()(t,e),o()(t,[{key:"maybeClearMapAnimationInterval",value:function(){window.NEXTSTRAIN&&window.NEXTSTRAIN.animationTickReference&&(clearInterval(window.NEXTSTRAIN.animationTickReference),window.NEXTSTRAIN.animationTickReference=null,this.props.dispatch({type:A.B,data:"Play"}))}},{key:"updateFromSlider",value:function(e,t){if(this.maybeClearMapAnimationInterval(),e){var n=Date.now();if(n<this.state.lastSliderUpdateTime+100)return null;this.setState({lastSliderUpdateTime:n})}var a={min:Object(j.numericToCalendar)(t[0]),max:Object(j.numericToCalendar)(t[1])};return this.props.dateMin!==a.min&&this.props.dateMax===a.max?this.props.dispatch(Object(C.c)({newMin:a.min,quickdraw:e})):this.props.dateMin===a.min&&this.props.dateMax!==a.max?this.props.dispatch(Object(C.c)({newMax:a.max,quickdraw:e})):this.props.dateMin!==a.min&&this.props.dateMax!==a.max?this.props.dispatch(Object(C.c)({newMin:a.min,newMax:a.max,quickdraw:e})):!1===e&&this.props.dispatch(Object(C.c)({quickdraw:e})),null}},{key:"render",value:function(){return"divOnly"===this.props.branchLengthsToDisplay?null:y.a.createElement("div",null,y.a.createElement("div",{style:{width:N.controlsWidth}},y.a.createElement(xi,{min:this.props.absoluteDateMinNumeric,max:this.props.absoluteDateMaxNumeric,defaultValue:[this.props.absoluteDateMinNumeric,this.props.absoluteDateMaxNumeric],value:[this.props.dateMinNumeric,this.props.dateMaxNumeric],onChange:this.updateFromSlider.bind(this,!0),onAfterChange:this.updateFromSlider.bind(this,!1),minDistance:N.minDistanceDateSlider*(this.props.absoluteDateMaxNumeric-this.props.absoluteDateMinNumeric),pearling:!0,withBars:!0})),y.a.createElement("div",{style:{height:5}}),y.a.createElement("div",{style:{width:N.controlsWidth}},y.a.createElement(ki,null,this.props.dateMin),y.a.createElement(ki,{right:!0},this.props.dateMax)))}}]),t}(y.a.Component))||si,Ti=k.c.div.withConfig({displayName:"styles__ControlsContainer",componentId:"sc-3vqs3j-0"})(["display:flex;flex-direction:column;align-content:stretch;flex-wrap:nowrap;height:100%;order:0;flex-grow:0;flex-shrink:1;flex-basis:auto;align-self:auto;padding:0px 20px 20px 20px;"]),Si=k.c.span.withConfig({displayName:"styles__SidebarHeader",componentId:"sc-3vqs3j-1"})(["font-family:",";font-size:16px;line-height:28px;margin-top:15px;margin-bottom:5px;font-weight:500;color:",";"],(function(e){return e.theme["font-family"]}),(function(e){return e.theme.color})),Ci=k.c.button.withConfig({displayName:"styles__SidebarButton",componentId:"sc-3vqs3j-2"})(["border:0px;background-color:inherit;margin:5px 0px 10px 5px;border-radius:2px;cursor:pointer;padding:2px;font-family:",";color:",";font-weight:400;text-transform:uppercase;font-size:14px;vertical-align:top;outline:0;"],(function(e){return e.theme["font-family"]}),(function(e){return e.selected?e.theme.selectedColor:e.theme.unselectedColor})),Oi=k.c.div.withConfig({displayName:"styles__SidebarSubtitle",componentId:"sc-3vqs3j-3"})(["font-family:",";margin:","px 0px 5px 0px;font-size:12px;font-weight:400;color:",";"],(function(e){return e.theme["font-family"]}),(function(e){return e.spaceAbove?"5":"0"}),(function(e){return e.theme.color})),ji=Object(x.b)((function(e){return{selected:e.controls.selectedBranchLabel,available:e.tree.availableBranchLabels}}))(li=function(e){function t(e){var n;return i()(this,t),(n=l()(this,d()(t).call(this,e))).change=function(e){n.props.dispatch({type:A.m,value:e.value})},n}return m()(t,e),o()(t,[{key:"render",value:function(){return y.a.createElement("div",{style:{paddingTop:5}},y.a.createElement(Oi,null,"Branch Labels"),y.a.createElement("div",{style:{width:N.controlsWidth,fontSize:14}},y.a.createElement(Ua.a,{value:this.props.selected,options:this.props.available.map((function(e){return{value:e,label:e}})),clearable:!1,searchable:!1,multi:!1,onChange:this.change})))}}]),t}(y.a.Component))||li,Ni=Object(k.d)(vt),Di=Object(k.d)((function(e){var t=e.theme,n=e.selected,a=e.width,i=n?t.selectedColor:t.unselectedColor;return y.a.createElement("svg",{width:a,height:a+5},y.a.createElement("g",{transform:"translate(0,0)"},y.a.createElement("svg",{width:a,height:a,viewBox:"14 14 25 26"},y.a.createElement("g",{id:"Group",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",transform:"translate(15.000000, 15.000000)"},y.a.createElement("path",{d:"M15,15 L17.6450195,15",id:"Path-12",stroke:i}),y.a.createElement("path",{d:"M15.229248,22.5795898 L15.229248,18.2854004 C15.229248,18.2854004 17.8465223,17.6291504 17.8508301,15.0574951 C17.8551378,12.4858398 15.2944336,11.9138184 15.2944336,11.9138184 L15.229248,7.53540039",id:"Path-13",stroke:i}),y.a.createElement("path",{d:"M7.63037109,6.10498047 L10.230957,9.08325195 C10.230957,9.08325195 12.25,7.08233714 15.126709,7.04162598 C18.003418,7.00091481 20.5390625,8.91748047 20.5390625,8.91748047 L22.9765625,5.60839844",id:"Path-14",stroke:i}),y.a.createElement("path",{d:"M0.15942005,4.99135298 L2.76065146,7.96962446 C2.76065146,7.96962446 4.78019556,5.96870965 7.65761856,5.92799848 C10.5350415,5.88728732 13.0713154,7.80385298 13.0713154,7.80385298 L15.5094204,4.49477094",id:"Path-14",stroke:i,transform:"translate(7.834420, 6.232198) rotate(-34.000000) translate(-7.834420, -6.232198) "}),y.a.createElement("path",{d:"M7.5,21.496582 L10.1005859,24.4748535 C10.1005859,24.4748535 12.1196289,22.4739387 14.9963379,22.4332275 C17.8730469,22.3925164 20.4086914,24.309082 20.4086914,24.309082 L22.8461914,21",id:"Path-14",stroke:i,transform:"translate(15.173096, 22.737427) scale(1, -1) translate(-15.173096, -22.737427) "})))))})),Mi=Object(k.d)((function(e){var t=e.theme,n=e.selected,a=e.width,i=n?t.selectedColor:t.unselectedColor;return y.a.createElement("svg",{width:a,height:a+5},y.a.createElement("g",{transform:"translate(0,2)"},y.a.createElement("svg",{width:a,height:a,viewBox:"106 49 150 118"},y.a.createElement("polyline",{id:"Path-2",stroke:i,strokeWidth:"4",fill:"none",points:"108 77 125.182237 87.8599894 133.381156 119.402591 111.867082 144.368016"}),y.a.createElement("path",{d:"M125.2,87.5 L137.624777,70",id:"Path-3",stroke:i,strokeWidth:"4",fill:"none"}),y.a.createElement("polyline",{id:"Path-4",stroke:i,strokeWidth:"4",fill:"none",points:"133 119.331781 192.127357 119.400002 215.445998 80.3916603 203.946476 51.4000015"}),y.a.createElement("path",{d:"M215.5,80.5 L253.378522,73",id:"Path-5",stroke:i,strokeWidth:"4",fill:"none"}),y.a.createElement("path",{d:"M192,119.2 L229.854937,164.55391",id:"Path-6",stroke:i,strokeWidth:"4",fill:"none"}))))})),Li=Object(k.d)((function(e){var t=e.theme,n=e.selected,a=e.width,i=n?t.selectedColor:t.unselectedColor;return y.a.createElement("svg",{width:a,height:a+5},y.a.createElement("g",{transform:"translate(0,4)"},y.a.createElement("svg",{width:a,height:a,viewBox:"0 0 30 30 "},y.a.createElement("g",{id:"Group",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",transform:"translate(17.000000, 20.000000)"},y.a.createElement("polyline",{id:"Path-3",stroke:i,points:"-15 5 -15 -25 "}),y.a.createElement("polyline",{id:"Path-4",stroke:i,points:"-15 5 25 5"}),y.a.createElement("polyline",{id:"Path-5",stroke:i,points:"-12 3 20 -25 "}),y.a.createElement("circle",{id:"c-1",stroke:i,cx:"-8",cy:"0",r:"2"}),y.a.createElement("circle",{id:"c-2",stroke:i,cx:"4",cy:"-10",r:"2"}),y.a.createElement("circle",{id:"c-3",stroke:i,cx:"4",cy:"-15",r:"2"}),y.a.createElement("circle",{id:"c-4",stroke:i,cx:"-4",cy:"-5",r:"2"}),y.a.createElement("circle",{id:"c-5",stroke:i,cx:"-2",cy:"-11",r:"2"})))))})),Ii=k.c.div.withConfig({displayName:"choose-layout__RowContainer",componentId:"sc-16x4jtt-0"})(["padding:0px 5px 1px 5px;"]),Bi=Object(x.b)((function(e){return{layout:e.controls.layout,showTreeToo:e.controls.showTreeToo,branchLengthsToDisplay:e.controls.branchLengthsToDisplay}}))((hi=di=function(e){function t(){return i()(this,t),l()(this,d()(t).apply(this,arguments))}return m()(t,e),o()(t,[{key:"render",value:function(){var e=this;if(this.props.showTreeToo)return null;var t=this.props.layout,n=window.NEXTSTRAIN&&window.NEXTSTRAIN.animationTickReference;return y.a.createElement("div",{style:{marginBottom:15}},y.a.createElement(Oi,null,"Layout"),y.a.createElement(Ii,null,y.a.createElement(Ni,{width:25,selected:"rect"===t}),y.a.createElement(Ci,{selected:"rect"===t,onClick:function(){n||(Object(Xn.analyticsControlsEvent)("change-layout-rectangular"),e.props.dispatch({type:A.q,data:"rect"}))}},"rectangular")),y.a.createElement(Ii,null,y.a.createElement(Di,{width:25,selected:"radial"===t}),y.a.createElement(Ci,{selected:"radial"===t,onClick:function(){n||(Object(Xn.analyticsControlsEvent)("change-layout-radial"),e.props.dispatch({type:A.q,data:"radial"}))}},"radial")),y.a.createElement(Ii,null,y.a.createElement(Mi,{width:25,selected:"unrooted"===t}),y.a.createElement(Ci,{selected:"unrooted"===t,onClick:function(){n||(Object(Xn.analyticsControlsEvent)("change-layout-unrooted"),e.props.dispatch({type:A.q,data:"unrooted"}))}},"unrooted")),"divAndDate"===this.props.branchLengthsToDisplay?y.a.createElement(Ii,null,y.a.createElement(Li,{width:25,selected:"clock"===t}),y.a.createElement(Ci,{selected:"clock"===t,onClick:function(){n||(Object(Xn.analyticsControlsEvent)("change-layout-clock"),e.props.dispatch({type:A.q,data:"clock"}))}},"clock")):null)}}]),t}(y.a.Component),g()(di,"propTypes",{layout:w.a.string.isRequired,dispatch:w.a.func.isRequired}),ci=hi))||ci,_i=function(e){function t(){return i()(this,t),l()(this,d()(t).apply(this,arguments))}return m()(t,e),o()(t,[{key:"createDataPath",value:function(e){var t=this.props.choice_tree.length>0?"/":"";return t=(t+=this.props.choice_tree.join("/")+"/"+e).replace(/\/+/,"/")}},{key:"changeDataset",value:function(e){Object(Xn.analyticsControlsEvent)("change-virus-to-".concat(e.replace(/\//g,""))),window.NEXTSTRAIN&&window.NEXTSTRAIN.animationTickReference&&(clearInterval(window.NEXTSTRAIN.animationTickReference),window.NEXTSTRAIN.animationTickReference=null,this.props.dispatch({type:A.B,data:"Play"})),this.props.dispatch(Object(Ra.b)({path:e}))}},{key:"getDatasetOptions",value:function(){return this.props.options?this.props.options.map((function(e){return{value:e,label:e}})):{}}},{key:"render",value:function(){var e=this,t=this.getDatasetOptions();return y.a.createElement("div",{style:{width:N.controlsWidth,fontSize:14}},y.a.createElement(Ua.a,{value:this.props.selected,options:t,clearable:!1,searchable:!1,multi:!1,onChange:function(t){e.changeDataset(e.createDataPath(t.value))}}))}}]),t}(y.a.Component),Pi=Object(x.b)((function(e){return{available:e.controls.available}}))(pi=function(e){function t(){return i()(this,t),l()(this,d()(t).apply(this,arguments))}return m()(t,e),o()(t,[{key:"render",value:function(){var e=this;if(!this.props.available||!this.props.available.datasets||!this.props.available.datasets.length)return null;var t=window.location.pathname.replace(/^\//,"").replace(/\/$/,"").split(":")[0].split("/"),n=[[]];this.props.available.datasets.forEach((function(e){var t=e.request.split("/")[0];n[0].includes(t)||n[0].push(t)}));for(var a=function(a){n[a]=[],e.props.available.datasets.forEach((function(e){var i,r,o=e.request.split("/");i=t,r=a,o.slice(0,r).every((function(e,t){return e===i[t]}))&&-1===n[a].indexOf(o[a])&&n[a].push(o[a])}))},i=1;i<t.length;i++)a(i);return y.a.createElement(y.a.Fragment,null,y.a.createElement(Si,null,"Dataset"),n.map((function(n,a){return y.a.createElement(_i,{key:n,dispatch:e.props.dispatch,choice_tree:t.slice(0,a),selected:t[a],options:n})})))}}]),t}(y.a.Component))||pi,Ai=n(200),Ri=Object(x.b)((function(e){return{available:e.controls.available,treeName:e.tree.name,showTreeToo:e.controls.showTreeToo}}))(ui=function(e){function t(){return i()(this,t),l()(this,d()(t).apply(this,arguments))}return m()(t,e),o()(t,[{key:"render",value:function(){var e=this;if(!this.props.available||!this.props.available.datasets)return null;var t=window.location.pathname.replace(/^\//,"").replace(/\/$/,"").split(":")[0],n=[];return this.props.available.datasets.filter((function(e){return e.request===t&&(n=M()(e.secondTreeOptions)),null})),this.props.showTreeToo&&n.unshift("REMOVE"),y.a.createElement("div",null,y.a.createElement(Oi,{spaceAbove:!0},"Second Tree"),y.a.createElement("div",{key:"treetooselect",style:{width:N.controlsWidth,fontSize:14}},y.a.createElement(Ua.a,{name:"selectTreeToo",id:"selectTreeToo",value:this.props.showTreeToo,options:n.map((function(e){return{value:e,label:e}})),clearable:!1,searchable:!1,multi:!1,onChange:function(n){"REMOVE"===n.value?e.props.dispatch({type:A.I}):e.props.dispatch(Object(Ai.b)(n.value,t))}})))}}]),t}(y.a.Component))||ui,Fi=k.c.label.withConfig({displayName:"toggle__ToggleBackground",componentId:"sc-1r21f6e-0"})(["position:relative;display:inline-block;width:35px;height:21px;input{display:none;}input:checked{background-color:",";}"],(function(e){return e.theme.unselectedColor})),zi=Object(k.c)(Oi).withConfig({displayName:"toggle__ToggleSubtitle",componentId:"sc-1r21f6e-1"})(["margin-left:40px;margin-top:4px;width:200px;"]),Vi=k.c.div.withConfig({displayName:"toggle__Slider",componentId:"sc-1r21f6e-2"})(["&{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:",';-webkit-transition:.4s;transition:.4s;border-radius:12px;}&:before{position:absolute;content:"";height:15px;width:15px;left:4px;bottom:3px;background-color:#FFF;-webkit-transition:.4s;transition:.4s;border-radius:50%;}input:checked + &:before{-webkit-transform:translateX(13px);-ms-transform:translateX(13px);transform:translateX(13px);}'],(function(e){return e.theme.unselectedBackground})),Wi=k.c.input.withConfig({displayName:"toggle__Input",componentId:"sc-1r21f6e-3"})(['&{margin-left:"40px"}&:checked + ',"{background-color:",";}&:focus{box-shadow:0 0 1px #2196F3;}"],Vi,(function(e){return e.theme.selectedColor})),Gi=function(e){var t=e.display,n=e.on,a=e.callback,i=e.label,r=e.style,o=void 0===r?{}:r;return t?y.a.createElement("div",{style:o},y.a.createElement(Fi,null,y.a.createElement(Wi,{type:"checkbox",checked:n,onChange:a}),y.a.createElement(Vi,null),""===i?null:y.a.createElement(zi,null,i))):null},Hi=Object(x.b)((function(e){return{distanceMeasure:e.controls.distanceMeasure,showTreeToo:e.controls.showTreeToo,branchLengthsToDisplay:e.controls.branchLengthsToDisplay,temporalConfidence:e.controls.temporalConfidence}}))(mi=function(e){function t(){return i()(this,t),l()(this,d()(t).apply(this,arguments))}return m()(t,e),o()(t,[{key:"render",value:function(){var e=this;return"divAndDate"!==this.props.branchLengthsToDisplay?null:y.a.createElement("div",{style:{marginBottom:0}},y.a.createElement(Oi,null,"Branch Length"),y.a.createElement(Ci,{selected:"num_date"===this.props.distanceMeasure,onClick:function(){Object(Xn.analyticsControlsEvent)("tree-metric-temporal"),e.props.dispatch({type:A.o,data:"num_date"})}},"time"),y.a.createElement("span",{style:{paddingRight:"12px"}}),y.a.createElement(Ci,{selected:"div"===this.props.distanceMeasure,onClick:function(){Object(Xn.analyticsControlsEvent)("tree-metric-temporal"),e.props.dispatch({type:A.o,data:"div"})}},"divergence"),this.props.showTreeToo?null:y.a.createElement("div",{style:{margin:5}},y.a.createElement(Gi,{display:this.props.temporalConfidence.display,on:this.props.temporalConfidence.on,callback:function(){return e.props.dispatch(Object(C.d)())},label:"Show confidence intervals"})))}}]),t}(y.a.Component))||mi,qi=k.c.span.withConfig({displayName:"panel-layout__ButtonText",componentId:"sc-12zrah-0"})(["margin:5px;position:relative;top:-1px;"]),Ui=Object(k.d)((function(e){var t=e.theme,n=e.selected,a=e.width,i=n?t.selectedColor:t.unselectedColor;return y.a.createElement("svg",{width:a,height:a+5},y.a.createElement("g",{transform:"translate(0,6)"},y.a.createElement("svg",{width:a,height:a,viewBox:"0 0 30 30 "},y.a.createElement("g",{id:"Group",stroke:"none",strokeWidth:"1",fillRule:"evenodd"},y.a.createElement("rect",{fill:"none",stroke:i,x:"1",y:"1",width:"7",height:"25"}),y.a.createElement("rect",{fill:"none",stroke:i,x:"8",y:"1",width:"20",height:"25"})))))})),Xi=Object(k.d)(yt),Ki=Object(x.b)((function(e){return{panelLayout:e.controls.panelLayout,canTogglePanelLayout:e.controls.canTogglePanelLayout}}))(fi=function(e){function t(){return i()(this,t),l()(this,d()(t).apply(this,arguments))}return m()(t,e),o()(t,[{key:"render",value:function(){var e=this;return this.props.canTogglePanelLayout?y.a.createElement("div",{style:{marginTop:0,marginBottom:10}},y.a.createElement(Ui,{width:22,selected:"full"===this.props.panelLayout}),y.a.createElement(Ci,{selected:"full"===this.props.panelLayout,onClick:function(){Object(Xn.analyticsControlsEvent)("change-layout-full"),e.props.dispatch({type:A.r,data:"full"})}},y.a.createElement(qi,null,"full")),y.a.createElement(Xi,{width:22,selected:"grid"===this.props.panelLayout}),y.a.createElement(Ci,{selected:"grid"===this.props.panelLayout,onClick:function(){Object(Xn.analyticsControlsEvent)("change-layout-grid"),e.props.dispatch({type:A.r,data:"grid"})}},y.a.createElement(qi,null,"grid"))):null}}]),t}(y.a.Component))||fi,Ji=Object(x.b)((function(e){return{metadata:e.metadata,geoResolution:e.controls.geoResolution}}))(gi=function(e){function t(){return i()(this,t),l()(this,d()(t).apply(this,arguments))}return m()(t,e),o()(t,[{key:"getGeoResolutionOptions",value:function(){return this.props.metadata.loaded?this.props.metadata.geoResolutions.map((function(e){return{value:e.key,label:e.title||e.key}})):[]}},{key:"changeGeoResolution",value:function(e){Object(Xn.analyticsControlsEvent)("change-geo-resolution"),this.props.dispatch({type:A.p,data:e})}},{key:"render",value:function(){var e=this,t=this.getGeoResolutionOptions();return y.a.createElement(y.a.Fragment,null,y.a.createElement(Oi,{spaceAbove:!0},"Geographic resolution"),y.a.createElement("div",{style:{marginBottom:10,width:N.controlsWidth,fontSize:14}},y.a.createElement(Ua.a,{name:"selectGeoResolution",id:"selectGeoResolution",value:this.props.geoResolution,options:t,clearable:!1,searchable:!1,multi:!1,onChange:function(t){e.changeGeoResolution(t.value)}})))}}]),t}(y.a.Component))||gi,Yi=Object(x.b)((function(e){return{branchLengthsToDisplay:e.controls.branchLengthsToDisplay,mapAnimationStartDate:e.controls.mapAnimationStartDate,mapAnimationDurationInMilliseconds:e.controls.mapAnimationDurationInMilliseconds,mapAnimationCumulative:e.controls.mapAnimationCumulative,mapAnimationShouldLoop:e.controls.mapAnimationShouldLoop}}))(vi=function(e){function t(){return i()(this,t),l()(this,d()(t).apply(this,arguments))}return m()(t,e),o()(t,[{key:"handleChangeAnimationTimeClicked",value:function(e){var t=this;return function(){var n;window.NEXTSTRAIN&&window.NEXTSTRAIN.animationTickReference||(Object(Xn.analyticsControlsEvent)("change-animation-time"),"slow"===e?n=6e4:"medium"===e?n=3e4:"fast"===e?n=15e3:console.warn("Odd... controls/map-animation.js tried to set an animation speed we don't offer..."),t.props.dispatch({type:A.l,data:n}))}}},{key:"render",value:function(){var e=this;return"divOnly"===this.props.branchLengthsToDisplay?null:y.a.createElement("div",{id:"mapAnimationControls"},y.a.createElement(Oi,{spaceAbove:!0},"Animation Speed"),y.a.createElement(Ci,{selected:6e4===this.props.mapAnimationDurationInMilliseconds,onClick:this.handleChangeAnimationTimeClicked("slow")},"Slow"),y.a.createElement(Ci,{selected:3e4===this.props.mapAnimationDurationInMilliseconds,onClick:this.handleChangeAnimationTimeClicked("medium")},"Medium"),y.a.createElement(Ci,{selected:15e3===this.props.mapAnimationDurationInMilliseconds,onClick:this.handleChangeAnimationTimeClicked("fast")},"Fast"),y.a.createElement("div",{style:{marginBottom:5}}),y.a.createElement(Gi,{display:!0,on:this.props.mapAnimationShouldLoop,callback:function(){e.props.dispatch({type:A.j,data:!e.props.mapAnimationShouldLoop})},label:"Loop animation"}),y.a.createElement("br",null),y.a.createElement(Gi,{display:!0,on:this.props.mapAnimationCumulative,callback:function(){Object(Xn.analyticsControlsEvent)("change-animation-cumulative"),e.props.dispatch({type:A.i,data:!e.props.mapAnimationCumulative})},label:"Animate cumulative history"}))}}]),t}(y.a.Component))||vi,Zi=Object(x.b)((function(e){return{panelsAvailable:e.controls.panelsAvailable,panelsToDisplay:e.controls.panelsToDisplay,showTreeToo:e.controls.showTreeToo}}))(yi=function(e){function t(){return i()(this,t),l()(this,d()(t).apply(this,arguments))}return m()(t,e),o()(t,[{key:"render",value:function(){var e=this,t=this.props.panelsAvailable.slice();return this.props.showTreeToo&&-1!==t.indexOf("map")&&t.splice(t.indexOf("map"),1),t.map((function(t){return y.a.createElement(Gi,{key:t,display:!0,on:-1!==e.props.panelsToDisplay.indexOf(t),callback:function(){return e.props.dispatch((n=t,function(e,t){var a,i=t().controls,r=i.panelsToDisplay.indexOf(n);-1===r?a=i.panelsAvailable.filter((function(e){return-1!==i.panelsToDisplay.indexOf(e)||e===n})):(a=i.panelsToDisplay.slice()).splice(r,1);var o=i.panelLayout;-1!==a.indexOf("tree")&&-1!==a.indexOf("map")||(o="full"),e({type:A.N,panelsToDisplay:a,panelLayout:o})}));var n},label:"Show "+t,style:{paddingBottom:"10px"}})}))}}]),t}(y.a.Component))||yi,$i=n(684),Qi=n.n($i),er=(n(685),function(e){var t=e.onClick;return e.show?y.a.createElement("div",{className:"boxed-item-icon",style:{float:"right",height:"23px",width:"23px",borderTopRightRadius:"2px",borderBottomRightRadius:"2px",borderRightWidth:"1px",fontSize:18},onClick:t},""):null}),tr=k.c.div.withConfig({displayName:"search__Container",componentId:"sc-1t5klrg-0"})(["font-family:",";font-size:14px;display:inline-block;color:",";"],(function(e){return e.theme["font-family"]}),(function(e){return e.theme.color})),nr=k.c.div.withConfig({displayName:"search__InputContainer",componentId:"sc-1t5klrg-1"})(["width:80%;display:inline-block;"]),ar=k.c.input.withConfig({displayName:"search__Input",componentId:"sc-1t5klrg-2"})(["fontFamily:inherit;color:inherit;fontSize:inherit;width:100%;height:23px;padding-left:7px;border-radius:4px;border:1px solid #ccc;"]),ir=Object(x.b)((function(e){return{nodes:e.tree.nodes,version:e.tree.version,visibility:e.tree.visibility,selectedStrain:e.tree.selectedStrain}}))(bi=function(e){function t(){var e;return i()(this,t),(e=l()(this,d()(t).call(this))).state={awesomplete:void 0,show:!1},e.removeSelection=function(){e.ref.value=null,e.props.dispatch(Object(C.f)({tipSelected:{clear:!0}})),e.props.dispatch(Object(C.e)()),e.setState({show:!1})},e}return m()(t,e),o()(t,[{key:"componentDidMount",value:function(){var e=this,t=new Qi.a(this.ref,{maxItems:1e3});this.ref.addEventListener("input",(function(t){var n=t.target.value.toLowerCase().trim();e.props.dispatch(Object(C.e)({searchNodes:n.length>1?n:""}))})),this.ref.addEventListener("awesomplete-selectcomplete",(function(t){for(var n=t.text.value,a=0;a<e.props.nodes.length;a++)if(e.props.nodes[a].name===n){e.props.dispatch(Object(C.f)({tipSelected:{treeIdx:e.props.nodes[a].arrayIdx}})),e.props.dispatch(Object(C.e)({tipSelectedIdx:e.props.nodes[a].arrayIdx}));break}e.setState({show:!0})})),this.setState({awesomplete:t})}},{key:"componentWillReceiveProps",value:function(e){this.props.selectedStrain&&!e.selectedStrain&&(this.ref.value=null,this.setState({show:!1}))}},{key:"updateVisibleStrains",value:function(){var e=this;this.state.awesomplete.list=this.props.nodes.filter((function(t){return!t.hasChildren&&e.props.visibility[t.arrayIdx]===N.NODE_VISIBLE})).map((function(e){return e.name})),this.state.awesomplete.evaluate()}},{key:"render",value:function(){var e=this;return y.a.createElement(tr,null,y.a.createElement(Oi,{spaceAbove:!0},"Search Strains"),y.a.createElement(nr,null,y.a.createElement(ar,{ref:function(t){e.ref=t},onFocus:function(){return e.updateVisibleStrains()}})),y.a.createElement(er,{show:this.state.show,onClick:this.removeSelection}))}}]),t}(y.a.Component))||bi,rr=Object(x.b)((function(e){return{showTreeToo:e.controls.showTreeToo,showTangle:e.controls.showTangle}}))(wi=function(e){function t(){return i()(this,t),l()(this,d()(t).apply(this,arguments))}return m()(t,e),o()(t,[{key:"render",value:function(){var e=this;return this.props.showTreeToo?y.a.createElement(Gi,{display:!0,on:this.props.showTangle,callback:function(){return e.props.dispatch({type:A.P})},label:"Show Tanglegram",style:{paddingTop:"10px"}}):null}}]),t}(y.a.Component))||wi,or=function(e){var t=e.mapOn;return y.a.createElement(Ti,null,y.a.createElement(Pi,null),y.a.createElement(Si,null,"Date Range"),y.a.createElement(Ei,null),y.a.createElement(Si,null,"Color By"),y.a.createElement(Ka,null),y.a.createElement(Si,null,"Tree Options"),y.a.createElement(Bi,null),y.a.createElement(Hi,null),y.a.createElement(ji,null),y.a.createElement(ir,null),y.a.createElement(Ri,null),y.a.createElement(rr,null),t?y.a.createElement("span",{style:{marginTop:"15px"}},y.a.createElement(Si,null,"Map Options"),y.a.createElement(Ji,null),y.a.createElement(Yi,null)):null,y.a.createElement("span",{style:{paddingTop:"10px"}}),y.a.createElement(Si,null,"Panel Options"),y.a.createElement(Ki,null),y.a.createElement(Zi,null))},sr=n(20);function lr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var cr=k.c.div.withConfig({displayName:"styles__PanelsContainer",componentId:"sc-18umnzu-0"})(["position:absolute;top:0;bottom:0;right:0;transition:left 0.3s ease-out;background-color:#fff;height:",";width:",";overflow-x:hidden;overflow-y:scroll;left:",";"],(function(e){return e.height+"px"}),(function(e){return e.width+"px"}),(function(e){return e.left+"px"})),dr=k.c.div.withConfig({displayName:"styles__SidebarContainer",componentId:"sc-18umnzu-1"})(["position:absolute;top:0;bottom:0;right:0;transition:left 0.3s ease-out;left:",";background-color:",";height:",";width:",";max-width:",";overflow-y:auto;overflow-x:hidden;box-shadow:-3px 0px 3px -3px "," inset;font-family:",";"],(function(e){return e.left+"px"}),(function(e){return e.theme.background}),(function(e){return e.height+"px"}),(function(e){return e.width+"px"}),(function(e){return e.width+"px"}),(function(e){return e.theme.sidebarBoxShadow}),(function(e){return e.theme["font-family"]})),hr={};Object(sr.hasExtension)("sidebarTheme")&&(hr=Object(sr.getExtension)("sidebarTheme"));var pr,ur=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lr(n,!0).forEach((function(t){g()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lr(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},{background:"#30353F",color:"#D3D3D3","font-family":"Lato, Helvetica Neue, Helvetica, sans-serif",sidebarBoxShadow:"rgba(255, 255, 255, 1)",selectedColor:"#5DA8A3",unselectedColor:"#BBB",unselectedBackground:"#888"},{},hr),mr=function(e){var t=e.sidebarOpen,n=e.width,a=e.height,i=e.displayNarrative,r=e.panelsToDisplay,o=e.narrativeTitle,s=e.mobileDisplay,l=e.navBarHandler;return y.a.createElement(k.a,{theme:ur},y.a.createElement(dr,{left:t?0:-1*n,width:n,height:a},y.a.createElement(qa.a,{sidebar:!0,mobileDisplay:s,toggleHandler:l,narrativeTitle:!!i&&o,width:n}),i?y.a.createElement(Ha,{height:a-N.narrativeNavBarHeight,width:n}):y.a.createElement(or,{mapOn:r.includes("map")})))},fr=function(e,t,n,a){var i,r=e.width,o=e.height,s=(i=r,t?i>1500?500:i>1e3?400:310:N.controlsWidth+N.controlsPadding),l=n?s:0;return a||(r-=l),{overlayStyles:{position:"absolute",top:0,bottom:0,right:0,display:"block",width:r,height:o,left:n?l:0,opacity:n?1:0,visibility:n?"visible":"hidden",zIndex:8e3,backgroundColor:"rgba(0,0,0,0.5)",cursor:"pointer",overflow:"scroll",transition:n?"visibility 0s ease-out, left 0.3s ease-out, opacity 0.3s ease-out":"left 0.3s ease-out, opacity 0.3s ease-out, visibility 0s ease-out 0.3s"},availableWidth:r,availableHeight:o,sidebarWidth:s}},gr=n(155),vr=k.c.div.withConfig({displayName:"MainDisplayMarkdown__Container",componentId:"sc-5tw4mo-0"})(["margin:",";font-family:",";font-weight:300;color:",";line-height:1.4;width:","px;font-size:14px;line-height:1.4;@media (max-width:1080px){line-height:1.2;}h1{font-weight:700;font-size:2em;margin:0.3em 0;}h2{font-weight:600;font-size:1.8em;margin:0.3em 0;}h3{font-weight:500;font-size:1.6em;margin:0.3em 0;}h4{font-weight:500;font-size:1.4em;margin:0.2em 0;}h5{font-weight:500;font-size:1.2em;margin:0.2em 0;}h6{font-weight:500;font-size:1.2em;margin:0.2em 0;}pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px;}.line{margin-top:20px;margin-bottom:20px;border-bottom:1px solid #CCC;}.imageContainer{display:flex;justify-content:center;align-items:center;flex-wrap:wrap;}img{margin-left:30px;margin-right:30px;margin-top:2px;margin-bottom:2px;}"],(function(e){return e.mobile?"10px 5% 5% 5%":"50px 30px 30px 30px"}),E.b,(function(e){return e.theme.unselectedColor}),(function(e){return e.width-30})),yr=Object(x.b)((function(e){return{narrativeBlock:e.narrative.blocks[e.narrative.blockIdx]}}))((function(e){var t=e.narrativeBlock,n=e.width,a=e.mobile,i=function(e){P.a.addHook("afterSanitizeAttributes",(function(e){"href"in e&&location.hostname!==e.hostname&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noreferrer nofollow")),M()(e.childNodes).filter((function(e){return"img"===e.localName})).length>0&&("a"===e.localName?e.parentNode.className+=" imageContainer":e.className+=" imageContainer")}));var t=P.a.sanitize,n=B()(e);return t(n,{ALLOWED_TAGS:["div","h1","h2","h3","h4","h5","h6","p","em","strong","del","ol","ul","li","a","img","#text","pre","hr","table","thead","tbody","th","tr","td"],ALLOWED_ATTR:["href","src","width","height","alt"],KEEP_CONTENT:!1,ALLOW_DATA_ATTR:!1})}(t.mainDisplayMarkdown);return y.a.createElement(vr,{width:n,mobile:a},y.a.createElement("div",{dir:"auto",dangerouslySetInnerHTML:{__html:i}}))}));function br(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function wr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?br(n,!0).forEach((function(t){g()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):br(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var xr,kr,Er,Tr=50,Sr=function(){document.getElementById("progress-bar").scrollIntoView()},Cr=Object(x.b)((function(e){return{loaded:e.narrative.loaded,blocks:e.narrative.blocks,currentInFocusBlockIdx:e.narrative.blockIdx,panelsToDisplay:e.controls.panelsToDisplay}}))(pr=function(e){function t(e){var n;return i()(this,t),n=l()(this,d()(t).call(this,e)),g()(p()(n),"NextButton",(function(e){return y.a.createElement(wa,{height:n.state.bannerHeight,onClick:n.goToNextPage},e.children)})),g()(p()(n),"PreviousButton",(function(e){return y.a.createElement(ba,{height:n.state.bannerHeight,onClick:n.goToPreviousPage},e.children)})),n.state={showingEndOfNarrativePage:!1,bannerHeight:Tr,contentHeight:window.innerHeight-2*Tr},n.exitNarrativeMode=function(){n.props.dispatch(Object(Ra.b)({path:n.props.blocks[0].dataset,query:!0}))},n.goToNextPage=function(){n.state.showingEndOfNarrativePage||(n.props.currentInFocusBlockIdx+1!==n.props.blocks.length?n._goToPage(n.props.currentInFocusBlockIdx+1):n.setState({showingEndOfNarrativePage:!0}))},n.goToPreviousPage=function(){0!==n.props.currentInFocusBlockIdx&&n._goToPage(n.props.currentInFocusBlockIdx-1)},n._goToPage=function(e){n.setState({showingEndOfNarrativePage:!1}),n.props.blocks[e]&&n.props.blocks[e].mainDisplayMarkdown?n.props.dispatch(Object(Ra.a)({query:ha.a.parse(n.props.blocks[e].query),queryToDisplay:{n:e}})):n.props.dispatch(Object(Ra.b)({changeDataset:!1,query:ha.a.parse(n.props.blocks[e].query),queryToDisplay:{n:e},push:!0})),Sr()},n}return m()(t,e),o()(t,[{key:"pageNarrativeContent",value:function(){if(this.props.blocks[this.props.currentInFocusBlockIdx].mainDisplayMarkdown)return null;var e=this.props.blocks[this.props.currentInFocusBlockIdx].__html;return 0===this.props.currentInFocusBlockIdx&&(e='\n  <p class="explanation">\n  Narratives are interleaved sections of text and associated nextstrain visualisations of the genomic data.\n  Click the coloured arrows at the top & bottom of each page to move through this narrative.\n  Within each page, you can scroll through the text to see visualisations of the genomic data.\n  </p>\n'+e),y.a.createElement("div",{id:"NarrativeBlock_".concat(this.props.currentInFocusBlockIdx),style:{padding:"10px 20px",height:"inherit",overflow:"hidden"},dangerouslySetInnerHTML:{__html:e}})}},{key:"renderMainMarkdown",value:function(){return this.props.panelsToDisplay.includes("EXPERIMENTAL_MainDisplayMarkdown")?y.a.createElement(yr,{width:window.innerWidth,mobile:!0}):null}},{key:"renderVizCards",value:function(e){if(this.props.blocks[this.props.currentInFocusBlockIdx].mainDisplayMarkdown)return null;if(0===this.props.currentInFocusBlockIdx)return null;var t=window.innerWidth-50;return y.a.createElement(y.a.Fragment,null,this.props.panelsToDisplay.includes("tree")?y.a.createElement(tn,{width:t,height:e}):null,this.props.panelsToDisplay.includes("map")?y.a.createElement(Un,{width:t,height:e,justGotNewDatasetRenderNewMap:!1}):null)}},{key:"renderEndOfNarrative",value:function(){var e=this;return y.a.createElement(y.a.Fragment,null,y.a.createElement(this.PreviousButton,null,"Previous"),y.a.createElement(xa,{height:this.state.contentHeight+this.state.bannerHeight},this.renderProgress(),y.a.createElement(ya,null,y.a.createElement("h1",null,"End of Narrative"),y.a.createElement("a",{style:wr({},ma),onClick:function(){return e._goToPage(0)}},"Jump to the beginning"),y.a.createElement("br",null),y.a.createElement("a",{style:wr({},ma),onClick:this.exitNarrativeMode},"Leave the narrative & explore the data yourself"))))}},{key:"renderStartOfNarrative",value:function(){return y.a.createElement(y.a.Fragment,null,y.a.createElement(xa,{height:this.state.contentHeight+this.state.bannerHeight},this.renderProgress(),this.pageNarrativeContent(),this.renderVizCards(this.state.contentHeight),this.renderMainMarkdown()),y.a.createElement(this.NextButton,null,"Next"))}},{key:"renderMiddleOfNarrative",value:function(){return y.a.createElement(y.a.Fragment,null,y.a.createElement(this.PreviousButton,{"aria-labelledby":"nav1"},"Previous"),y.a.createElement(xa,{height:this.state.contentHeight},this.renderProgress(),this.pageNarrativeContent(),this.renderVizCards(this.state.contentHeight),this.renderMainMarkdown()),y.a.createElement(this.NextButton,{"aria-labelledby":"nav2"},"Next"))}},{key:"renderProgress",value:function(){var e=this;return y.a.createElement(fa,{id:"progress-bar",style:{height:"".concat(25,"px")}},this.props.blocks.map((function(t,n){var a=e.state.showingEndOfNarrativePage||e.props.currentInFocusBlockIdx!==n?"6px":"14px";return y.a.createElement(ga,{key:n,style:{width:a,height:a},onClick:function(){return e._goToPage(n)}})})))}},{key:"render",value:function(){return this.state.showingEndOfNarrativePage?this.renderEndOfNarrative():0===this.props.currentInFocusBlockIdx?this.renderStartOfNarrative():this.renderMiddleOfNarrative()}}]),t}(y.a.Component))||pr,Or=Object(v.lazy)((function(){return Promise.all([n.e(7),n.e(8)]).then(n.bind(null,712))})),jr=Object(v.lazy)((function(){return n.e(6).then(n.bind(null,714))})),Nr=Object(x.b)((function(e){return{panelsToDisplay:e.controls.panelsToDisplay,panelLayout:e.controls.panelLayout,displayNarrative:e.narrative.display,narrativeIsLoaded:e.narrative.loaded,narrativeTitle:e.narrative.title,browserDimensions:e.browserDimensions.browserDimensions,frequenciesLoaded:e.frequencies.loaded,metadataLoaded:e.metadata.loaded,treeLoaded:e.tree.loaded,sidebarOpen:e.controls.sidebarOpen,showOnlyPanels:e.controls.showOnlyPanels}}))((Er=kr=function(e){function t(e){var n;i()(this,t),n=l()(this,d()(t).call(this,e));var a=window.matchMedia("(min-width: ".concat(N.controlsHiddenWidth,"px)"));return a.addListener((function(){return n.setState({mobileDisplay:!n.state.mql.matches})})),n.state={mql:a,mobileDisplay:!a.matches,showSpinner:!(n.props.metadataLoaded&&n.props.treeLoaded)},Object(Xn.analyticsNewPage)(),n.toggleSidebar=n.toggleSidebar.bind(p()(n)),n}return m()(t,e),o()(t,[{key:"componentWillReceiveProps",value:function(e){this.state.showSpinner&&e.metadataLoaded&&e.treeLoaded&&this.setState({showSpinner:!1})}},{key:"componentDidMount",value:function(){var e=this;document.addEventListener("dragover",(function(e){e.preventDefault()}),!1),document.addEventListener("drop",(function(t){return t.preventDefault(),e.props.dispatch(ra(t.dataTransfer.files))}),!1)}},{key:"toggleSidebar",value:function(){this.props.dispatch({type:A.O,value:!this.props.sidebarOpen})}},{key:"render",value:function(){var e=this;if(this.state.showSpinner)return y.a.createElement(gr.a,null);if(this.state.mobileDisplay&&this.props.displayNarrative)return y.a.createElement(y.a.Fragment,null,y.a.createElement(oa,null),y.a.createElement(k.a,{theme:ur},y.a.createElement(Cr,null)));var t,n,a=fr(this.props.browserDimensions,this.props.displayNarrative,this.props.sidebarOpen,this.state.mobileDisplay),i=a.availableWidth,r=a.availableHeight,o=a.sidebarWidth,s=a.overlayStyles,l=function(){e.props.dispatch({type:A.O,value:!1})},c=function(e,t,n,a,i){var r=e?.5:1,o=.36,s=e?.64:.88;if(n){var l=!0+t.includes("entropy")+t.includes("frequencies")-1;0===l?s=1:1===l?(s=.7,o=.3):(s=.5,o=.25),t.includes("map")&&t.includes("tree")&&!e&&(r=.5),!e||t.includes("map")&&t.includes("tree")||(r=1)}return{big:Object(sa.computeResponsive)({horizontal:r,vertical:s,availableWidth:a,availableHeight:i}),chart:Object(sa.computeResponsive)({horizontal:1,vertical:o,availableWidth:a,availableHeight:i,minHeight:150})}}("grid"===this.props.panelLayout,this.props.panelsToDisplay,this.props.displayNarrative,i,r),d=c.big,h=c.chart;return y.a.createElement("span",null,y.a.createElement(oa,null),y.a.createElement(Qe.default,{showNothing:!0},y.a.createElement(k.a,{theme:ur},y.a.createElement(Ct,null))),y.a.createElement(T,{sidebarOpen:this.props.sidebarOpen,mobileDisplay:this.state.mobileDisplay,handler:this.toggleSidebar}),y.a.createElement(mr,{sidebarOpen:this.props.sidebarOpen,width:o,height:r,displayNarrative:this.props.displayNarrative,panelsToDisplay:this.props.panelsToDisplay,narrativeTitle:this.props.narrativeTitle,mobileDisplay:this.state.mobileDisplay,navBarHandler:this.toggleSidebar}),y.a.createElement(cr,{width:i,height:r,left:this.props.sidebarOpen?o:0},this.props.narrativeIsLoaded&&!this.props.panelsToDisplay.includes("EXPERIMENTAL_MainDisplayMarkdown")?(t=this.props.dispatch,n=this.props.displayNarrative,y.a.createElement("button",{style:ca({},E.o,{fontSize:14,backgroundColor:"inherit",zIndex:100,position:"fixed",right:5,top:-1,cursor:"pointer",color:E.a}),onClick:function(){return t({type:A.M,display:!n})}},n?"explore the data yourself":"return to the narrative")):null,this.props.displayNarrative||this.props.showOnlyPanels?null:y.a.createElement(en,{width:Object(sa.calcUsableWidth)(i,1)}),this.props.panelsToDisplay.includes("tree")?y.a.createElement(tn,{width:d.width,height:d.height}):null,this.props.panelsToDisplay.includes("map")?y.a.createElement(Un,{width:d.width,height:d.height,justGotNewDatasetRenderNewMap:!1}):null,this.props.panelsToDisplay.includes("entropy")?y.a.createElement(v.Suspense,{fallback:null},y.a.createElement(Or,{width:h.width,height:h.height})):null,this.props.panelsToDisplay.includes("frequencies")&&this.props.frequenciesLoaded?y.a.createElement(v.Suspense,{fallback:null},y.a.createElement(jr,{width:h.width,height:h.height})):null,this.props.displayNarrative||this.props.showOnlyPanels?null:y.a.createElement(Vt,{width:Object(sa.calcUsableWidth)(i,1)}),this.props.displayNarrative&&this.props.panelsToDisplay.includes("EXPERIMENTAL_MainDisplayMarkdown")?y.a.createElement(yr,{width:Object(sa.calcUsableWidth)(i,1)}):null),this.state.mobileDisplay?y.a.createElement("div",{style:s,onClick:l,onTouchStart:l}):null)}}]),t}(y.a.Component),g()(kr,"propTypes",{dispatch:w.a.func.isRequired}),xr=Er))||xr;t.default=Nr}}]);
//# sourceMappingURL=auspice.chunk.4.bundle.js.map